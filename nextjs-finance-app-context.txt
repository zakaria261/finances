================================================================================
APPLICATION DESCRIPTION: NEXT.JS FINANCE EXPERT PRO
================================================================================

This document contains the complete source code for "Finances Expert Pro," a full-stack personal finance management application built with the Next.js App Router.

The primary goal of the application is to provide users with a comprehensive and intelligent platform to manage every aspect of their financial lives, from daily transaction tracking to long-term investment and goal planning. The app leverages a modern tech stack to deliver a secure, performant, and feature-rich experience.

--------------------------------------------------------------------------------
CORE TECHNOLOGY STACK
--------------------------------------------------------------------------------

*   **Framework:** Next.js 14+ (with App Router)
*   **Language:** TypeScript
*   **Authentication:** NextAuth.js (with Google, Apple, and Credentials providers)
*   **Database ORM:** Prisma
*   **UI Components:** Shadcn/UI (built on Radix UI and Tailwind CSS)
*   **Styling:** Tailwind CSS
*   **Charting:** Recharts
*   **AI Integration:** Google Gemini API for financial analysis

--------------------------------------------------------------------------------
ARCHITECTURAL OVERVIEW
--------------------------------------------------------------------------------

The application follows a modern full-stack architecture facilitated by Next.js:

1.  **App Router (`src/app`):** The file system is used for routing. The structure includes:
    *   **Route Groups:** `(auth)` for login/register pages and `(main)` for the protected application dashboard to share layouts.
    *   **Server Components:** Used by default for data fetching directly from the database (via Prisma), providing excellent performance and security.
    *   **Client Components (`'use client'`):** Used for interactive UI elements like forms, charts, and navigation buttons that require state and event listeners.

2.  **API Layer (`src/app/api`):**
    *   **NextAuth Catch-all Route:** A route at `src/app/api/auth/[...nextauth]/route.ts` handles all authentication-related requests (sign-in, sign-out, callbacks).
    *   **Data API Routes:** Future API routes can be built here to serve data to the client or handle server actions.

3.  **Data Layer (Prisma):**
    *   **Schema:** The single source of truth for the database structure is defined in `prisma/schema.prisma`.
    *   **Prisma Client:** A type-safe client is used within Server Components and API routes to query the database. The client instance is managed in `src/lib/prisma.ts`.

4.  **Authentication Layer (NextAuth.js):**
    *   **Session Management:** NextAuth handles user sessions, JWTs, and database session persistence (using the Prisma adapter).
    *   **Route Protection:** Middleware (`middleware.ts`) is used to protect all routes within the `(main)` group, redirecting unauthenticated users to the login page.
    *   **Providers:** The application supports email/password (Credentials), Google, and Apple OAuth for flexible user sign-on.

--------------------------------------------------------------------------------
KEY FUNCTIONALITIES & FEATURES
--------------------------------------------------------------------------------

The application is broken down into the following core modules:

*   **Authentication:**
    *   Secure user registration and login using email/password.
    *   Seamless social login with Google and Apple.
    *   Password hashing and secure session management handled by NextAuth.

*   **Dashboard:**
    *   A central hub displaying key financial metrics: Net Worth, Monthly Cash Flow, and a Financial Health Score.
    *   Visualizations of income vs. expenses and expense category breakdowns.
    *   Quick access to recent transactions and budget alerts.

*   **Transaction Management:**
    *   Log income and expenses with details like name, amount, category, and frequency.
    *   View, sort, and filter all historical transactions.

*   **Financial Planning:**
    *   **Goals:** Create, track, and update financial goals (e.g., "Vacation Fund," "Down Payment"). Progress is visualized.
    *   **Budgets:** Set monthly spending limits for different expense categories. The dashboard shows real-time progress against these budgets.

*   **Asset & Debt Management:**
    *   **Patrimoine (Wealth):** Track the value of assets like savings accounts, real estate, and other valuables.
    *   **Investments:** A dedicated module to track stocks, crypto, and ETFs, including quantity, purchase price, and current value.
    *   **Debts:** Manage loans and credits, with tools to visualize repayment strategies (Avalanche vs. Snowball).

*   **AI-Powered Insights:**
    *   Users can trigger a financial analysis using the Gemini API.
    *   The AI provides a detailed report including a financial score, strengths, weaknesses, and actionable recommendations.

*   **Gamification & Engagement:**
    *   **Season Pass:** A tiered reward system where users earn XP by performing financial tasks (e.g., adding an expense, creating a goal).
    *   **Rewards:** Leveling up unlocks new features (e.g., advanced charts, CSV export) and cosmetic themes.

--------------------------------------------------------------------------------
DATABASE MODELS (Prisma Schema Overview)
--------------------------------------------------------------------------------

The `prisma/schema.prisma` file defines the following core models:

*   `User`: Stores user information, linked to `Account` and `Session`.
*   `Account`: Stores provider details for social logins (linked to `User`).
*   `Session`: Manages user sessions for NextAuth.
*   `VerificationToken`: Used for email verification flows.
*   `Transaction`: A central model for all income and expenses, with a type field (`INCOME` or `EXPENSE`), category, amount, etc. Linked to a `User`.
*   `Goal`: Stores user-defined financial goals. Linked to a `User`.
*   `Asset`: Represents items contributing to net worth. Linked to a `User`.
*   `Investment`: A specific type of asset for tracking market investments. Linked to a `User`.
*   `Budget`: Defines category-based spending limits. Linked to a `User`.
*   `GameState`: Stores all gamification data for a user (level, XP, claimed rewards). Linked to a `User`.

This structure ensures data is well-organized, relational, and strongly typed throughout the application.

================================================================================
PROJECT CODE FILES
================================================================================

// ============================================================================
// FILE: app/(auth)/layout.tsx
// ============================================================================

// app/(auth)/layout.tsx

import Link from "next/link";
import { Wallet } from "lucide-react";

export default function AuthLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="flex min-h-screen">
      <div className="flex flex-1 flex-col justify-center py-12 px-4 sm:px-6 lg:flex-none lg:px-20 xl:px-24">
        <div className="mx-auto w-full max-w-sm lg:w-96">
            {children}
        </div>
      </div>
      
      {/* MODIFICATION: Removed the <Image> component and added the animated-gradient class */}
      <div className="relative hidden w-0 flex-1 lg:block animated-gradient">
        {/* The overlay is kept to ensure text is readable over the moving gradient */}
        <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/50 to-transparent flex flex-col justify-end p-12">
            <Link href="/" className="flex items-center space-x-2 mb-4">
                <Wallet className="h-8 w-8 text-white" />
                <span className="text-2xl font-bold text-white">Finances Expert Pro</span>
            </Link>
            <h2 className="text-3xl font-bold tracking-tight text-white">
                Take control of your financial future.
            </h2>
            <p className="mt-4 text-lg text-white/80">
                Join thousands of users who are building wealth and achieving their goals with our powerful tools.
            </p>
        </div>
      </div>
    </div>
  );
}

// ============================================================================
// FILE: app/(auth)/login/page.tsx
// ============================================================================

// app/(auth)/login/page.tsx
"use client";

import { useState } from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { signIn } from "next-auth/react";
import { Wallet, LogIn, Mail, Lock } from "lucide-react";
import { FaGoogle } from "react-icons/fa"; // MODIFICATION: Import the icon

import { Button } from "@/components/ui/button";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";
import { Separator } from "@/components/ui/separator";

const formSchema = z.object({
  email: z.string().email({ message: "Please enter a valid email." }),
  password: z.string().min(1, { message: "Password is required." }),
});

export default function LoginPage() {
  const router = useRouter();
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      email: "",
      password: "",
    },
  });

  const onSubmit = async (values: z.infer<typeof formSchema>) => {
    setIsLoading(true);
    setError(null);
    try {
      const result = await signIn("credentials", {
        ...values,
        redirect: false,
      });

      if (result?.error) {
        setError("Invalid email or password. Please try again.");
      } else if (result?.ok) {
        router.push("/dashboard"); // Redirect to a protected page
      }
    } catch (err) {
      setError("An unexpected error occurred. Please try again.");
    } finally {
      setIsLoading(false);
    }
  };

  const handleGoogleSignIn = () => {
    signIn("google", { callbackUrl: "/dashboard" });
  };

  return (
    <div>
      <div>
        <div className="flex items-center gap-2">
            <Wallet className="h-8 w-8 text-primary" />
            <h2 className="mt-2 text-2xl font-bold leading-9 tracking-tight text-foreground">
                Sign in to your account
            </h2>
        </div>
        <p className="mt-2 text-sm leading-6 text-muted-foreground">
          Don&apos;t have an account?{" "}
          <Link
            href="/register"
            className="font-semibold text-primary hover:text-primary/90"
          >
            Sign up
          </Link>
        </p>
      </div>

      <div className="mt-10">
        <Button
          variant="outline"
          className="w-full"
          onClick={handleGoogleSignIn}
        >
          {/* MODIFICATION: Replaced Image with React Icon */}
          <FaGoogle className="mr-2 h-4 w-4" />
          Sign in with Google
        </Button>

        <div className="relative my-6">
            <Separator />
            <div className="absolute inset-0 flex items-center">
                <span className="w-full border-t" />
            </div>
            <div className="relative flex justify-center text-sm">
                <span className="bg-background px-2 text-muted-foreground">Or continue with</span>
            </div>
        </div>

        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
            {error && (
              <Alert variant="destructive">
                <AlertTitle>Error</AlertTitle>
                <AlertDescription>{error}</AlertDescription>
              </Alert>
            )}
            <FormField
              control={form.control}
              name="email"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Email address</FormLabel>
                  <FormControl>
                    <div className="relative">
                      <Mail className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"/>
                      <Input placeholder="you@example.com" {...field} className="pl-10"/>
                    </div>
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            <FormField
              control={form.control}
              name="password"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Password</FormLabel>
                  <FormControl>
                     <div className="relative">
                       <Lock className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"/>
                       <Input type="password" placeholder="••••••••" {...field} className="pl-10"/>
                    </div>
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <Button type="submit" className="w-full" disabled={isLoading}>
                {isLoading ? "Signing in..." : <> <LogIn className="mr-2 h-4 w-4"/> Sign in</>}
            </Button>
          </form>
        </Form>
      </div>
    </div>
  );
}

// ============================================================================
// FILE: app/(auth)/register/page.tsx
// ============================================================================

// app/(auth)/register/page.tsx
"use client";

import { useState } from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { signIn } from "next-auth/react";
import axios from "axios";
import { Wallet, UserPlus, Mail, Lock } from "lucide-react";
import { FaGoogle } from "react-icons/fa"; // MODIFICATION: Import the icon

import { Button } from "@/components/ui/button";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";
import { Separator } from "@/components/ui/separator";

const formSchema = z.object({
  name: z.string().min(1, { message: "Name is required." }),
  email: z.string().email({ message: "Please enter a valid email." }),
  password: z.string().min(6, { message: "Password must be at least 6 characters." }),
});

export default function RegisterPage() {
  const router = useRouter();
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      name: "",
      email: "",
      password: "",
    },
  });

  const onSubmit = async (values: z.infer<typeof formSchema>) => {
    setIsLoading(true);
    setError(null);

    try {
      await axios.post("/api/register", values);
      
      const result = await signIn("credentials", {
        email: values.email,
        password: values.password,
        redirect: false,
      });

      if (result?.error) {
        setError("Failed to sign in after registration. Please log in manually.");
      } else if (result?.ok) {
        router.push("/dashboard");
      }
    } catch (err: any) {
        if (err.response?.status === 409) {
            setError("An account with this email already exists.");
        } else {
            setError("An unexpected error occurred. Please try again.");
        }
    } finally {
      setIsLoading(false);
    }
  };
  
  const handleGoogleSignIn = () => {
    signIn("google", { callbackUrl: "/dashboard" });
  };


  return (
    <div>
       <div>
        <div className="flex items-center gap-2">
            <Wallet className="h-8 w-8 text-primary" />
            <h2 className="mt-2 text-2xl font-bold leading-9 tracking-tight text-foreground">
                Create your account
            </h2>
        </div>
        <p className="mt-2 text-sm leading-6 text-muted-foreground">
          Already have an account?{" "}
          <Link
            href="/login"
            className="font-semibold text-primary hover:text-primary/90"
          >
            Sign in
          </Link>
        </p>
      </div>

      <div className="mt-10">
        <Button
          variant="outline"
          className="w-full"
          onClick={handleGoogleSignIn}
        >
          {/* MODIFICATION: Replaced Image with React Icon */}
          <FaGoogle className="mr-2 h-4 w-4" />
          Sign up with Google
        </Button>

        <div className="relative my-6">
            <Separator />
            <div className="absolute inset-0 flex items-center">
                <span className="w-full border-t" />
            </div>
            <div className="relative flex justify-center text-sm">
                <span className="bg-background px-2 text-muted-foreground">Or continue with</span>
            </div>
        </div>

        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
            {error && (
              <Alert variant="destructive">
                <AlertTitle>Error</AlertTitle>
                <AlertDescription>{error}</AlertDescription>
              </Alert>
            )}
             <FormField
              control={form.control}
              name="name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Full Name</FormLabel>
                  <FormControl>
                    <div className="relative">
                      <UserPlus className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"/>
                      <Input placeholder="John Doe" {...field} className="pl-10"/>
                    </div>
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="email"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Email address</FormLabel>
                  <FormControl>
                    <div className="relative">
                      <Mail className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"/>
                      <Input placeholder="you@example.com" {...field} className="pl-10"/>
                    </div>
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="password"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Password</FormLabel>
                  <FormControl>
                     <div className="relative">
                       <Lock className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"/>
                       <Input type="password" placeholder="••••••••" {...field} className="pl-10"/>
                    </div>
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <Button type="submit" className="w-full" disabled={isLoading}>
                 {isLoading ? "Creating account..." : <> <UserPlus className="mr-2 h-4 w-4"/> Sign up</>}
            </Button>
          </form>
        </Form>
      </div>
    </div>
  );
}

// ============================================================================
// FILE: app/(main)/budgets/page.tsx
// ============================================================================

'use client';

import React, { useState } from 'react';
import { PlusCircle, Trash2, TrendingDown, AlertTriangle, CreditCard } from 'lucide-react';
import { CATEGORIES } from '@/constants';
import type { Depense, DepenseFrequence } from '@/types';
import { useTheme } from '@/context/ThemeContext';
import { useFinanceData } from '@/context/FinanceDataContext';
import { cn } from '@/lib/utils';
import { formaterMontant, calculerMontantMensuel } from '@/utils/financeCalculations';

const initialState: Omit<Depense, 'id'> = {
  nom: '',
  montant: '',
  frequence: 'mensuel',
  categorie: 'abonnements',
  dateDebut: new Date().toISOString().split('T')[0],
  montantTotal: '',
  mensualitesRestantes: '',
  tauxInteret: '',
  nombrePaiements: '',
  paiementsRestants: '',
  typeAssurance: 'auto'
};

export default function BudgetsPage() {
  const { depenses, setDepenses } = useFinanceData();
  const [nouvelleDepense, setNouvelleDepense] = useState(initialState);
  const [errors, setErrors] = useState<{ [key: string]: string }>({});
  const [deleteConfirmId, setDeleteConfirmId] = useState<number | null>(null);
  const { currentTheme } = useTheme();

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setNouvelleDepense(prev => ({ ...prev, [name]: value }));
    if (errors[name]) {
      setErrors(prev => ({ ...prev, [name]: '' }));
    }
  };

  const validate = (): boolean => {
    const newErrors: { [key: string]: string } = {};
    const montantNum = parseFloat(nouvelleDepense.montant);

    if (!nouvelleDepense.nom.trim()) newErrors.nom = "Le nom est requis.";
    if (isNaN(montantNum) || montantNum <= 0) newErrors.montant = "Le montant doit être un nombre positif.";

    if (nouvelleDepense.categorie === 'credit') {
      const montantTotalNum = parseFloat(nouvelleDepense.montantTotal || '');
      const mensualitesNum = parseInt(nouvelleDepense.mensualitesRestantes || '');
      const tauxNum = parseFloat(nouvelleDepense.tauxInteret || '');

      if (isNaN(montantTotalNum) || montantTotalNum <= 0) newErrors.montantTotal = "Montant total invalide.";
      if (isNaN(mensualitesNum) || mensualitesNum <= 0) newErrors.mensualitesRestantes = "Nombre de mensualités invalide.";
      if (isNaN(tauxNum) || tauxNum < 0) newErrors.tauxInteret = "Taux invalide.";
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const ajouterDepense = () => {
    if (validate()) {
      setDepenses(prev => [...prev, { ...nouvelleDepense, id: Date.now() }]);
      setNouvelleDepense(initialState);
      setErrors({});
    }
  };

  const confirmerSuppression = (id: number) => {
    setDeleteConfirmId(id);
  };

  const annulerSuppression = () => {
    setDeleteConfirmId(null);
  };

  const executerSuppression = () => {
    if (deleteConfirmId !== null) {
      setDepenses(depenses.filter(d => d.id !== deleteConfirmId));
      setDeleteConfirmId(null);
    }
  };

  const inputClass = cn(
    "w-full px-4 py-3 rounded-xl border-2 outline-none transition-all focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",
    currentTheme.colors.input,
    currentTheme.colors.border,
    currentTheme.colors.text
  );

  const totalMensuel = depenses.reduce((acc, dep) => acc + calculerMontantMensuel(dep), 0);

  return (
    <div className="space-y-6 animate-fadeIn relative">
      
      {/* Modal de confirmation */}
      {deleteConfirmId !== null && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-fadeIn">
          <div className={cn(
            "rounded-2xl p-6 shadow-2xl max-w-sm w-full mx-4 border transform transition-all scale-100",
            currentTheme.colors.card,
            currentTheme.colors.border
          )}>
            <div className="flex flex-col items-center text-center gap-4">
              <div className="p-3 bg-red-100 rounded-full">
                <AlertTriangle className="w-8 h-8 text-red-600" />
              </div>
              <h3 className={cn("text-xl font-bold", currentTheme.colors.text)}>
                Confirmer la suppression
              </h3>
              <p className={currentTheme.colors.subtext}>
                Êtes-vous sûr de vouloir supprimer cette dépense ?
              </p>
              <div className="flex gap-3 w-full mt-2">
                <button
                  onClick={annulerSuppression}
                  className={cn(
                    "flex-1 px-4 py-2 rounded-xl border font-semibold transition-colors hover:opacity-80",
                    currentTheme.colors.border,
                    currentTheme.colors.text
                  )}
                >
                  Annuler
                </button>
                <button
                  onClick={executerSuppression}
                  className="flex-1 px-4 py-2 rounded-xl bg-red-500 text-white font-semibold hover:bg-red-600 shadow-lg shadow-red-500/30 transition-colors"
                >
                  Supprimer
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Formulaire d'ajout */}
      <div className={cn(
        "rounded-2xl p-6 shadow-xl border backdrop-blur-xl",
        currentTheme.colors.card,
        currentTheme.colors.border
      )}>
        <h2 className={cn("text-2xl font-bold mb-6 flex items-center gap-3", currentTheme.colors.text)}>
          <div className="p-2 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-xl">
            <PlusCircle className="w-6 h-6 text-white" />
          </div>
          Ajouter une dépense
        </h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 mb-6">
          <div>
            <input
              type="text"
              placeholder="Nom"
              name="nom"
              value={nouvelleDepense.nom}
              onChange={handleInputChange}
              className={cn(inputClass, errors.nom && 'border-red-500')}
            />
            {errors.nom && <p className="text-red-500 text-xs mt-1">{errors.nom}</p>}
          </div>
          <div>
            <input
              type="number"
              step="0.01"
              placeholder="Montant (€)"
              name="montant"
              value={nouvelleDepense.montant}
              onChange={handleInputChange}
              className={cn(inputClass, errors.montant && 'border-red-500')}
            />
            {errors.montant && <p className="text-red-500 text-xs mt-1">{errors.montant}</p>}
          </div>
          <select
            name="frequence"
            value={nouvelleDepense.frequence}
            onChange={handleInputChange}
            className={inputClass}
          >
            <option value="hebdomadaire">Hebdomadaire</option>
            <option value="mensuel">Mensuel</option>
            <option value="trimestriel">Trimestriel</option>
            <option value="semestriel">Semestriel</option>
            <option value="annuel">Annuel</option>
          </select>
          <select
            name="categorie"
            value={nouvelleDepense.categorie}
            onChange={handleInputChange}
            className={inputClass}
          >
            {Object.entries(CATEGORIES).map(([key, cat]) => (
              <option key={key} value={key}>{cat.label}</option>
            ))}
          </select>
        </div>

        {/* Champs supplémentaires pour les crédits */}
        {nouvelleDepense.categorie === 'credit' && (
          <div className={cn(
            "grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-2 mb-6 p-4 rounded-lg",
            currentTheme.isDark ? "bg-amber-900/20" : "bg-amber-50"
          )}>
            <div>
              <input
                type="number"
                placeholder="Montant total emprunté (€)"
                name="montantTotal"
                value={nouvelleDepense.montantTotal}
                onChange={handleInputChange}
                className={cn(inputClass, errors.montantTotal && 'border-red-500')}
              />
              {errors.montantTotal && <p className="text-red-500 text-xs mt-1">{errors.montantTotal}</p>}
            </div>
            <div>
              <input
                type="number"
                placeholder="Mensualités restantes"
                name="mensualitesRestantes"
                value={nouvelleDepense.mensualitesRestantes}
                onChange={handleInputChange}
                className={cn(inputClass, errors.mensualitesRestantes && 'border-red-500')}
              />
              {errors.mensualitesRestantes && <p className="text-red-500 text-xs mt-1">{errors.mensualitesRestantes}</p>}
            </div>
            <div>
              <input
                type="number"
                step="0.01"
                placeholder="Taux d'intérêt (%)"
                name="tauxInteret"
                value={nouvelleDepense.tauxInteret}
                onChange={handleInputChange}
                className={cn(inputClass, errors.tauxInteret && 'border-red-500')}
              />
              {errors.tauxInteret && <p className="text-red-500 text-xs mt-1">{errors.tauxInteret}</p>}
            </div>
          </div>
        )}
        
        <button
          onClick={ajouterDepense}
          className="w-full flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold hover:opacity-90 shadow-lg transition-all"
        >
          <PlusCircle className="w-5 h-5" /> Ajouter la dépense
        </button>
      </div>

      {/* Résumé */}
      <div className={cn(
        "rounded-2xl p-4 shadow-xl border backdrop-blur-xl",
        currentTheme.isDark ? "bg-red-900/20 border-red-800/30" : "bg-red-50 border-red-200"
      )}>
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="p-2 bg-gradient-to-br from-red-500 to-pink-500 rounded-xl">
              <TrendingDown className="w-5 h-5 text-white" />
            </div>
            <span className={cn("font-semibold", currentTheme.colors.text)}>Total dépenses mensuelles</span>
          </div>
          <span className="text-2xl font-bold text-red-600">{formaterMontant(totalMensuel)}</span>
        </div>
      </div>

      {/* Liste des dépenses */}
      <div className={cn(
        "rounded-2xl p-6 shadow-xl border backdrop-blur-xl",
        currentTheme.colors.card,
        currentTheme.colors.border
      )}>
        <h3 className={cn("text-xl font-bold mb-4", currentTheme.colors.text)}>
          Mes dépenses ({depenses.length})
        </h3>
        <div className="space-y-3">
          {depenses.length === 0 && (
            <p className={cn("text-center py-4", currentTheme.colors.subtext)}>
              Aucune dépense ajoutée pour le moment.
            </p>
          )}
          {depenses.map(dep => {
            const catInfo = CATEGORIES[dep.categorie];
            const montantMensuel = calculerMontantMensuel(dep);
            
            return (
              <div
                key={dep.id}
                className={cn(
                  "flex items-center justify-between p-4 rounded-xl border hover:shadow-lg transition-all",
                  currentTheme.colors.border,
                  currentTheme.isDark ? "bg-slate-800/40" : "bg-gradient-to-r from-red-50 to-pink-50"
                )}
              >
                <div className="flex items-center gap-3">
                  <div 
                    className="p-2 rounded-lg"
                    style={{ backgroundColor: catInfo?.color || '#6366f1' }}
                  >
                    {dep.categorie === 'credit' ? (
                      <CreditCard className="w-5 h-5 text-white" />
                    ) : (
                      <TrendingDown className="w-5 h-5 text-white" />
                    )}
                  </div>
                  <div>
                    <div className={cn("font-bold", currentTheme.colors.text)}>{dep.nom}</div>
                    <div className={cn("text-sm", currentTheme.colors.subtext)}>
                      {parseFloat(dep.montant).toFixed(2)}€ · {dep.frequence}
                      {dep.frequence !== 'mensuel' && (
                        <span className="text-indigo-600 font-medium"> ({formaterMontant(montantMensuel)}/mois)</span>
                      )}
                    </div>
                    <div className={cn("text-xs", currentTheme.colors.subtext)}>
                      {catInfo?.label || 'Autre'}
                      {dep.categorie === 'credit' && dep.mensualitesRestantes && (
                        <span> · {dep.mensualitesRestantes} mensualités restantes</span>
                      )}
                    </div>
                  </div>
                </div>
                <button
                  onClick={() => confirmerSuppression(dep.id)}
                  className="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors"
                >
                  <Trash2 className="w-4 h-4" />
                </button>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}

// ============================================================================
// FILE: app/(main)/dashboard/page.tsx
// ============================================================================

'use client';

import React, { useMemo, useState } from 'react';
import { 
  PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, CartesianGrid, 
  Tooltip, ResponsiveContainer, Radar, RadarChart, PolarGrid, 
  PolarAngleAxis, PolarRadiusAxis 
} from 'recharts';
import { 
  TrendingUp, TrendingDown, Wallet, Target, Flame, Star, Trophy, 
  Sparkles, ChevronRight, PiggyBank, AlertTriangle, AlertCircle, 
  FileDown, Lock 
} from 'lucide-react';

import { formaterMontant, calculerMontantMensuel } from '@/utils/financeCalculations';
import { CATEGORIES } from '@/constants';
import type { Depense, Revenu, Objectif, Actif, Trophee, Budget, GameState } from '@/types';
import { useTheme } from '@/context/ThemeContext';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';
import { useFinanceData } from '@/context/FinanceDataContext';

interface StatCardProps {
  label: string;
  value: string;
  icon: React.ElementType;
  gradient: string;
  bg: string;
  count: string;
}

const StatCard: React.FC<StatCardProps> = ({ label, value, icon: Icon, gradient, bg, count }) => {
  const { currentTheme } = useTheme();
  const bgClass = currentTheme.isDark ? `bg-slate-800/50` : `bg-gradient-to-br ${bg}`;
  
  return (
    <Card className={`border-none overflow-hidden relative group hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 ${bgClass}`}>
      <CardContent className="p-6">
        <div className="flex items-start justify-between mb-4">
          <div className={`p-3 rounded-xl bg-gradient-to-br ${gradient} shadow-lg text-white`}>
            <Icon className="w-6 h-6" />
          </div>
          <Badge variant="secondary" className={currentTheme.isDark ? "bg-slate-700 text-slate-200" : "bg-white/50 backdrop-blur-md"}>
            {count}
          </Badge>
        </div>
        <div className="space-y-1">
          <p className={cn("text-sm font-medium", currentTheme.colors.subtext)}>{label}</p>
          <h4 className={cn("text-3xl font-bold tracking-tight", currentTheme.colors.text)}>{value}</h4>
        </div>
      </CardContent>
    </Card>
  );
};

export default function DashboardPage() {
  const {
    cashFlow,
    scoreSante,
    totalRevenusMensuel,
    totalDepensesMensuel,
    patrimoineNet,
    revenus,
    depenses,
    objectifs,
    actifs,
    tropheesDeverrouilles,
    analyserAvecIA,
    chargementIA,
    budgets,
    setBudgets,
    gameState
  } = useFinanceData();

  const [nouveauBudget, setNouveauBudget] = useState({ categorie: Object.keys(CATEGORIES)[0], limite: '' });
  const [budgetError, setBudgetError] = useState('');
  const { currentTheme } = useTheme();

  const isCsvUnlocked = gameState.unlockedFeatures.includes('export_csv');
  const isRadarUnlocked = gameState.unlockedFeatures.includes('radar_chart');

  const donneesParCategorie = Object.keys(CATEGORIES).map(cat => ({
    name: CATEGORIES[cat].label,
    value: depenses.filter(d => d.categorie === cat).reduce((acc, d) => acc + calculerMontantMensuel(d), 0),
    color: CATEGORIES[cat].color,
    fullMark: 100
  })).filter(d => d.value > 0);
  
  const donneesRevenuDepenses = [
    { categorie: 'Revenus', montant: totalRevenusMensuel, color: '#10B981' },
    { categorie: 'Dépenses', montant: totalDepensesMensuel, color: '#EF4444' },
    { categorie: 'Cash Flow', montant: Math.max(0, cashFlow), color: '#6366f1' }
  ];

  const depensesMensuellesParCategorie = useMemo(() => {
    const map: { [key: string]: number } = {};
    depenses.forEach(dep => {
      const montant = calculerMontantMensuel(dep);
      map[dep.categorie] = (map[dep.categorie] || 0) + montant;
    });
    return map;
  }, [depenses]);

  const handleAjouterBudget = () => {
    const limite = parseFloat(nouveauBudget.limite);
    if (isNaN(limite) || limite <= 0) { 
      setBudgetError('Montant invalide.'); 
      return; 
    }
    setBudgetError('');
    setBudgets(prev => {
      const existing = prev.find(b => b.categorie === nouveauBudget.categorie);
      if (existing) return prev.map(b => b.categorie === nouveauBudget.categorie ? { ...b, limite } : b);
      return [...prev, { categorie: nouveauBudget.categorie as keyof typeof CATEGORIES, limite }];
    });
    setNouveauBudget({ categorie: nouveauBudget.categorie, limite: '' });
  };

  const exportCSV = () => {
    if (!isCsvUnlocked) return;
    const headers = ['Date', 'Nom', 'Montant', 'Catégorie', 'Fréquence'];
    const rows = depenses.map(d => [new Date().toLocaleDateString(), d.nom, d.montant, CATEGORIES[d.categorie].label, d.frequence]);
    const csvContent = "data:text/csv;charset=utf-8," + [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "mes_finances.csv");
    document.body.appendChild(link);
    link.click();
  };

  const budgetAlerts = useMemo(() => {
    return budgets.map(budget => {
      const spent = depensesMensuellesParCategorie[budget.categorie] || 0;
      const percentage = budget.limite > 0 ? (spent / budget.limite) * 100 : 0;
      if (percentage >= 80) return { ...budget, spent, percentage };
      return null;
    }).filter((b): b is NonNullable<typeof b> => b !== null);
  }, [budgets, depensesMensuellesParCategorie]);

  const tooltipStyle = {
    borderRadius: '12px', 
    border: 'none', 
    boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.3)',
    backgroundColor: currentTheme.isDark ? '#1e293b' : '#fff',
    color: currentTheme.isDark ? '#f8fafc' : '#0f172a'
  };

  return (
    <div className="space-y-8 animate-fadeIn pb-12">
      {/* Actions Bar (Export) */}
      <div className="flex justify-end">
        {isCsvUnlocked ? (
          <Button variant="outline" size="sm" onClick={exportCSV} className="flex items-center gap-2">
            <FileDown className="w-4 h-4"/> Exporter CSV
          </Button>
        ) : (
          <div className="group relative">
            <Button variant="outline" size="sm" disabled className="flex items-center gap-2 opacity-60 cursor-not-allowed">
              <Lock className="w-3 h-3"/> Export CSV
            </Button>
            <div className="absolute top-full right-0 mt-2 w-48 p-2 bg-slate-800 text-white text-xs rounded shadow-xl hidden group-hover:block z-50 text-center">
              Débloquez au Niveau 2 du Pass (Gratuit)
            </div>
          </div>
        )}
      </div>

      {/* Alertes */}
      {budgetAlerts.length > 0 && (
        <Card className="border-amber-200/50 bg-amber-50/80 dark:bg-amber-900/20">
          <CardContent className="p-4 flex flex-col gap-2">
            <div className="flex items-center gap-2 text-amber-800 dark:text-amber-400 font-bold mb-2">
              <AlertTriangle className="w-5 h-5"/> Alertes Budgétaires
            </div>
            {budgetAlerts.map(alert => (
              <div key={alert.categorie} className="flex items-center justify-between text-sm p-2 bg-white/50 dark:bg-black/20 rounded-lg border border-amber-100/50">
                <span className="dark:text-amber-100">{CATEGORIES[alert.categorie].label}</span>
                <Badge variant={alert.percentage > 100 ? "destructive" : "secondary"}>
                  {alert.percentage.toFixed(0)}% ({formaterMontant(alert.spent)})
                </Badge>
              </div>
            ))}
          </CardContent>
        </Card>
      )}

      {/* Hero Card */}
      <div className={`relative overflow-hidden rounded-3xl p-8 shadow-2xl transform hover:scale-[1.01] transition-all duration-500 ${cashFlow >= 0 ? 'bg-gradient-to-br from-emerald-500 via-green-500 to-teal-500' : 'bg-gradient-to-br from-amber-500 via-orange-500 to-red-500'}`}>
        <div className="absolute inset-0 bg-black/10"></div>
        <div className="absolute inset-0 bg-gradient-to-r from-white/0 via-white/10 to-white/0 opacity-50 animate-pulse"></div>
        <div className="relative flex flex-col md:flex-row items-center justify-between gap-8">
          <div className="text-center md:text-left">
            <div className="flex items-center justify-center md:justify-start gap-2 text-white/90 text-sm mb-2 font-medium uppercase tracking-wider">
              <Flame className="w-4 h-4" />Cash Flow Net
            </div>
            <div className="text-5xl md:text-7xl font-bold text-white mb-4 tracking-tight">
              {formaterMontant(cashFlow)}
            </div>
            <Badge className="bg-white/20 text-white border-none backdrop-blur-md px-4 py-1 text-sm font-normal">
              {cashFlow >= 0 ? 'Situation saine' : 'Déficit mensuel'}
            </Badge>
          </div>
          
          <div className="relative bg-white/10 backdrop-blur-xl p-8 rounded-3xl border border-white/20 text-center min-w-[240px]">
            <div className="text-white/80 text-sm mb-2 font-medium">Score de Santé</div>
            <div className="flex items-baseline justify-center gap-1 mb-3">
              <span className="text-6xl font-bold text-white">{scoreSante}</span>
              <span className="text-xl text-white/60">/100</span>
            </div>
            <div className="flex justify-center gap-1">
              {[...Array(5)].map((_, i) => (
                <Star key={i} className={`w-5 h-5 ${i < Math.floor(scoreSante / 20) ? 'text-yellow-300 fill-yellow-300' : 'text-white/20'}`} />
              ))}
            </div>
          </div>
        </div>
      </div>

      {/* Stats Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <StatCard label="Revenus" value={formaterMontant(totalRevenusMensuel)} icon={TrendingUp} gradient="from-emerald-500 to-teal-500" bg="from-emerald-50 to-teal-50" count={`${revenus.length} sources`} />
        <StatCard label="Dépenses" value={formaterMontant(totalDepensesMensuel)} icon={TrendingDown} gradient="from-red-500 to-pink-500" bg="from-red-50 to-pink-50" count={`${depenses.length} dépenses`} />
        <StatCard label="Patrimoine" value={formaterMontant(patrimoineNet)} icon={Wallet} gradient="from-indigo-500 to-purple-500" bg="from-indigo-50 to-purple-50" count={`${actifs.length} actifs`} />
        <StatCard label="Objectifs" value={objectifs.length.toString()} icon={Target} gradient="from-purple-500 to-pink-500" bg="from-purple-50 to-pink-50" count="En cours" />
      </div>

      {/* Charts Section */}
      {(depenses.length > 0 || revenus.length > 0) && (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <Card className="lg:col-span-1">
            <CardHeader>
              <CardTitle>Répartition</CardTitle>
            </CardHeader>
            <CardContent>
              {donneesParCategorie.length > 0 ? (
                <div className="h-[250px] w-full">
                  <ResponsiveContainer width="100%" height="100%">
                    <PieChart>
                      <Pie data={donneesParCategorie} cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value">
                        {donneesParCategorie.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} strokeWidth={0} />)}
                      </Pie>
                      <Tooltip formatter={(value: number) => [formaterMontant(value), "Montant"]} contentStyle={tooltipStyle} />
                    </PieChart>
                  </ResponsiveContainer>
                </div>
              ) : <div className="h-[250px] flex items-center justify-center text-slate-400">Aucune donnée</div>}
            </CardContent>
          </Card>

          <Card className="lg:col-span-2">
            <CardHeader>
              <CardTitle>Aperçu Mensuel</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="h-[250px] w-full">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart data={donneesRevenuDepenses} margin={{ top: 5, right: 20, left: 20, bottom: 5 }}>
                    <CartesianGrid strokeDasharray="3 3" stroke={currentTheme.isDark ? "#334155" : "#f1f5f9"} vertical={false} />
                    <XAxis dataKey="categorie" stroke={currentTheme.colors.chartText} tick={{fontSize: 12}} axisLine={false} tickLine={false} />
                    <YAxis stroke={currentTheme.colors.chartText} tickFormatter={(value) => `${value}€`} tick={{fontSize: 12}} axisLine={false} tickLine={false}/>
                    <Tooltip formatter={(value: number) => formaterMontant(value)} cursor={{fill: currentTheme.isDark ? '#1e293b' : '#f8fafc'}} contentStyle={tooltipStyle} />
                    <Bar dataKey="montant" radius={[6, 6, 0, 0]}>
                      {donneesRevenuDepenses.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} />)}
                    </Bar>
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Advanced Charts (Unlockable) */}
      <Card className="relative overflow-hidden">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Sparkles className="w-5 h-5 text-purple-500"/> Analyses Avancées
            {!isRadarUnlocked && <Badge variant="secondary" className="ml-2 flex items-center gap-1"><Lock className="w-3 h-3"/> Verrouillé</Badge>}
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className={`h-[300px] w-full transition-all duration-500 ${!isRadarUnlocked ? 'blur-sm opacity-50 pointer-events-none select-none' : ''}`}>
            {donneesParCategorie.length > 2 ? (
              <ResponsiveContainer width="100%" height="100%">
                <RadarChart cx="50%" cy="50%" outerRadius="80%" data={donneesParCategorie}>
                  <PolarGrid gridType="polygon" stroke={currentTheme.isDark ? "#334155" : "#e2e8f0"} />
                  <PolarAngleAxis dataKey="name" tick={{ fill: currentTheme.colors.chartText, fontSize: 12 }} />
                  <PolarRadiusAxis angle={30} domain={[0, 'auto']} tick={false} axisLine={false} />
                  <Radar name="Dépenses" dataKey="value" stroke="#8b5cf6" fill="#8b5cf6" fillOpacity={0.6} />
                  <Tooltip formatter={(value: number) => formaterMontant(value)} contentStyle={tooltipStyle} />
                </RadarChart>
              </ResponsiveContainer>
            ) : (
              <div className="h-full flex items-center justify-center text-slate-400">Ajoutez plus de catégories pour voir le radar.</div>
            )}
          </div>
          
          {!isRadarUnlocked && (
            <div className="absolute inset-0 flex flex-col items-center justify-center z-10 bg-white/10">
              <div className={cn("p-6 rounded-2xl shadow-xl text-center border max-w-sm mx-4", currentTheme.colors.card, currentTheme.colors.border)}>
                <div className="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <Lock className="w-6 h-6 text-purple-600"/>
                </div>
                <h4 className={cn("text-lg font-bold mb-2", currentTheme.colors.text)}>Contenu Elite</h4>
                <p className={cn("text-sm mb-4", currentTheme.colors.subtext)}>Atteignez le <span className="font-bold text-purple-600">Niveau 5</span> du Pass Elite pour débloquer l&apos;analyse radar de vos dépenses.</p>
                <Button disabled variant="outline">Verrouillé</Button>
              </div>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Budgets Section */}
      <Card>
        <CardHeader className="flex flex-row items-center justify-between">
          <CardTitle className="flex items-center gap-2"><PiggyBank className="w-5 h-5"/> Budgets Mensuels</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex flex-col md:flex-row gap-4 mb-6">
            <div className="relative flex-1">
              <select 
                value={nouveauBudget.categorie} 
                onChange={e => setNouveauBudget({...nouveauBudget, categorie: e.target.value})} 
                className={cn(
                  "flex h-10 w-full items-center justify-between rounded-xl border px-3 py-2 text-sm placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
                  currentTheme.colors.input,
                  currentTheme.colors.border,
                  currentTheme.colors.text
                )}
              >
                {Object.entries(CATEGORIES).map(([key, cat]) => (<option key={key} value={key}>{cat.label}</option>))}
              </select>
            </div>
            <Input 
              type="number" 
              placeholder="Limite (€)" 
              value={nouveauBudget.limite} 
              onChange={e => setNouveauBudget({...nouveauBudget, limite: e.target.value})}
              className="flex-1" 
            />
            <Button onClick={handleAjouterBudget}>Définir</Button>
          </div>
          {budgetError && <p className="text-red-500 text-sm mb-4">{budgetError}</p>}
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {budgets.map(budget => {
              const catInfo = CATEGORIES[budget.categorie];
              const spent = depensesMensuellesParCategorie[budget.categorie] || 0;
              const percentage = Math.min(100, (spent / budget.limite) * 100);
              const isWarning = percentage >= 80 && percentage < 100;
              const isDanger = percentage >= 100;

              return (
                <div key={budget.categorie} className={cn("p-4 rounded-xl border", currentTheme.colors.border, currentTheme.isDark ? 'bg-slate-800/50' : 'bg-slate-50')}>
                  <div className="flex justify-between items-center mb-2">
                    <div className={cn("flex items-center gap-2 font-medium", currentTheme.colors.text)}>
                      {isDanger && <AlertTriangle className="w-4 h-4 text-red-500" />}
                      {isWarning && <AlertCircle className="w-4 h-4 text-amber-500" />}
                      {catInfo.label}
                    </div>
                    <span className={`text-xs font-bold px-2 py-1 rounded-full ${isDanger ? 'bg-red-100 text-red-700' : isWarning ? 'bg-amber-100 text-amber-700' : 'bg-emerald-100 text-emerald-700'}`}>
                      {percentage.toFixed(0)}%
                    </span>
                  </div>
                  <div className={cn("flex justify-between text-sm mb-2", currentTheme.colors.subtext)}>
                    <span>{formaterMontant(spent)}</span>
                    <span>{formaterMontant(budget.limite)}</span>
                  </div>
                  <div className={cn("h-2 w-full rounded-full overflow-hidden", currentTheme.isDark ? "bg-slate-700" : "bg-slate-200")}>
                    <div className={`h-full rounded-full transition-all duration-500 ${isDanger ? 'bg-red-500' : isWarning ? 'bg-amber-500' : 'bg-emerald-500'}`} style={{ width: `${percentage}%` }}></div>
                  </div>
                </div>
              );
            })}
          </div>
        </CardContent>
      </Card>

      {/* Trophies Section */}
      {tropheesDeverrouilles.length > 0 && (
        <Card className="bg-gradient-to-br from-amber-50 to-yellow-50 border-amber-200 dark:from-amber-900/20 dark:to-yellow-900/20 dark:border-amber-800/30">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-amber-900 dark:text-amber-400">
              <Trophy className="w-6 h-6 text-amber-500" /> Trophées
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
              {tropheesDeverrouilles.map(trophee => (
                <div key={trophee.id} className={cn("rounded-xl p-4 shadow-sm border flex flex-col items-center text-center hover:shadow-md transition-shadow", currentTheme.colors.card, currentTheme.colors.border)}>
                  <div className="text-4xl mb-2">{trophee.nom.split(' ')[0]}</div>
                  <div className={cn("font-bold text-sm", currentTheme.colors.text)}>{trophee.nom}</div>
                  <div className={cn("text-xs", currentTheme.colors.subtext)}>{trophee.description}</div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
      )}

      {/* AI Action Button */}
      <Button 
        onClick={analyserAvecIA} 
        disabled={chargementIA} 
        className="w-full h-16 text-lg rounded-2xl shadow-xl bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 hover:scale-[1.01] transition-transform"
      >
        {chargementIA ? (
          <>
            <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin mr-3"></div> 
            Analyse en cours...
          </>
        ) : (
          <>
            <Sparkles className="w-5 h-5 mr-2" /> 
            Lancer l&apos;analyse IA 
            <ChevronRight className="w-5 h-5 ml-2" />
          </>
        )}
      </Button>
    </div>
  );
}

// ============================================================================
// FILE: app/(main)/debts/page.tsx
// ============================================================================

'use client';

import React, { useMemo, useState } from 'react';
import { TrendingDown, Info, Calculator, Zap, Shield, CreditCard, AlertTriangle } from 'lucide-react';
import type { Depense } from '@/types';
import { formaterMontant } from '@/utils/financeCalculations';
import { useTheme } from '@/context/ThemeContext';
import { useFinanceData } from '@/context/FinanceDataContext';
import { cn } from '@/lib/utils';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

interface PayoffResult {
  months: number;
  totalInterest: number;
}

export default function DebtsPage() {
  const { depenses, strategieDette, setStrategieDette } = useFinanceData();
  const { currentTheme } = useTheme();
  
  const credits = useMemo(() => depenses.filter(d => d.categorie === 'credit'), [depenses]);
  
  const [extraPayment, setExtraPayment] = useState('');
  const [comparison, setComparison] = useState<{ avalanche: PayoffResult; snowball: PayoffResult } | null>(null);
  const [error, setError] = useState('');

  // Total des dettes
  const totalDettes = credits.reduce((acc, d) => acc + (parseFloat(d.montantTotal || '0')), 0);
  const mensualitesTotales = credits.reduce((acc, d) => acc + (parseFloat(d.montant) || 0), 0);

  const dettesOptimisees = useMemo(() => {
    if (strategieDette === 'avalanche') {
      return [...credits].sort((a, b) => parseFloat(b.tauxInteret || '0') - parseFloat(a.tauxInteret || '0'));
    } else {
      return [...credits].sort((a, b) => parseFloat(a.montantTotal || '0') - parseFloat(b.montantTotal || '0'));
    }
  }, [credits, strategieDette]);

  const simulatePayoff = (
    initialDebts: Depense[], 
    extraMonthlyPayments: number[], 
    simStrategy: 'avalanche' | 'boule de neige'
  ): PayoffResult => {
    const debts = JSON.parse(JSON.stringify(initialDebts)).map((d: Depense) => ({
      ...d,
      balance: parseFloat(d.montantTotal || '0'),
      minPayment: parseFloat(d.montant || '0'),
      rate: (parseFloat(d.tauxInteret || '0') / 100) / 12,
    }));

    let months = 0;
    let totalInterest = 0;
    
    while (debts.some((d: { balance: number }) => d.balance > 0)) {
      months++;
      if (months > 1200) return { months: -1, totalInterest: -1 };

      const currentExtraPayment = extraMonthlyPayments.length > 0
        ? extraMonthlyPayments[(months - 1) % extraMonthlyPayments.length]
        : 0;

      let paidOffSnowball = 0;
      debts.forEach((d: { balance: number; rate: number; minPayment: number }) => {
        if (d.balance <= 0) {
          paidOffSnowball += d.minPayment;
        } else {
          const interest = d.balance * d.rate;
          totalInterest += interest;
          d.balance += interest;
        }
      });
      
      debts.forEach((d: { balance: number; minPayment: number }) => {
        if (d.balance > 0) {
          const payment = Math.min(d.balance, d.minPayment);
          d.balance -= payment;
        }
      });
      
      let availableExtra = currentExtraPayment + paidOffSnowball;
      const targetDebts = debts.filter((d: { balance: number }) => d.balance > 0);

      if (simStrategy === 'avalanche') {
        targetDebts.sort((a: { rate: number }, b: { rate: number }) => b.rate - a.rate);
      } else {
        targetDebts.sort((a: { balance: number }, b: { balance: number }) => a.balance - b.balance);
      }

      for (const target of targetDebts) {
        if (availableExtra > 0) {
          const extraPay = Math.min(target.balance, availableExtra);
          target.balance -= extraPay;
          availableExtra -= extraPay;
        }
      }
    }
    return { months, totalInterest };
  };

  const handleComparison = () => {
    const extraPaymentsArray = extraPayment
      .split(/[, ]+/)
      .map(s => parseFloat(s))
      .filter(n => !isNaN(n) && n > 0);
    
    if (extraPaymentsArray.length === 0) {
      setError("Veuillez entrer au moins un montant supplémentaire valide et positif.");
      return;
    }
    if (credits.length === 0) {
      setError("Aucun crédit à comparer.");
      return;
    }
    setError('');
    const avalancheResult = simulatePayoff(credits, extraPaymentsArray, 'avalanche');
    const snowballResult = simulatePayoff(credits, extraPaymentsArray, 'boule de neige');
    setComparison({ avalanche: avalancheResult, snowball: snowballResult });
  };

  const ResultCard: React.FC<{
    title: string; 
    result: PayoffResult; 
    icon: React.ElementType; 
    gradient: string;
  }> = ({ title, result, icon: Icon, gradient }) => (
    <div className={cn(
      "rounded-xl p-4 shadow-lg border",
      currentTheme.colors.card,
      currentTheme.colors.border
    )}>
      <div className="flex items-center gap-3 mb-3">
        <div className={`p-2 rounded-lg bg-gradient-to-br ${gradient}`}>
          <Icon className="w-5 h-5 text-white" />
        </div>
        <h4 className={cn("font-bold text-lg", currentTheme.colors.text)}>{title}</h4>
      </div>
      <div className={cn("space-y-2", currentTheme.colors.text)}>
        <p>
          🏁 Libéré des dettes en : {' '}
          <span className="font-bold">
            {result.months < 0 
              ? 'Erreur de calcul' 
              : `${Math.floor(result.months / 12)} ans et ${result.months % 12} mois`}
          </span>
        </p>
        <p>
          💰 Total des intérêts payés : {' '}
          <span className="font-bold">
            {result.totalInterest < 0 ? 'N/A' : formaterMontant(result.totalInterest)}
          </span>
        </p>
      </div>
    </div>
  );

  const inputClass = cn(
    "px-4 py-3 rounded-xl border-2 outline-none transition-all focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",
    currentTheme.colors.input,
    currentTheme.colors.border,
    currentTheme.colors.text
  );

  return (
    <div className="space-y-6 animate-fadeIn">
      
      {/* Résumé des dettes */}
      {credits.length > 0 && (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <Card className="overflow-hidden relative border-none bg-gradient-to-br from-red-500 to-orange-500 text-white">
            <CardContent className="p-6">
              <div className="flex items-center gap-3 mb-2">
                <CreditCard className="w-5 h-5 opacity-80" />
                <span className="text-sm font-medium opacity-80">Total des dettes</span>
              </div>
              <div className="text-3xl font-bold">{formaterMontant(totalDettes)}</div>
            </CardContent>
          </Card>

          <Card className="overflow-hidden relative border-none bg-gradient-to-br from-amber-500 to-yellow-500 text-white">
            <CardContent className="p-6">
              <div className="flex items-center gap-3 mb-2">
                <TrendingDown className="w-5 h-5 opacity-80" />
                <span className="text-sm font-medium opacity-80">Mensualités totales</span>
              </div>
              <div className="text-3xl font-bold">{formaterMontant(mensualitesTotales)}/mois</div>
            </CardContent>
          </Card>

          <Card className="overflow-hidden relative border-none bg-gradient-to-br from-indigo-500 to-purple-500 text-white">
            <CardContent className="p-6">
              <div className="flex items-center gap-3 mb-2">
                <AlertTriangle className="w-5 h-5 opacity-80" />
                <span className="text-sm font-medium opacity-80">Nombre de crédits</span>
              </div>
              <div className="text-3xl font-bold">{credits.length}</div>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Optimisation des dettes */}
      <div className={cn(
        "rounded-2xl p-6 shadow-xl border backdrop-blur-xl",
        currentTheme.colors.card,
        currentTheme.colors.border
      )}>
        <h2 className={cn("text-2xl font-bold mb-6 flex items-center gap-3", currentTheme.colors.text)}>
          <div className="p-2 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl">
            <TrendingDown className="w-6 h-6 text-white" />
          </div>
          Optimisation des Dettes
        </h2>

        {/* Sélection de stratégie */}
        <div className="mb-6">
          <div className={cn(
            "flex justify-center rounded-xl p-1",
            currentTheme.isDark ? "bg-slate-700" : "bg-gray-200"
          )}>
            <button
              onClick={() => setStrategieDette('avalanche')}
              className={cn(
                "w-1/2 py-2 px-4 rounded-lg font-semibold transition-all",
                strategieDette === 'avalanche' 
                  ? cn("shadow", currentTheme.colors.card, currentTheme.colors.text)
                  : currentTheme.colors.subtext
              )}
            >
              Avalanche (Taux élevés)
            </button>
            <button
              onClick={() => setStrategieDette('boule de neige')}
              className={cn(
                "w-1/2 py-2 px-4 rounded-lg font-semibold transition-all",
                strategieDette === 'boule de neige'
                  ? cn("shadow", currentTheme.colors.card, currentTheme.colors.text)
                  : currentTheme.colors.subtext
              )}
            >
              Boule de Neige (Petits soldes)
            </button>
          </div>
          
          <div className={cn(
            "mt-4 p-3 rounded-lg flex items-start gap-3 text-sm",
            currentTheme.isDark 
              ? "bg-indigo-900/30 border border-indigo-800/30 text-indigo-300"
              : "bg-indigo-50 border border-indigo-200 text-indigo-800"
          )}>
            <Info className="w-5 h-5 mt-0.5 flex-shrink-0" />
            {strategieDette === 'avalanche' 
              ? "La méthode Avalanche priorise les dettes avec les taux d'intérêt les plus élevés, vous faisant économiser le plus d'argent sur le long terme."
              : "La méthode Boule de Neige priorise les plus petites dettes pour obtenir des victoires rapides et rester motivé."}
          </div>
        </div>

        {/* Liste des dettes optimisées */}
        <div className="space-y-4">
          <h3 className={cn("text-lg font-semibold", currentTheme.colors.text)}>
            Ordre de remboursement suggéré :
          </h3>
          {dettesOptimisees.length === 0 && (
            <div className="flex flex-col items-center justify-center py-8">
              <CreditCard className={cn("w-12 h-12 mb-3 opacity-30", currentTheme.colors.subtext)} />
              <p className={cn("text-center", currentTheme.colors.subtext)}>
                Aucun crédit à optimiser.
              </p>
              <p className={cn("text-center text-sm", currentTheme.colors.subtext)}>
                Ajoutez des crédits dans l&apos;onglet Dépenses pour voir les optimisations.
              </p>
            </div>
          )}
          {dettesOptimisees.map((dette, index) => (
            <div
              key={dette.id}
              className={cn(
                "p-4 border rounded-xl flex items-center gap-4",
                currentTheme.colors.card,
                currentTheme.colors.border
              )}
            >
              <div className="flex-shrink-0 w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center text-xl font-bold">
                {index + 1}
              </div>
              <div className="flex-grow">
                <p className={cn("font-bold", currentTheme.colors.text)}>{dette.nom}</p>
                <div className={cn("text-sm flex flex-wrap gap-x-2", currentTheme.colors.subtext)}>
                  <span>Mensualité: {formaterMontant(parseFloat(dette.montant))}</span>
                  <span>|</span>
                  <span>Total restant: {formaterMontant(parseFloat(dette.montantTotal || '0'))}</span>
                  <span>|</span>
                  <span>Taux: {dette.tauxInteret || 'N/A'}%</span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
      
      {/* Comparateur de stratégies */}
      <div className={cn(
        "rounded-2xl p-6 shadow-xl border backdrop-blur-xl",
        currentTheme.colors.card,
        currentTheme.colors.border
      )}>
        <h3 className={cn("text-xl font-bold mb-4 flex items-center gap-2", currentTheme.colors.text)}>
          <Calculator className="w-5 h-5" /> Comparateur de Stratégies
        </h3>
        <div className="flex flex-col sm:flex-row gap-4">
          <input
            type="text"
            value={extraPayment}
            onChange={(e) => setExtraPayment(e.target.value)}
            placeholder="€ extra / mois (ex: 100, 150, 200)"
            className={cn("flex-grow", inputClass)}
          />
          <button
            onClick={handleComparison}
            className="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold hover:opacity-90 shadow-lg transition-all flex items-center justify-center gap-2"
          >
            Comparer
          </button>
        </div>
        {error && <p className="text-red-500 text-sm mt-2">{error}</p>}
        
        {comparison && (
          <div className="mt-6 animate-fadeIn">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <ResultCard 
                title="Stratégie Avalanche" 
                result={comparison.avalanche} 
                icon={Zap} 
                gradient="from-red-500 to-pink-500" 
              />
              <ResultCard 
                title="Stratégie Boule de Neige" 
                result={comparison.snowball} 
                icon={Shield} 
                gradient="from-emerald-500 to-teal-500" 
              />
            </div>
            {comparison.avalanche.totalInterest >= 0 && 
             comparison.snowball.totalInterest >= 0 && 
             comparison.snowball.totalInterest > comparison.avalanche.totalInterest && (
              <div className={cn(
                "mt-4 p-3 rounded-lg text-sm text-center",
                currentTheme.isDark 
                  ? "bg-green-900/30 border border-green-800/30 text-green-300"
                  : "bg-green-50 border border-green-200 text-green-800"
              )}>
                L&apos;Avalanche vous fait économiser{' '}
                <span className="font-bold">
                  {formaterMontant(comparison.snowball.totalInterest - comparison.avalanche.totalInterest)}
                </span>{' '}
                d&apos;intérêts !
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}

// ============================================================================
// FILE: app/(main)/goals/page.tsx
// ============================================================================

'use client';

import React, { useState } from 'react';
import { Trash2, Target } from 'lucide-react'; // PlusCircle and AlertTriangle were unused in render
import type { Objectif } from '@/types';
import { formaterMontant } from '@/utils/financeCalculations';
import { CADEAUX_OBJECTIFS } from '@/constants';
import { useTheme } from '@/context/ThemeContext';
import { useFinanceData } from '@/context/FinanceDataContext';
import { cn } from '@/lib/utils';
import { Empty } from '@/components/ui/empty';
import { AddGoalDialog } from '@/components/goals/add-goal-dialog';

export default function GoalsPage() {
  const { objectifs, setObjectifs } = useFinanceData();
  const [nouvelObjectif, setNouvelObjectif] = useState({ nom: '', montantCible: '', montantActuel: '0' });
  const [error, setError] = useState('');
  const [deleteConfirmId, setDeleteConfirmId] = useState<number | null>(null);
  const { currentTheme } = useTheme();

  const ajouterObjectif = () => {
    const cible = parseFloat(nouvelObjectif.montantCible);
    const actuel = parseFloat(nouvelObjectif.montantActuel);

    if (!nouvelObjectif.nom.trim()) {
      setError("Le nom de l'objectif est requis.");
      return;
    }
    if (isNaN(cible) || cible <= 0) {
      setError("Le montant cible doit être un nombre positif.");
      return;
    }
    if (isNaN(actuel) || actuel < 0) {
      setError("Le montant actuel est invalide.");
      return;
    }
    if (actuel > cible) {
      setError("Le montant actuel ne peut pas dépasser le montant cible.");
      return;
    }
    setError('');
    setObjectifs([...objectifs, { ...nouvelObjectif, id: Date.now() }]);
    setNouvelObjectif({ nom: '', montantCible: '', montantActuel: '0' });
  };

  const confirmerSuppression = (id: number) => {
    setDeleteConfirmId(id);
  };

  // Note: These functions were defined but not fully utilized in the UI (modal logic missing),
  // but kept to maintain original logic.
  const annulerSuppression = () => {
    setDeleteConfirmId(null);
  };

  const executerSuppression = () => {
    if (deleteConfirmId !== null) {
      setObjectifs(objectifs.filter(o => o.id !== deleteConfirmId));
      setDeleteConfirmId(null);
    }
  };

  const mettreAJourObjectif = (id: number, nouveauMontant: string) => {
    const obj = objectifs.find(o => o.id === id);
    if (!obj) return;
    
    const montantNum = parseFloat(nouveauMontant);
    if (isNaN(montantNum) || montantNum < 0 || montantNum > parseFloat(obj.montantCible)) {
      return;
    }
    setObjectifs(objectifs.map(o => o.id === id ? { ...o, montantActuel: nouveauMontant } : o));
  };

  return (
    <div className="flex flex-col gap-6">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-semibold leading-none tracking-tight font-roboto">
          Financial Goals
        </h1>
        <AddGoalDialog />
      </div>

      {/* FIXED: Added ternary start here */}
      {objectifs.length > 0 ? (
        <div className={cn(
          "rounded-2xl p-6 shadow-xl border backdrop-blur-xl",
          currentTheme.colors.card,
          currentTheme.colors.border
        )}>
          <h3 className={cn("text-xl font-bold mb-4", currentTheme.colors.text)}>
            Mes objectifs ({objectifs.length})
          </h3>
          <div className="space-y-4">
            {objectifs.map(obj => {
              const montantActuel = parseFloat(obj.montantActuel) || 0;
              const montantCible = parseFloat(obj.montantCible) || 1;
              const progression = Math.min(100, (montantActuel / montantCible) * 100);
              const cadeauxDebloques = CADEAUX_OBJECTIFS.filter(cadeau => progression >= cadeau.pourcentage);

              return (
                <div
                  key={obj.id}
                  className={cn(
                    "p-4 rounded-xl border",
                    currentTheme.colors.border,
                    currentTheme.isDark ? "bg-slate-800/40" : "bg-gray-50"
                  )}
                >
                  <div className="flex items-center justify-between mb-2">
                    <span className={cn("font-bold", currentTheme.colors.text)}>{obj.nom}</span>
                    {/* Direct delete for simplicity based on provided UI, can be swapped for Confirm Dialog */}
                    <button
                      onClick={() => executerSuppression()} 
                      onMouseDown={() => confirmerSuppression(obj.id)}
                      className="p-2 text-red-600 rounded-lg hover:bg-red-100 transition-colors"
                    >
                      <Trash2 className="w-4 h-4" />
                    </button>
                  </div>
                  <div className={cn("text-sm mb-2", currentTheme.colors.subtext)}>
                    {formaterMontant(montantActuel)} / {formaterMontant(montantCible)}
                  </div>
                  <div className={cn("w-full rounded-full h-4", currentTheme.isDark ? "bg-slate-700" : "bg-gray-200")}>
                    <div
                      className="bg-gradient-to-r from-purple-500 to-pink-500 h-4 rounded-full text-center text-white text-xs font-bold flex items-center justify-center transition-all duration-500"
                      style={{ width: `${Math.max(progression, 10)}%` }}
                    >
                      {progression.toFixed(0)}%
                    </div>
                  </div>

                  {/* Récompenses débloquées */}
                  {cadeauxDebloques.length > 0 && (
                    <div className={cn("mt-4 pt-4 border-t", currentTheme.colors.border)}>
                      <h4 className={cn("font-semibold mb-2", currentTheme.colors.text)}>
                        Récompenses débloquées
                      </h4>
                      <div className="flex flex-wrap gap-4">
                        {cadeauxDebloques.map(cadeau => {
                          const Icon = cadeau.icon;
                          return (
                            <div
                              key={cadeau.nom}
                              className={`relative overflow-hidden flex-1 min-w-[150px] p-4 rounded-xl bg-gradient-to-br ${cadeau.gradient} text-white shadow-lg flex flex-col items-center justify-center`}
                            >
                              <div className="absolute inset-0 flex items-center justify-center opacity-10">
                                <Icon className="w-24 h-24" />
                              </div>
                              <div className="relative text-center">
                                <div className="flex justify-center mb-2">
                                  <Icon className="w-10 h-10" />
                                </div>
                                <div className="font-bold text-lg">{cadeau.nom}</div>
                                <p className="text-xs text-white/90">{cadeau.description}</p>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}

                  {/* Mise à jour du montant */}
                  <div className="mt-4">
                    <label className={cn("text-xs", currentTheme.colors.subtext)}>
                      Mettre à jour le montant actuel:
                    </label>
                    <input
                      type="number"
                      value={obj.montantActuel}
                      onChange={(e) => mettreAJourObjectif(obj.id, e.target.value)}
                      className={cn(
                        "w-full mt-1 px-3 py-2 text-sm rounded-lg border outline-none transition-all focus:border-purple-500",
                        currentTheme.colors.input,
                        currentTheme.colors.border,
                        currentTheme.colors.text
                      )}
                    />
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      ) : (
        <Empty>
          <Target className="h-12 w-12 text-muted-foreground" />
          <div className="text-center">
            <h3 className="text-lg font-semibold font-roboto">No Goals Yet</h3>
            <p className="text-muted-foreground text-sm mt-1">
              Setting goals is the first step to financial freedom.
            </p>
          </div>
        </Empty>
      )}
    </div>
  );
}

// ============================================================================
// FILE: app/(main)/investments/page.tsx
// ============================================================================

'use client';

import React, { useState, useMemo } from 'react';
import { 
  XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
  AreaChart, Area, PieChart, Pie, Cell 
} from 'recharts';
import { 
  TrendingUp, PlusCircle, Bitcoin, Briefcase, Trash2, Activity
} from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import type { Investment, InvestmentType } from '@/types';
import { cn } from '@/lib/utils';
import { useTheme } from '@/context/ThemeContext';
import { useFinanceData } from '@/context/FinanceDataContext';
import { formaterMontant } from '@/utils/financeCalculations';

const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8'];

export default function InvestmentsPage() {
  const { currentTheme } = useTheme();
  const { investissements, setInvestissements } = useFinanceData();
  
  const [newAsset, setNewAsset] = useState<Partial<Investment>>({
    symbol: '', name: '', quantity: 0, averageBuyPrice: 0, currentPrice: 0, type: 'stock'
  });
  const [isFormOpen, setIsFormOpen] = useState(false);

  // --- CALCULS ---
  
  const portfolioMetrics = useMemo(() => {
    let totalValue = 0;
    let totalCost = 0;
    const allocation: Record<string, number> = {};

    investissements.forEach(inv => {
      const value = inv.quantity * inv.currentPrice;
      const cost = inv.quantity * inv.averageBuyPrice;
      totalValue += value;
      totalCost += cost;
      allocation[inv.type] = (allocation[inv.type] || 0) + value;
    });

    const plValue = totalValue - totalCost;
    const plPercent = totalCost > 0 ? (plValue / totalCost) * 100 : 0;
    const dailyVarPercent = investissements.length > 0 ? (Math.random() * 3) - 1.5 : 0;
    const dailyVarValue = totalValue * (dailyVarPercent / 100);

    return { totalValue, totalCost, plValue, plPercent, dailyVarValue, dailyVarPercent, allocation };
  }, [investissements]);

  const allocationData = Object.entries(portfolioMetrics.allocation).map(([key, value]) => ({
    name: key.charAt(0).toUpperCase() + key.slice(1),
    value
  }));

  // Mock History Data for Benchmark Chart
  const historyData = useMemo(() => {
    if (portfolioMetrics.totalValue === 0) return [];
    const months = ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'];
    const data = [];
    let currentVal = portfolioMetrics.totalCost;
    let sp500Val = portfolioMetrics.totalCost;

    for (let i = 0; i < 12; i++) {
      const change = (Math.random() * 10 - 4) / 100;
      const spChange = (Math.random() * 6 - 2) / 100;
      
      currentVal = currentVal * (1 + change);
      sp500Val = sp500Val * (1 + spChange);

      data.push({
        name: months[i],
        Portfolio: currentVal,
        SP500: sp500Val
      });
    }
    data[data.length - 1].Portfolio = portfolioMetrics.totalValue;
    
    return data;
  }, [portfolioMetrics.totalCost, portfolioMetrics.totalValue]);

  // --- HANDLERS ---

  const handleAddAsset = () => {
    if (!newAsset.symbol || !newAsset.name) return;
    const asset: Investment = {
      id: Date.now().toString(),
      symbol: newAsset.symbol.toUpperCase(),
      name: newAsset.name,
      type: newAsset.type as InvestmentType,
      quantity: Number(newAsset.quantity),
      averageBuyPrice: Number(newAsset.averageBuyPrice),
      currentPrice: Number(newAsset.currentPrice)
    };
    setInvestissements([...investissements, asset]);
    setNewAsset({ symbol: '', name: '', quantity: 0, averageBuyPrice: 0, currentPrice: 0, type: 'stock' });
    setIsFormOpen(false);
  };

  const handleDelete = (id: string) => {
    setInvestissements(prev => prev.filter(i => i.id !== id));
  };

  const inputClass = cn(
    "w-full h-10 rounded-xl border px-3 text-sm outline-none transition-all focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",
    currentTheme.colors.input,
    currentTheme.colors.border,
    currentTheme.colors.text
  );

  return (
    <div className="space-y-8 animate-fadeIn pb-12">
      
      {/* Hero Section - Portfolio Overview */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {/* Total Value */}
        <Card className="md:col-span-2 overflow-hidden relative border-none bg-gradient-to-br from-slate-900 to-slate-800 text-white">
          <div className="absolute top-0 right-0 p-32 bg-blue-500/10 rounded-full blur-3xl"></div>
          <div className="absolute bottom-0 left-0 p-20 bg-purple-500/10 rounded-full blur-3xl"></div>
          <CardContent className="relative z-10 p-8">
            <div className="flex justify-between items-start">
              <div>
                <div className="text-slate-400 text-sm font-medium mb-1 uppercase tracking-wider">Valeur Totale</div>
                <h2 className="text-5xl font-bold mb-4">{formaterMontant(portfolioMetrics.totalValue)}</h2>
                <div className="flex items-center gap-4 flex-wrap">
                  <Badge className={`${portfolioMetrics.plValue >= 0 ? 'bg-emerald-500/20 text-emerald-300' : 'bg-red-500/20 text-red-300'} border-none px-3 py-1`}>
                    {portfolioMetrics.plValue >= 0 ? '+' : ''}{formaterMontant(portfolioMetrics.plValue)} ({portfolioMetrics.plPercent.toFixed(2)}%)
                    <span className="ml-1 text-xs opacity-70">Total</span>
                  </Badge>
                  <Badge className={`${portfolioMetrics.dailyVarValue >= 0 ? 'bg-emerald-500/10 text-emerald-400' : 'bg-red-500/10 text-red-400'} border-none px-3 py-1`}>
                    {portfolioMetrics.dailyVarValue >= 0 ? '+' : ''}{formaterMontant(portfolioMetrics.dailyVarValue)} (24h)
                  </Badge>
                </div>
              </div>
              <div className="p-4 bg-white/10 rounded-2xl backdrop-blur-md">
                <Activity className="w-8 h-8 text-blue-400" />
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Allocation Mini Chart */}
        <Card className="flex flex-col justify-center items-center">
          <CardHeader className="pb-2">
            <CardTitle className="text-base">Allocation</CardTitle>
          </CardHeader>
          <CardContent className="w-full h-[150px]">
            {investissements.length > 0 ? (
              <ResponsiveContainer width="100%" height="100%">
                <PieChart>
                  <Pie data={allocationData} innerRadius={40} outerRadius={60} paddingAngle={5} dataKey="value">
                    {allocationData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip 
                    formatter={(val) => formaterMontant(Number(val))} 
                    contentStyle={{borderRadius: '8px', border: 'none', background: '#1e293b', color: '#fff'}} 
                  />
                </PieChart>
              </ResponsiveContainer>
            ) : (
              <div className="flex items-center justify-center h-full text-slate-400 text-xs">Aucune donnée</div>
            )}
          </CardContent>
        </Card>
      </div>

      {/* Chart Section: Portfolio vs Benchmark */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <TrendingUp className="w-5 h-5 text-blue-500"/> Performance vs Marché (S&P 500)
          </CardTitle>
        </CardHeader>
        <CardContent className="h-[300px]">
          {investissements.length > 0 ? (
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={historyData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>
                <defs>
                  <linearGradient id="colorPort" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#8884d8" stopOpacity={0.3}/>
                    <stop offset="95%" stopColor="#8884d8" stopOpacity={0}/>
                  </linearGradient>
                  <linearGradient id="colorSP" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#82ca9d" stopOpacity={0.1}/>
                    <stop offset="95%" stopColor="#82ca9d" stopOpacity={0}/>
                  </linearGradient>
                </defs>
                <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: currentTheme.colors.chartText, fontSize: 12}} />
                <YAxis axisLine={false} tickLine={false} tick={{fill: currentTheme.colors.chartText, fontSize: 12}} tickFormatter={(val) => `${val/1000}k€`} />
                <CartesianGrid strokeDasharray="3 3" stroke={currentTheme.isDark ? "#334155" : "#f1f5f9"} vertical={false} />
                <Tooltip 
                  contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)'}} 
                  formatter={(val) => formaterMontant(Number(val))}
                />
                <Area type="monotone" dataKey="Portfolio" stroke="#8884d8" fillOpacity={1} fill="url(#colorPort)" strokeWidth={2} />
                <Area type="monotone" dataKey="SP500" stroke="#82ca9d" fillOpacity={1} fill="url(#colorSP)" strokeWidth={2} strokeDasharray="5 5" />
              </AreaChart>
            </ResponsiveContainer>
          ) : (
            <div className="flex flex-col items-center justify-center h-full text-slate-400">
              <TrendingUp className="w-12 h-12 mb-2 opacity-20"/>
              <p>Ajoutez des actifs pour voir la comparaison</p>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Assets List & Add Form */}
      <Card>
        <CardHeader className="flex flex-row items-center justify-between">
          <CardTitle>Mes Actifs</CardTitle>
          <Button 
            onClick={() => setIsFormOpen(!isFormOpen)} 
            size="sm" 
            className="bg-gradient-to-r from-indigo-600 to-purple-600 hover:opacity-90"
          >
            {isFormOpen ? 'Fermer' : <><PlusCircle className="w-4 h-4 mr-2"/> Ajouter un actif</>}
          </Button>
        </CardHeader>
        <CardContent>
          {/* Add Form */}
          {isFormOpen && (
            <div className={cn(
              "mb-6 p-4 rounded-xl border animate-fadeIn",
              currentTheme.colors.card,
              currentTheme.colors.border
            )}>
              <div className="grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
                <div className="md:col-span-1">
                  <label className={cn("text-xs font-medium mb-1 block", currentTheme.colors.subtext)}>Type</label>
                  <select 
                    className={inputClass}
                    value={newAsset.type}
                    onChange={(e) => setNewAsset({...newAsset, type: e.target.value as InvestmentType})}
                  >
                    <option value="stock">Action</option>
                    <option value="etf">ETF</option>
                    <option value="crypto">Crypto</option>
                  </select>
                </div>
                <div className="md:col-span-1">
                  <label className={cn("text-xs font-medium mb-1 block", currentTheme.colors.subtext)}>Symbole</label>
                  <Input 
                    placeholder="AAPL" 
                    value={newAsset.symbol} 
                    onChange={(e) => setNewAsset({...newAsset, symbol: e.target.value})} 
                  />
                </div>
                <div className="md:col-span-1">
                  <label className={cn("text-xs font-medium mb-1 block", currentTheme.colors.subtext)}>Nom</label>
                  <Input 
                    placeholder="Apple Inc." 
                    value={newAsset.name} 
                    onChange={(e) => setNewAsset({...newAsset, name: e.target.value})} 
                  />
                </div>
                <div className="md:col-span-1">
                  <label className={cn("text-xs font-medium mb-1 block", currentTheme.colors.subtext)}>Quantité</label>
                  <Input 
                    type="number" 
                    placeholder="10" 
                    value={newAsset.quantity || ''} 
                    onChange={(e) => setNewAsset({...newAsset, quantity: Number(e.target.value)})} 
                  />
                </div>
                <div className="md:col-span-1">
                  <label className={cn("text-xs font-medium mb-1 block", currentTheme.colors.subtext)}>PRU (€)</label>
                  <Input 
                    type="number" 
                    placeholder="150" 
                    value={newAsset.averageBuyPrice || ''} 
                    onChange={(e) => setNewAsset({...newAsset, averageBuyPrice: Number(e.target.value)})} 
                  />
                </div>
                <div className="md:col-span-1">
                  <label className={cn("text-xs font-medium mb-1 block", currentTheme.colors.subtext)}>Prix actuel</label>
                  <Input 
                    type="number" 
                    placeholder="175" 
                    value={newAsset.currentPrice || ''} 
                    onChange={(e) => setNewAsset({...newAsset, currentPrice: Number(e.target.value)})} 
                  />
                </div>
              </div>
              <div className="mt-4">
                <Button onClick={handleAddAsset} className="w-full bg-gradient-to-r from-indigo-600 to-purple-600">
                  Ajouter l&apos;actif
                </Button>
                <p className={cn("text-[10px] mt-2 text-center", currentTheme.colors.subtext)}>
                  Dans cette démo, entrez le prix actuel manuellement.
                </p>
              </div>
            </div>
          )}

          {/* List */}
          <div className="space-y-3">
            {investissements.length === 0 && (
              <p className={cn("text-center py-8", currentTheme.colors.subtext)}>
                Aucun investissement. Cliquez sur &quot;Ajouter un actif&quot; pour commencer.
              </p>
            )}
            {investissements.map((inv) => {
              const val = inv.quantity * inv.currentPrice;
              const gain = val - (inv.quantity * inv.averageBuyPrice);
              const gainPercent = inv.quantity * inv.averageBuyPrice > 0 
                ? ((gain / (inv.quantity * inv.averageBuyPrice)) * 100) 
                : 0;

              return (
                <div 
                  key={inv.id} 
                  className={cn(
                    "flex items-center justify-between p-4 rounded-xl border transition-all hover:shadow-md",
                    currentTheme.isDark ? "bg-slate-800/50" : "bg-white/50",
                    currentTheme.colors.border
                  )}
                >
                  <div className="flex items-center gap-4">
                    <div className={`p-3 rounded-xl ${inv.type === 'crypto' ? 'bg-orange-100 text-orange-600' : 'bg-blue-100 text-blue-600'}`}>
                      {inv.type === 'crypto' ? <Bitcoin className="w-5 h-5"/> : <Briefcase className="w-5 h-5"/>}
                    </div>
                    <div>
                      <div className={cn("font-bold", currentTheme.colors.text)}>{inv.symbol}</div>
                      <div className={cn("text-xs", currentTheme.colors.subtext)}>{inv.name} • {inv.quantity} unités</div>
                    </div>
                  </div>
                  
                  <div className="flex items-center gap-6">
                    <div className="text-right hidden sm:block">
                      <div className={cn("text-xs", currentTheme.colors.subtext)}>Prix: {formaterMontant(inv.currentPrice)}</div>
                      <div className={cn("text-xs", currentTheme.colors.subtext)}>PRU: {formaterMontant(inv.averageBuyPrice)}</div>
                    </div>
                    <div className="text-right min-w-[100px]">
                      <div className={cn("font-bold", currentTheme.colors.text)}>{formaterMontant(val)}</div>
                      <div className={`text-xs font-medium ${gain >= 0 ? 'text-emerald-500' : 'text-red-500'}`}>
                        {gain >= 0 ? '+' : ''}{gainPercent.toFixed(2)}%
                      </div>
                    </div>
                    <Button 
                      size="icon" 
                      variant="ghost" 
                      onClick={() => handleDelete(inv.id)} 
                      className="text-slate-400 hover:text-red-500"
                    >
                      <Trash2 className="w-4 h-4" />
                    </Button>
                  </div>
                </div>
              );
            })}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

// ============================================================================
// FILE: app/(main)/layout.tsx
// ============================================================================

import { redirect } from "next/navigation";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import { SidebarProvider, SidebarInset, SidebarRail } from "@/components/ui/sidebar";
import { Sidebar } from "@/components/layout/sidebar";
import { HeaderMain } from "@/components/layout/header-main";
import { FinanceDataProvider } from '@/context/FinanceDataContext';
import { ThemeProvider } from '@/context/ThemeContext';

export default async function MainLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const session = await getServerSession(authOptions);

  if (!session?.user) {
    redirect("/login");
  }

  return (
    <ThemeProvider>
      <FinanceDataProvider>
        <SidebarProvider>
          <div className="flex min-h-screen w-full">
            <Sidebar user={session.user} />
            <SidebarRail />
            <SidebarInset>
              <HeaderMain user={session.user} />
              <main className="flex-1 p-4 sm:px-6 sm:py-0">{children}</main>
            </SidebarInset>
          </div>
        </SidebarProvider>
      </FinanceDataProvider>
    </ThemeProvider>
  );
}

// ============================================================================
// FILE: app/(main)/pass-elite/page.tsx
// ============================================================================

'use client';

import React, { useState } from 'react';
import { Crown, Lock, Check, Gift, Coins, Sparkles, Star } from 'lucide-react';
import { SEASON_LEVELS } from '@/constants';
import type { Reward } from '@/types';
import { useTheme } from '@/context/ThemeContext';
import { useFinanceData } from '@/context/FinanceDataContext';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';

export default function PassElitePage() {
  const { gameState, setGameState } = useFinanceData();
  const { currentTheme } = useTheme();
  const [showPremiumModal, setShowPremiumModal] = useState(false);

  const nextLevel = SEASON_LEVELS.find(l => l.level === gameState.level + 1) || SEASON_LEVELS[SEASON_LEVELS.length - 1];
  const progressPercent = Math.min(100, (gameState.xp / nextLevel.xpRequired) * 100);

  const handleClaim = (reward: Reward) => {
    if (gameState.claimedRewards.includes(reward.id)) return;
    
    let newCoins = gameState.coins;
    const newUnlockedFeatures = [...gameState.unlockedFeatures];

    if (reward.type === 'coin') {
      newCoins += Number(reward.value);
    } else if (reward.type === 'feature') {
      newUnlockedFeatures.push(String(reward.value));
    }

    setGameState(prev => ({
      ...prev,
      coins: newCoins,
      unlockedFeatures: newUnlockedFeatures,
      claimedRewards: [...prev.claimedRewards, reward.id]
    }));
  };

  const handleBuyPremium = () => {
    setTimeout(() => {
      setGameState(prev => ({ ...prev, isPremium: true }));
      setShowPremiumModal(false);
    }, 1000);
  };

  const renderRewardButton = (reward: Reward, isUnlocked: boolean) => {
    const isClaimed = gameState.claimedRewards.includes(reward.id);
    const isFeature = reward.type === 'feature';

    return (
      <div className="relative">
        <Button 
          size="sm" 
          variant={isClaimed ? "outline" : isFeature ? "default" : "secondary"}
          disabled={!isUnlocked || isClaimed}
          onClick={() => handleClaim(reward)}
          className={cn(
            "h-8 text-xs px-3",
            !isUnlocked && 'opacity-50 cursor-not-allowed',
            isFeature && !isClaimed && 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white border-none hover:opacity-90 shadow-md'
          )}
        >
          {isClaimed && <Check className="w-3 h-3 mr-1"/>}
          {isClaimed ? 'Reçu' : isFeature ? 'Débloquer' : 'Réclamer'}
        </Button>
        {isFeature && !isClaimed && isUnlocked && (
          <span className="absolute -top-2 -right-2 flex h-3 w-3">
            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-sky-400 opacity-75"></span>
            <span className="relative inline-flex rounded-full h-3 w-3 bg-sky-500"></span>
          </span>
        )}
      </div>
    );
  };

  return (
    <div className="space-y-8 animate-fadeIn pb-12">
      
      {/* Header Section */}
      <div className="relative overflow-hidden rounded-3xl p-8 shadow-2xl bg-gradient-to-br from-indigo-900 to-slate-900 text-white">
        <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
        <div className="relative z-10 flex flex-col md:flex-row items-center justify-between gap-8">
          <div className="text-center md:text-left">
            <div className="flex items-center gap-2 mb-2 justify-center md:justify-start">
              <Badge className="bg-amber-500 text-black font-bold border-none">
                <Crown className="w-3 h-3 mr-1"/> SAISON 1
              </Badge>
              <span className="text-slate-300 text-sm">Fin dans 24 jours</span>
            </div>
            <h2 className="text-4xl font-bold mb-2">Pass Finance Elite</h2>
            <p className="text-indigo-200 max-w-md">
              Complétez des quêtes, gagnez de l&apos;XP et débloquez des{' '}
              <strong className="text-white">fonctionnalités exclusives</strong>{' '}
              (Export CSV, Graphiques Avancés) pour booster votre gestion.
            </p>
          </div>
          
          <div className="bg-white/10 backdrop-blur-md p-6 rounded-2xl border border-white/20 min-w-[200px] text-center">
            <div className="text-xs text-indigo-200 uppercase tracking-wider font-semibold mb-1">Niveau Actuel</div>
            <div className="text-5xl font-black text-white mb-2">{gameState.level}</div>
            <div className="text-xs text-indigo-200 mb-2">{gameState.xp} / {nextLevel.xpRequired} XP</div>
            <div className="w-full h-3 bg-black/30 rounded-full overflow-hidden">
              <div 
                className="h-full bg-gradient-to-r from-amber-400 to-orange-500 transition-all duration-500" 
                style={{ width: `${progressPercent}%` }}
              />
            </div>
          </div>
        </div>
      </div>

      {/* Quests Section */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-1 space-y-4">
          <h3 className={cn("text-xl font-bold flex items-center gap-2", currentTheme.colors.text)}>
            <Star className="w-5 h-5 text-amber-500 fill-amber-500"/> Quêtes Quotidiennes
          </h3>
          {gameState.quests.map(quest => (
            <Card 
              key={quest.id} 
              className={cn(
                "border-l-4",
                quest.completed 
                  ? "border-l-emerald-500 bg-emerald-50 dark:bg-emerald-900/20" 
                  : "border-l-indigo-500"
              )}
            >
              <CardContent className="p-4">
                <div className="flex justify-between items-start mb-2">
                  <h4 className={cn(
                    "font-bold",
                    quest.completed ? "text-emerald-800 dark:text-emerald-400" : currentTheme.colors.text
                  )}>
                    {quest.title}
                  </h4>
                  {quest.completed && <Check className="w-5 h-5 text-emerald-600" />}
                </div>
                <p className={cn("text-sm mb-3", currentTheme.colors.subtext)}>{quest.description}</p>
                <div className="flex items-center justify-between text-xs font-medium">
                  <div className="flex gap-2">
                    <span className="bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300 px-2 py-1 rounded flex items-center gap-1">
                      <Sparkles className="w-3 h-3"/> {quest.xpReward} XP
                    </span>
                    <span className="bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300 px-2 py-1 rounded flex items-center gap-1">
                      <Coins className="w-3 h-3"/> {quest.coinReward}
                    </span>
                  </div>
                  <span className={currentTheme.colors.subtext}>{quest.progress} / {quest.target}</span>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>

        {/* The Pass Track */}
        <div className="lg:col-span-2">
          <div className="flex items-center justify-between mb-4">
            <h3 className={cn("text-xl font-bold flex items-center gap-2", currentTheme.colors.text)}>
              <Gift className="w-5 h-5 text-purple-500"/> Progression & Récompenses
            </h3>
            <div className={cn(
              "flex items-center gap-2 px-3 py-1 rounded-full shadow-sm border",
              currentTheme.colors.card,
              currentTheme.colors.border
            )}>
              <Coins className="w-4 h-4 text-amber-500" />
              <span className={cn("font-bold", currentTheme.colors.text)}>{gameState.coins}</span>
            </div>
          </div>
          
          <div className={cn(
            "rounded-2xl border shadow-xl overflow-x-auto",
            currentTheme.colors.card,
            currentTheme.colors.border
          )}>
            <div className="min-w-[800px] p-6">
              
              {/* Headers */}
              <div className="grid grid-cols-10 gap-4 mb-4 px-12">
                <div className="col-span-10 flex justify-between text-xs font-bold text-slate-400 uppercase tracking-wider">
                  <span>Débutant</span>
                  <span>Expert</span>
                  <span>Légende</span>
                </div>
              </div>

              {/* Free Track */}
              <div className="flex items-center gap-4 mb-8 relative pl-12 pr-12">
                <div className="absolute left-0 top-1/2 -translate-y-1/2 -rotate-90 font-bold text-slate-500 text-[10px] uppercase tracking-widest w-24 text-center origin-center">
                  Gratuit
                </div>
                <div className={cn(
                  "absolute left-12 right-12 top-1/2 h-2 -z-10 rounded-full",
                  currentTheme.isDark ? "bg-slate-700" : "bg-slate-200"
                )}></div>
                
                {SEASON_LEVELS.map((lvl) => {
                  const isUnlocked = gameState.level >= lvl.level;
                  const reward = lvl.freeReward;
                  const RewardIcon = reward?.icon;
                  
                  return (
                    <div key={`free-${lvl.level}`} className="flex-1 flex flex-col items-center gap-3 min-w-[60px]">
                      <div className={cn(
                        "relative group w-14 h-14 rounded-2xl flex items-center justify-center border-2 transition-all duration-300",
                        isUnlocked 
                          ? "border-emerald-500 bg-white dark:bg-slate-800 shadow-md" 
                          : "border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-700",
                        reward?.type === 'feature' && "ring-2 ring-indigo-300 ring-offset-2"
                      )}>
                        {reward && RewardIcon ? (
                          <>
                            <RewardIcon className={cn(
                              "w-6 h-6",
                              isUnlocked 
                                ? (reward.type === 'feature' ? 'text-indigo-600' : 'text-emerald-600') 
                                : 'text-slate-400'
                            )} />
                            {reward.description && (
                              <div className="absolute bottom-full mb-2 hidden group-hover:block w-32 p-2 bg-slate-800 text-white text-xs rounded-lg z-50 text-center">
                                {reward.description}
                                <div className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800"></div>
                              </div>
                            )}
                          </>
                        ) : <div className="w-2 h-2 bg-slate-300 rounded-full"></div>}
                      </div>
                      {reward && renderRewardButton(reward, isUnlocked)}
                    </div>
                  );
                })}
              </div>

              {/* Premium Track */}
              <div className="flex items-center gap-4 relative pl-12 pr-12 mt-8">
                <div className="absolute left-0 top-1/2 -translate-y-1/2 -rotate-90 font-bold text-amber-600 text-[10px] uppercase tracking-widest w-24 text-center origin-center">
                  Elite
                  {!gameState.isPremium && <Lock className="w-3 h-3 inline-block ml-1"/>}
                </div>
                <div className="absolute left-12 right-12 top-1/2 h-2 bg-gradient-to-r from-amber-200 to-orange-200 dark:from-amber-900/50 dark:to-orange-900/50 -z-10 rounded-full"></div>
                
                {SEASON_LEVELS.map((lvl) => {
                  const isUnlocked = gameState.level >= lvl.level;
                  const canClaim = isUnlocked && gameState.isPremium;
                  const reward = lvl.premiumReward;
                  const RewardIcon = reward?.icon;

                  return (
                    <div key={`prem-${lvl.level}`} className="flex-1 flex flex-col items-center gap-3 min-w-[60px]">
                      <div className={cn(
                        "relative group w-14 h-14 rounded-2xl flex items-center justify-center border-2 transition-all duration-300",
                        canClaim 
                          ? "border-amber-500 bg-amber-50 dark:bg-amber-900/30 shadow-md" 
                          : "border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-700",
                        reward?.type === 'feature' && "ring-2 ring-purple-300 ring-offset-2"
                      )}>
                        {!gameState.isPremium && (
                          <div className="absolute inset-0 bg-black/5 rounded-xl flex items-center justify-center backdrop-blur-[1px]">
                            <Lock className="w-4 h-4 text-slate-500/50"/>
                          </div>
                        )}
                        {reward && RewardIcon ? (
                          <>
                            <RewardIcon className={cn(
                              "w-6 h-6",
                              canClaim 
                                ? (reward.type === 'feature' ? 'text-purple-600' : 'text-amber-600') 
                                : 'text-slate-400'
                            )} />
                            {reward.description && (
                              <div className="absolute bottom-full mb-2 hidden group-hover:block w-32 p-2 bg-slate-800 text-white text-xs rounded-lg z-50 text-center">
                                {reward.description}
                                <div className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800"></div>
                              </div>
                            )}
                          </>
                        ) : <div className="w-2 h-2 bg-slate-300 rounded-full"></div>}
                      </div>
                      {reward && renderRewardButton(reward, canClaim)}
                      <div className="text-[10px] font-bold text-slate-400 mt-1">Niv {lvl.level}</div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>

          {/* Premium CTA */}
          {!gameState.isPremium && (
            <div className={cn(
              "mt-6 p-6 rounded-2xl border flex flex-col md:flex-row items-center justify-between gap-4",
              currentTheme.isDark 
                ? "bg-gradient-to-r from-amber-900/30 to-orange-900/30 border-amber-800/30"
                : "bg-gradient-to-r from-amber-100 to-orange-100 border-amber-200"
            )}>
              <div className="flex-1">
                <h4 className={cn(
                  "text-lg font-bold flex items-center gap-2",
                  currentTheme.isDark ? "text-amber-400" : "text-amber-900"
                )}>
                  <Crown className="w-5 h-5"/> Débloquez le Pass Elite
                </h4>
                <p className={cn(
                  "text-sm mt-1",
                  currentTheme.isDark ? "text-amber-200" : "text-amber-800"
                )}>
                  Accédez à <strong>l&apos;analyse radar</strong>, aux <strong>thèmes exclusifs</strong> (Cyberpunk, Royal) et gagnez 3x plus de pièces.
                </p>
              </div>
              <Button 
                className="bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-lg shadow-amber-500/20 whitespace-nowrap hover:opacity-90"
                onClick={() => setShowPremiumModal(true)}
              >
                Débloquer pour 9.99€
              </Button>
            </div>
          )}
        </div>
      </div>

      {/* Premium Modal */}
      {showPremiumModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fadeIn">
          <Card className="max-w-md w-full m-4 p-0 overflow-hidden">
            <div className="bg-gradient-to-r from-amber-500 to-orange-600 p-6 text-white text-center">
              <Crown className="w-12 h-12 mx-auto mb-3"/>
              <h3 className="text-2xl font-bold">Pass Elite Finance</h3>
              <p className="opacity-90">Passez au niveau supérieur</p>
            </div>
            <CardContent className="p-6 space-y-4">
              <div className={cn(
                "flex items-center gap-3 p-3 rounded-lg",
                currentTheme.isDark ? "bg-slate-800" : "bg-slate-50"
              )}>
                <div className="p-2 bg-emerald-100 dark:bg-emerald-900/50 rounded-full">
                  <Check className="w-4 h-4 text-emerald-600"/>
                </div>
                <div className={cn("text-sm", currentTheme.colors.text)}>
                  <strong>Graphiques Avancés :</strong> Visualisez vos finances en radar.
                </div>
              </div>
              <div className={cn(
                "flex items-center gap-3 p-3 rounded-lg",
                currentTheme.isDark ? "bg-slate-800" : "bg-slate-50"
              )}>
                <div className="p-2 bg-purple-100 dark:bg-purple-900/50 rounded-full">
                  <Check className="w-4 h-4 text-purple-600"/>
                </div>
                <div className={cn("text-sm", currentTheme.colors.text)}>
                  <strong>Thèmes Exclusifs :</strong> Cyberpunk & Royal.
                </div>
              </div>
              <div className={cn(
                "flex items-center gap-3 p-3 rounded-lg",
                currentTheme.isDark ? "bg-slate-800" : "bg-slate-50"
              )}>
                <div className="p-2 bg-amber-100 dark:bg-amber-900/50 rounded-full">
                  <Check className="w-4 h-4 text-amber-600"/>
                </div>
                <div className={cn("text-sm", currentTheme.colors.text)}>
                  <strong>Badge &quot;Supporter&quot;</strong> sur votre profil.
                </div>
              </div>
              
              <div className="pt-4 flex gap-3">
                <Button variant="outline" className="flex-1" onClick={() => setShowPremiumModal(false)}>
                  Annuler
                </Button>
                <Button className="flex-1 bg-slate-900 dark:bg-slate-100 dark:text-slate-900" onClick={handleBuyPremium}>
                  Payer 9.99€
                </Button>
              </div>
              <p className={cn("text-[10px] text-center", currentTheme.colors.subtext)}>
                Ceci est une simulation. Aucun argent réel n&apos;est débité.
              </p>
            </CardContent>
          </Card>
        </div>
      )}
    </div>
  );
}

// ============================================================================
// FILE: app/(main)/patrimoine/page.tsx
// ============================================================================

'use client';

import React, { useState, useMemo } from 'react';
import { PlusCircle, Trash2, Wallet, AlertTriangle, TrendingUp, Home, PiggyBank, Car, Landmark } from 'lucide-react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import type { Actif } from '@/types';
import { formaterMontant } from '@/utils/financeCalculations';
import { useTheme } from '@/context/ThemeContext';
import { useFinanceData } from '@/context/FinanceDataContext';
import { cn } from '@/lib/utils';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

const ACTIF_TYPES = [
  { value: 'immobilier', label: 'Immobilier', icon: Home, gradient: 'from-blue-500 to-indigo-500' },
  { value: 'epargne', label: 'Épargne', icon: PiggyBank, gradient: 'from-emerald-500 to-teal-500' },
  { value: 'vehicule', label: 'Véhicule', icon: Car, gradient: 'from-amber-500 to-orange-500' },
  { value: 'autre', label: 'Autre', icon: Landmark, gradient: 'from-purple-500 to-pink-500' },
];

export default function PatrimoinePage() {
  const { actifs, setActifs, depenses, patrimoineNet } = useFinanceData();
  const [nouvelActif, setNouvelActif] = useState({ nom: '', valeur: '', type: 'epargne' });
  const [error, setError] = useState('');
  const [deleteConfirmId, setDeleteConfirmId] = useState<number | null>(null);
  const { currentTheme } = useTheme();

  const ajouterActif = () => {
    const valeurNum = parseFloat(nouvelActif.valeur);
    if (!nouvelActif.nom.trim()) {
      setError("Le nom de l'actif est requis.");
      return;
    }
    if (isNaN(valeurNum) || valeurNum < 0) {
      setError('Veuillez entrer une valeur valide et positive.');
      return;
    }
    setError('');
    setActifs([...actifs, { ...nouvelActif, id: Date.now() }]);
    setNouvelActif({ nom: '', valeur: '', type: 'epargne' });
  };

  const confirmerSuppression = (id: number) => {
    setDeleteConfirmId(id);
  };

  const annulerSuppression = () => {
    setDeleteConfirmId(null);
  };

  const executerSuppression = () => {
    if (deleteConfirmId !== null) {
      setActifs(actifs.filter(a => a.id !== deleteConfirmId));
      setDeleteConfirmId(null);
    }
  };

  // Calcul des dettes
  // Calcul des dettes - FIX: handle undefined montantTotal
const totalDettes = depenses
  .filter(d => d.categorie === 'credit' && d.montantTotal)
  .reduce((acc, d) => acc + (parseFloat(d.montantTotal || '0')), 0);

  // Calcul du total des actifs
  const totalActifs = actifs.reduce((acc, a) => acc + (parseFloat(a.valeur) || 0), 0);

  // Historique du patrimoine net
  const netWorthHistory = useMemo(() => {
  const allItems = [
    ...actifs.map(a => ({ date: new Date(a.id), amount: parseFloat(a.valeur) || 0 })),
    ...depenses
      .filter(d => d.categorie === 'credit' && d.montantTotal)
      .map(d => ({ 
        date: new Date(d.id), 
        amount: -(parseFloat(d.montantTotal || '0'))  // FIX: handle undefined
      }))
  ].sort((a, b) => a.date.getTime() - b.date.getTime());


    if (allItems.length < 1) return [];

    let cumulativeWorth = 0;
    const dataPoints = [
      { date: 'Début', 'Patrimoine Net': 0 }, 
      ...allItems.map(item => {
        cumulativeWorth += item.amount;
        return {
          date: item.date.toLocaleDateString('fr-FR', { month: 'short', day: '2-digit' }),
          'Patrimoine Net': cumulativeWorth
        };
      })
    ];
    
    return dataPoints;
  }, [actifs, depenses]);

  const inputClass = cn(
    "px-4 py-3 rounded-xl border-2 outline-none transition-all focus:border-blue-500 focus:ring-2 focus:ring-blue-200",
    currentTheme.colors.input,
    currentTheme.colors.border,
    currentTheme.colors.text
  );

  return (
    <div className="space-y-6 animate-fadeIn relative">
      
      {/* Modal de confirmation */}
      {deleteConfirmId !== null && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-fadeIn">
          <div className={cn(
            "rounded-2xl p-6 shadow-2xl max-w-sm w-full mx-4 border transform transition-all scale-100",
            currentTheme.colors.card,
            currentTheme.colors.border
          )}>
            <div className="flex flex-col items-center text-center gap-4">
              <div className="p-3 bg-red-100 rounded-full">
                <AlertTriangle className="w-8 h-8 text-red-600" />
              </div>
              <h3 className={cn("text-xl font-bold", currentTheme.colors.text)}>
                Confirmer la suppression
              </h3>
              <p className={currentTheme.colors.subtext}>
                Êtes-vous sûr de vouloir supprimer cet actif ?
              </p>
              <div className="flex gap-3 w-full mt-2">
                <button
                  onClick={annulerSuppression}
                  className={cn(
                    "flex-1 px-4 py-2 rounded-xl border font-semibold transition-colors hover:opacity-80",
                    currentTheme.colors.border,
                    currentTheme.colors.text
                  )}
                >
                  Annuler
                </button>
                <button
                  onClick={executerSuppression}
                  className="flex-1 px-4 py-2 rounded-xl bg-red-500 text-white font-semibold hover:bg-red-600 shadow-lg shadow-red-500/30 transition-colors"
                >
                  Supprimer
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Résumé du patrimoine */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card className={cn(
          "overflow-hidden relative border-none",
          patrimoineNet >= 0 
            ? "bg-gradient-to-br from-blue-600 to-indigo-600" 
            : "bg-gradient-to-br from-red-500 to-pink-600",
          "text-white"
        )}>
          <CardContent className="p-6">
            <div className="flex items-center gap-3 mb-2">
              <Wallet className="w-5 h-5 opacity-80" />
              <span className="text-sm font-medium opacity-80">Patrimoine Net</span>
            </div>
            <div className="text-3xl font-bold">{formaterMontant(patrimoineNet)}</div>
          </CardContent>
        </Card>

        <Card className={cn(
          "overflow-hidden relative border-none bg-gradient-to-br from-emerald-500 to-teal-500 text-white"
        )}>
          <CardContent className="p-6">
            <div className="flex items-center gap-3 mb-2">
              <TrendingUp className="w-5 h-5 opacity-80" />
              <span className="text-sm font-medium opacity-80">Total Actifs</span>
            </div>
            <div className="text-3xl font-bold">{formaterMontant(totalActifs)}</div>
          </CardContent>
        </Card>

        <Card className={cn(
          "overflow-hidden relative border-none bg-gradient-to-br from-red-500 to-orange-500 text-white"
        )}>
          <CardContent className="p-6">
            <div className="flex items-center gap-3 mb-2">
              <AlertTriangle className="w-5 h-5 opacity-80" />
              <span className="text-sm font-medium opacity-80">Total Dettes</span>
            </div>
            <div className="text-3xl font-bold">{formaterMontant(totalDettes)}</div>
          </CardContent>
        </Card>
      </div>

      {/* Formulaire d'ajout */}
      <div className={cn(
        "rounded-2xl p-6 shadow-xl border backdrop-blur-xl",
        currentTheme.colors.card,
        currentTheme.colors.border
      )}>
        <h2 className={cn("text-2xl font-bold mb-6 flex items-center gap-3", currentTheme.colors.text)}>
          <div className="p-2 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-xl">
            <Wallet className="w-6 h-6 text-white" />
          </div>
          Ajouter un actif
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <input
            type="text"
            placeholder="Nom de l'actif (ex: Livret A, Maison)"
            value={nouvelActif.nom}
            onChange={(e) => setNouvelActif({...nouvelActif, nom: e.target.value})}
            className={inputClass}
          />
          <input
            type="number"
            placeholder="Valeur (€)"
            value={nouvelActif.valeur}
            onChange={(e) => setNouvelActif({...nouvelActif, valeur: e.target.value})}
            className={inputClass}
          />
          <select
            value={nouvelActif.type}
            onChange={(e) => setNouvelActif({...nouvelActif, type: e.target.value})}
            className={inputClass}
          >
            {ACTIF_TYPES.map(type => (
              <option key={type.value} value={type.value}>{type.label}</option>
            ))}
          </select>
        </div>
        {error && <p className="text-red-500 text-sm text-center mb-4">{error}</p>}
        <button
          onClick={ajouterActif}
          className="w-full flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold hover:opacity-90 shadow-lg transition-all"
        >
          <PlusCircle className="w-5 h-5" /> Ajouter l&apos;actif
        </button>
      </div>

      {/* Graphique d'évolution */}
      {netWorthHistory.length > 1 && (
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <TrendingUp className="w-5 h-5 text-blue-500" />
              Évolution du Patrimoine Net
            </CardTitle>
          </CardHeader>
          <CardContent className="h-[300px]">
            <ResponsiveContainer width="100%" height="100%">
              <LineChart data={netWorthHistory}>
                <CartesianGrid strokeDasharray="3 3" stroke={currentTheme.isDark ? "#334155" : "#f1f5f9"} />
                <XAxis 
                  dataKey="date" 
                  axisLine={false} 
                  tickLine={false} 
                  tick={{ fill: currentTheme.colors.chartText, fontSize: 12 }} 
                />
                <YAxis 
                  axisLine={false} 
                  tickLine={false} 
                  tick={{ fill: currentTheme.colors.chartText, fontSize: 12 }} 
                  tickFormatter={(value) => formaterMontant(value as number)} 
                />
                <Tooltip 
                  formatter={(value: number) => [formaterMontant(value), "Patrimoine Net"]} 
                  contentStyle={{
                    borderRadius: '12px', 
                    border: 'none', 
                    boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)',
                    backgroundColor: currentTheme.isDark ? '#1e293b' : '#fff',
                    color: currentTheme.isDark ? '#f8fafc' : '#0f172a'
                  }}
                />
                <Line 
                  type="monotone" 
                  dataKey="Patrimoine Net" 
                  stroke="#4f46e5" 
                  strokeWidth={3} 
                  dot={{ r: 5, fill: '#4f46e5' }} 
                  activeDot={{ r: 8 }} 
                />
              </LineChart>
            </ResponsiveContainer>
          </CardContent>
        </Card>
      )}

      {/* Liste des actifs */}
      <div className={cn(
        "rounded-2xl p-6 shadow-xl border backdrop-blur-xl",
        currentTheme.colors.card,
        currentTheme.colors.border
      )}>
        <h3 className={cn("text-xl font-bold mb-4", currentTheme.colors.text)}>
          Mes actifs ({actifs.length})
        </h3>
        <div className="space-y-3">
          {actifs.length === 0 && (
            <div className="flex flex-col items-center justify-center py-8">
              <PiggyBank className={cn("w-12 h-12 mb-3 opacity-30", currentTheme.colors.subtext)} />
              <p className={cn("text-center", currentTheme.colors.subtext)}>
                Aucun actif ajouté pour le moment.
              </p>
              <p className={cn("text-center text-sm", currentTheme.colors.subtext)}>
                Ajoutez vos actifs pour calculer votre patrimoine net.
              </p>
            </div>
          )}
          {actifs.map(actif => {
            const typeInfo = ACTIF_TYPES.find(t => t.value === actif.type) || ACTIF_TYPES[3];
            const Icon = typeInfo.icon;
            
            return (
              <div
                key={actif.id}
                className={cn(
                  "flex items-center justify-between p-4 rounded-xl border transition-all hover:shadow-lg",
                  currentTheme.colors.border,
                  currentTheme.isDark ? "bg-slate-800/40" : "bg-blue-50"
                )}
              >
                <div className="flex items-center gap-3">
                  <div className={`p-2 bg-gradient-to-br ${typeInfo.gradient} rounded-lg`}>
                    <Icon className="w-5 h-5 text-white" />
                  </div>
                  <div>
                    <div className={cn("font-bold", currentTheme.colors.text)}>{actif.nom}</div>
                    <div className={cn("text-xs", currentTheme.colors.subtext)}>{typeInfo.label}</div>
                  </div>
                </div>
                <div className="flex items-center gap-4">
                  <div className="font-semibold text-blue-600">
                    {formaterMontant(parseFloat(actif.valeur))}
                  </div>
                  <button
                    onClick={() => confirmerSuppression(actif.id)}
                    className="p-2 text-red-600 rounded-lg hover:bg-red-100 transition-colors"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      {/* Section des dettes (crédits) */}
      {totalDettes > 0 && (
        <div className={cn(
          "rounded-2xl p-6 shadow-xl border backdrop-blur-xl",
          currentTheme.isDark ? "bg-red-900/20 border-red-800/30" : "bg-red-50 border-red-200"
        )}>
          <h3 className={cn("text-xl font-bold mb-4 text-red-600")}>
            Mes dettes (crédits)
          </h3>
          <div className="space-y-3">
            {depenses
              .filter(d => d.categorie === 'credit' && d.montantTotal)
              .map(dette => (
                <div
                  key={dette.id}
                  className={cn(
                    "flex items-center justify-between p-4 rounded-xl border",
                    currentTheme.isDark ? "bg-red-900/30 border-red-800/30" : "bg-white border-red-200"
                  )}
                >
                  <div>
                    <div className={cn("font-bold", currentTheme.colors.text)}>{dette.nom}</div>
                    <div className={cn("text-xs", currentTheme.colors.subtext)}>
                      {dette.mensualitesRestantes} mensualités restantes
                    </div>
                  </div>
                  <div className="font-semibold text-red-600">
                    -{formaterMontant(parseFloat(dette.montantTotal || '0'))}
                  </div>
                </div>
              ))}
          </div>
        </div>
      )}
    </div>
  );
}

// ============================================================================
// FILE: app/(main)/settings/page.tsx
// ============================================================================

// app/(main)/settings/page.tsx

import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { getInitials } from "@/lib/utils";
import { ProfileForm } from "@/components/settings/profile-form";
import { PreferencesForm } from "@/components/settings/preferences-form";

export default async function SettingsPage() {
  const session = await getServerSession(authOptions);
  const user = session?.user;

  if (!user) return null;

  const userWithInitials = {
      ...user,
      initials: getInitials(user.name)
  }

  return (
    <div className="flex flex-col gap-6 max-w-4xl">
       <h1 className="text-2xl font-semibold leading-none tracking-tight">Settings</h1>
       
       <Card>
         <CardHeader>
           <CardTitle>Profile</CardTitle>
           <CardDescription>Manage your public profile information.</CardDescription>
         </CardHeader>
         <CardContent>
            <ProfileForm user={userWithInitials} />
         </CardContent>
       </Card>

       <Card>
         <CardHeader>
           <CardTitle>Preferences</CardTitle>
           <CardDescription>Customize your application experience.</CardDescription>
         </CardHeader>
         <CardContent>
            <PreferencesForm />
         </CardContent>
       </Card>
    </div>
  );
}

// ============================================================================
// FILE: app/(main)/transactions/page.tsx
// ============================================================================

'use client';

import React, { useState } from 'react';
import { PlusCircle, Trash2, TrendingUp, AlertTriangle } from 'lucide-react';
import { REVENUS_CATEGORIES } from '@/constants';
import type { RevenuFrequence } from '@/types';
import { useTheme } from '@/context/ThemeContext';
import { useFinanceData } from '@/context/FinanceDataContext';
import { cn } from '@/lib/utils';

export default function TransactionsPage() {
  const { revenus, setRevenus } = useFinanceData();
  const [nouveauRevenu, setNouveauRevenu] = useState({
    nom: '', 
    montant: '', 
    frequence: 'mensuel' as RevenuFrequence, 
    categorie: 'salaire', 
    dateDebut: ''
  });
  const [error, setError] = useState('');
  const [deleteConfirmId, setDeleteConfirmId] = useState<number | null>(null);
  const { currentTheme } = useTheme();

  const ajouterRevenu = () => {
    const montantNum = parseFloat(nouveauRevenu.montant);
    if (!nouveauRevenu.nom.trim()) {
      setError('Le nom du revenu est requis.');
      return;
    }
    if (isNaN(montantNum) || montantNum <= 0) {
      setError('Veuillez entrer un montant valide et positif.');
      return;
    }
    setError('');
    setRevenus([...revenus, { ...nouveauRevenu, id: Date.now() }]);
    setNouveauRevenu({ nom: '', montant: '', frequence: 'mensuel', categorie: 'salaire', dateDebut: '' });
  };

  const confirmerSuppression = (id: number) => {
    setDeleteConfirmId(id);
  };

  const annulerSuppression = () => {
    setDeleteConfirmId(null);
  };

  const executerSuppression = () => {
    if (deleteConfirmId !== null) {
      setRevenus(revenus.filter(r => r.id !== deleteConfirmId));
      setDeleteConfirmId(null);
    }
  };

  const inputClass = cn(
    "px-4 py-3 rounded-xl border-2 outline-none transition-all focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",
    currentTheme.colors.input,
    currentTheme.colors.border,
    currentTheme.colors.text
  );

  return (
    <div className="space-y-6 animate-fadeIn relative">
      
      {/* Modal de confirmation */}
      {deleteConfirmId !== null && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-fadeIn">
          <div className={cn(
            "rounded-2xl p-6 shadow-2xl max-w-sm w-full mx-4 border transform transition-all scale-100", 
            currentTheme.colors.card, 
            currentTheme.colors.border
          )}>
            <div className="flex flex-col items-center text-center gap-4">
              <div className="p-3 bg-red-100 rounded-full">
                <AlertTriangle className="w-8 h-8 text-red-600" />
              </div>
              <h3 className={cn("text-xl font-bold", currentTheme.colors.text)}>
                Confirmer la suppression
              </h3>
              <p className={currentTheme.colors.subtext}>
                Êtes-vous sûr de vouloir supprimer ce revenu ?
              </p>
              <div className="flex gap-3 w-full mt-2">
                <button
                  onClick={annulerSuppression}
                  className={cn(
                    "flex-1 px-4 py-2 rounded-xl border font-semibold transition-colors hover:opacity-80", 
                    currentTheme.colors.border, 
                    currentTheme.colors.text
                  )}
                >
                  Annuler
                </button>
                <button
                  onClick={executerSuppression}
                  className="flex-1 px-4 py-2 rounded-xl bg-red-500 text-white font-semibold hover:bg-red-600 shadow-lg shadow-red-500/30 transition-colors"
                >
                  Supprimer
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Formulaire d'ajout */}
      <div className={cn(
        "rounded-2xl p-6 shadow-xl border backdrop-blur-xl", 
        currentTheme.colors.card, 
        currentTheme.colors.border
      )}>
        <h2 className={cn("text-2xl font-bold mb-6 flex items-center gap-3", currentTheme.colors.text)}>
          <div className="p-2 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-xl">
            <TrendingUp className="w-6 h-6 text-white" />
          </div>
          Ajouter un revenu
        </h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
          <input 
            type="text" 
            placeholder="Nom du revenu" 
            value={nouveauRevenu.nom} 
            onChange={(e) => setNouveauRevenu({...nouveauRevenu, nom: e.target.value})} 
            className={inputClass} 
          />
          <input 
            type="number" 
            step="0.01" 
            placeholder="Montant (€)" 
            value={nouveauRevenu.montant} 
            onChange={(e) => setNouveauRevenu({...nouveauRevenu, montant: e.target.value})} 
            className={inputClass} 
          />
          <select 
            value={nouveauRevenu.frequence} 
            onChange={(e) => setNouveauRevenu({...nouveauRevenu, frequence: e.target.value as RevenuFrequence})} 
            className={inputClass}
          >
            <option value="mensuel">Mensuel</option>
            <option value="ponctuel">Ponctuel</option>
            <option value="annuel">Annuel</option>
          </select>
          <select 
            value={nouveauRevenu.categorie} 
            onChange={(e) => setNouveauRevenu({...nouveauRevenu, categorie: e.target.value})} 
            className={inputClass}
          >
            {Object.entries(REVENUS_CATEGORIES).map(([key, cat]) => (
              <option key={key} value={key}>{cat.label}</option>
            ))}
          </select>
          <div className="lg:col-span-1">
            <label 
              htmlFor="revenu-date-debut" 
              className={cn("block text-xs font-medium mb-1", currentTheme.colors.subtext)}
            >
              Date de début (optionnel)
            </label>
            <input 
              id="revenu-date-debut" 
              type="date" 
              value={nouveauRevenu.dateDebut} 
              onChange={(e) => setNouveauRevenu({...nouveauRevenu, dateDebut: e.target.value})} 
              className={cn("w-full", inputClass)} 
            />
          </div>
        </div>
        
        {error && <p className="text-red-500 text-sm text-center mb-4">{error}</p>}

        <button 
          onClick={ajouterRevenu} 
          className="w-full flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold hover:opacity-90 shadow-lg transition-all"
        >
          <PlusCircle className="w-5 h-5" /> Ajouter le revenu
        </button>
      </div>

      {/* Liste des revenus */}
      <div className={cn(
        "rounded-2xl p-6 shadow-xl border backdrop-blur-xl", 
        currentTheme.colors.card, 
        currentTheme.colors.border
      )}>
        <h3 className={cn("text-xl font-bold mb-4", currentTheme.colors.text)}>
          Mes revenus ({revenus.length})
        </h3>
        <div className="space-y-3">
          {revenus.length === 0 && (
            <p className={cn("text-center py-4", currentTheme.colors.subtext)}>
              Aucun revenu ajouté pour le moment.
            </p>
          )}
          {revenus.map(rev => {
            const catInfo = REVENUS_CATEGORIES[rev.categorie];
            const Icon = catInfo?.icon || TrendingUp;
            const gradient = catInfo?.gradient || 'from-emerald-500 to-teal-500';
            
            return (
              <div 
                key={rev.id} 
                className={cn(
                  "flex items-center justify-between p-4 rounded-xl border hover:shadow-lg transition-all", 
                  currentTheme.colors.border, 
                  currentTheme.isDark ? "bg-slate-800/40" : "bg-gradient-to-r from-emerald-50 to-teal-50"
                )}
              >
                <div className="flex items-center gap-3">
                  <div className={`p-2 bg-gradient-to-br ${gradient} rounded-lg`}>
                    <Icon className="w-5 h-5 text-white" />
                  </div>
                  <div>
                    <div className={cn("font-bold", currentTheme.colors.text)}>{rev.nom}</div>
                    <div className={cn("text-sm", currentTheme.colors.subtext)}>
                      {parseFloat(rev.montant).toFixed(2)}€ · {rev.frequence}
                      {rev.dateDebut && rev.frequence !== 'ponctuel' && (
                        <span className="italic"> · à p. du {new Date(rev.dateDebut).toLocaleDateString('fr-FR')}</span>
                      )}
                    </div>
                  </div>
                </div>
                <button 
                  onClick={() => confirmerSuppression(rev.id)} 
                  className="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors"
                >
                  <Trash2 className="w-4 h-4" />
                </button>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}

// ============================================================================
// FILE: app/api/auth/[...nextauth]/route.ts
// ============================================================================

// app/api/auth/[...nextauth]/route.ts
import NextAuth, { AuthOptions } from "next-auth";
import GoogleProvider from "next-auth/providers/google";
import CredentialsProvider from "next-auth/providers/credentials";
import { PrismaAdapter } from "@next-auth/prisma-adapter";
import prisma from "@/lib/prisma";
import bcrypt from "bcryptjs";

export const authOptions: AuthOptions = {
  adapter: PrismaAdapter(prisma),
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID as string,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET as string,
    }),
    CredentialsProvider({
      name: "credentials",
      credentials: {
        email: { label: "Email", type: "text" },
        password: { label: "Password", type: "password" },
      },
      async authorize(credentials) {
        if (!credentials?.email || !credentials?.password) {
          throw new Error("Invalid credentials");
        }

        const user = await prisma.user.findUnique({
          where: { email: credentials.email },
        });

        if (!user || !user.password) {
          throw new Error("Invalid credentials");
        }

        const isPasswordCorrect = await bcrypt.compare(
          credentials.password,
          user.password
        );

        if (!isPasswordCorrect) {
          throw new Error("Invalid credentials");
        }

        return user;
      },
    }),
  ],
  pages: {
    signIn: "/login",
  },
  session: {
    strategy: "jwt",
  },
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.id = user.id;
      }
      return token;
    },
    async session({ session, token }) {
      if (session.user) {
        session.user.id = token.id as string;
      }
      return session;
    },
  },
  secret: process.env.NEXTAUTH_SECRET,
};

const handler = NextAuth(authOptions);

export { handler as GET, handler as POST };

// ============================================================================
// FILE: app/api/register/route.ts
// ============================================================================

// app/api/register/route.ts
import { NextResponse } from "next/server";
import bcrypt from "bcryptjs";
import prisma from "@/lib/prisma";

export async function POST(request: Request) {
  try {
    const body = await request.json();
    const { name, email, password } = body;

    if (!name || !email || !password) {
      return new NextResponse("Missing fields", { status: 400 });
    }

    const existingUser = await prisma.user.findUnique({
      where: { email },
    });

    if (existingUser) {
      return new NextResponse("Email already in use", { status: 409 });
    }

    const hashedPassword = await bcrypt.hash(password, 12);

    const user = await prisma.user.create({
      data: {
        name,
        email,
        password: hashedPassword,
      },
    });

    return NextResponse.json(user);
  } catch (error) {
    console.error("REGISTRATION_ERROR", error);
    return new NextResponse("Internal Server Error", { status: 500 });
  }
}

// ============================================================================
// FILE: app/globals.css
// ============================================================================

@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  
  /* 1. Set Roobert as the default sans font, fallback to Geist */
  --font-sans: var(--font-roobert), var(--font-geist-sans), ui-sans-serif, system-ui, sans-serif;
  --font-mono: var(--font-geist-mono);
  
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

:root {
  /* 2. Refined Radii for a modern feel */
  --radius: 0.75rem;

  /* LIGHT MODE - Crisp, Clean Zinc/Indigo Palette */
  --background: oklch(1 0 0);
  --foreground: oklch(0.13 0.028 261.692); /* Zinc 950 */
  
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.13 0.028 261.692);
  
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.13 0.028 261.692);
  
  /* Primary: Vibrant Indigo */
  --primary: oklch(0.491 0.27 277.037);
  --primary-foreground: oklch(0.985 0 0);
  
  --secondary: oklch(0.967 0.003 264.542); /* Zinc 100 */
  --secondary-foreground: oklch(0.21 0.034 264.665); /* Zinc 800 */
  
  --muted: oklch(0.967 0.003 264.542);
  --muted-foreground: oklch(0.552 0.016 285.938); /* Zinc 500 */
  
  --accent: oklch(0.967 0.003 264.542);
  --accent-foreground: oklch(0.21 0.034 264.665);
  
  --destructive: oklch(0.577 0.245 27.325);
  --destructive-foreground: oklch(0.985 0 0);

  --border: oklch(0.92 0.004 286.32); /* Zinc 200 */
  --input: oklch(0.92 0.004 286.32);
  --ring: oklch(0.491 0.27 277.037); /* Matches Primary */

  /* Charts */
  --chart-1: oklch(0.491 0.27 277.037); /* Indigo */
  --chart-2: oklch(0.696 0.17 162.48);  /* Teal */
  --chart-3: oklch(0.769 0.188 70.08);  /* Orange */
  --chart-4: oklch(0.627 0.265 303.9);  /* Pink */
  --chart-5: oklch(0.645 0.246 16.439); /* Red */

  /* Sidebar Light */
  --sidebar: oklch(0.984 0.003 247.858); /* Zinc 50 */
  --sidebar-foreground: oklch(0.32 0.03 260);
  --sidebar-primary: oklch(0.491 0.27 277.037);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.92 0.004 286.32);
  --sidebar-accent-foreground: oklch(0.21 0.034 264.665);
  --sidebar-border: oklch(0.92 0.004 286.32);
  --sidebar-ring: oklch(0.491 0.27 277.037);
}

.dark {
  /* DARK MODE - Deep Blue-Grey/Zinc Palette */
  --background: oklch(0.12 0.01 260); /* Deep rich grey */
  --foreground: oklch(0.985 0 0);
  
  --card: oklch(0.15 0.01 260); /* Slightly lighter than bg */
  --card-foreground: oklch(0.985 0 0);
  
  --popover: oklch(0.15 0.01 260);
  --popover-foreground: oklch(0.985 0 0);
  
  /* Primary: Lighter Indigo for Dark Mode contrast */
  --primary: oklch(0.65 0.25 277);
  --primary-foreground: oklch(0.12 0.01 260);
  
  --secondary: oklch(0.22 0.015 260);
  --secondary-foreground: oklch(0.985 0 0);
  
  --muted: oklch(0.22 0.015 260);
  --muted-foreground: oklch(0.65 0.015 260);
  
  --accent: oklch(0.22 0.015 260);
  --accent-foreground: oklch(0.985 0 0);
  
  --destructive: oklch(0.35 0.15 25);
  --destructive-foreground: oklch(0.985 0 0);

  --border: oklch(0.25 0.01 260);
  --input: oklch(0.25 0.01 260);
  --ring: oklch(0.55 0.25 277);

  /* Charts */
  --chart-1: oklch(0.65 0.25 277);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);

  /* Sidebar Dark */
  --sidebar: oklch(0.11 0.01 260);
  --sidebar-foreground: oklch(0.92 0 0);
  --sidebar-primary: oklch(0.65 0.25 277);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.22 0.015 260);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.25 0.01 260);
  --sidebar-ring: oklch(0.55 0.25 277);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground font-sans antialiased;
  }
}

/* 3. Improved Animations */
@keyframes appear-up {
  from {
    opacity: 0;
    transform: translateY(15px);
    filter: blur(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0);
  }
}

.animate-appear {
  animation: appear-up 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}

/* Gradient Background Animation */
@keyframes gradient-move {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.animated-gradient {
  background: linear-gradient(-45deg, #6366f1, #d946ef, #0ea5e9, #10b981);
  background-size: 300% 300%;
  animation: gradient-move 10s ease infinite;
}

/* 4. Glassmorphism Utility */
.glass {
  @apply bg-white/10 backdrop-blur-lg border border-white/20 shadow-lg;
}
.dark .glass {
  @apply bg-black/10 border-white/10;
}

// ============================================================================
// FILE: app/layout.tsx
// ============================================================================

// app/layout.tsx
import type { Metadata } from "next";
import localFont from "next/font/local";
import { Geist, Geist_Mono, Instrument_Sans, Lora } from "next/font/google";
import "./globals.css";
import { Providers } from "@/components/providers";
import { Toaster } from "@/components/ui/toaster";

// --- Google Fonts ---
const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

const instrumentSans = Instrument_Sans({
  variable: "--font-instrument-sans",
  subsets: ["latin"],
});

const lora = Lora({
  variable: "--font-logo",
  subsets: ["latin"],
  weight: "600",
});

// --- Roobert Variable Fonts ---
// Paths are now relative to this file (layout.tsx)
const roobert = localFont({
  src: [
    {
      path: './fonts/roobert/RoobertUprightsVF.woff2',
      style: 'normal',
    },
    {
      path: './fonts/roobert/RoobertItalicsVF.woff2',
      style: 'italic',
    },
  ],
  variable: '--font-roobert',
  weight: '100 900', // Variable fonts handle the full range
  display: 'swap',
});

const roobertMono = localFont({
  src: [
    {
      path: './fonts/roobert/RoobertMonoUprightsVF.woff2',
      style: 'normal',
    },
    {
      path: './fonts/roobert/RoobertMonoItalicsVF.woff2',
      style: 'italic',
    },
  ],
  variable: '--font-roobert-mono',
  weight: '100 900',
  display: 'swap',
});

export const metadata: Metadata = {
  title: "Finances Expert Pro",
  description: "The Smart Way to Manage Your Personal Finances",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body
        className={`
          ${roobert.variable} 
          ${roobertMono.variable} 
          ${geistSans.variable} 
          ${geistMono.variable} 
          ${instrumentSans.variable} 
          ${lora.variable} 
          antialiased
        `}
      >
        <Providers
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          {children}
          <Toaster />
        </Providers>
      </body>
    </html>
  );
}

// ============================================================================
// FILE: app/page.tsx
// ============================================================================

// app/page.tsx
import { Header } from "@/components/layout/header";
import { Hero } from "@/components/landing/hero";
import { Features } from "@/components/landing/features";
import { Pricing } from "@/components/landing/pricing";
import { Footer } from "@/components/layout/footer";

export default function LandingPage() {
  return (
    <div className="flex min-h-screen flex-col">
      <Header />
      <main className="flex-1 pt-14">
        <Hero
          eyebrow="FINANCES EXPERT PRO"
          title={
            <>
              The Smart Way to Manage <br /> Your Personal Finances
            </>
          }
          subtitle="From daily transaction tracking to long-term investment planning, our AI-powered platform gives you the clarity and control you need to achieve your financial goals."
          ctaText="Get Started for Free"
          ctaLink="/register"
          mockupImage={{
            src: "/dashboard-mockup.png", // NOTE: Add a placeholder image to your `public` folder
            alt: "Finances Expert Pro Dashboard Mockup",
            width: 1440,
            height: 900,
          }}
        />
        <Features />
        <Pricing />

        {/* About section */}
        <section id="about" className="w-full py-24 sm:py-32">
          <div className="container">
            <div className="text-center">
              <h2 className="text-3xl font-bold">About Finances Expert Pro</h2>
              <p className="text-muted-foreground mt-4 max-w-3xl mx-auto">
                This application provides users with a comprehensive and
                intelligent platform to manage every aspect of their financial
                lives, from daily transaction tracking to long-term investment
                and goal planning.
              </p>
            </div>
          </div>
        </section>
      </main>
      <Footer />
    </div>
  );
}

// ============================================================================
// FILE: components.json
// ============================================================================

{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}


// ============================================================================
// FILE: components/budgets/add-budget-dialog.tsx
// ============================================================================

// components/budgets/add-budget-dialog.tsx (NEW FILE)
"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { PlusCircle } from "lucide-react";
import {
  Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { useToast } from "@/components/ui/use-toast";
import { createBudget } from "@/lib/actions/budget.actions";

const formSchema = z.object({
  category: z.string().min(1, "Category is required."),
  limit: z.coerce.number().positive("Limit must be a positive number."),
});

const expenseCategories = ["Food", "Transport", "Housing", "Entertainment", "Utilities", "Other"];

export function AddBudgetDialog() {
  const [open, setOpen] = useState(false);
  const { toast } = useToast();

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
  });

  const onSubmit = async (values: z.infer<typeof formSchema>) => {
    const result = await createBudget(values);
    if (result.success) {
      toast({ title: "Success", description: result.message });
      form.reset();
      setOpen(false);
    } else {
      toast({ title: "Error", description: result.message, variant: "destructive" });
    }
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button><PlusCircle className="mr-2 h-4 w-4" /> Add Budget</Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader><DialogTitle>Create a New Budget</DialogTitle></DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField control={form.control} name="category" render={({ field }) => (
              <FormItem>
                <FormLabel>Category</FormLabel>
                <Select onValueChange={field.onChange} defaultValue={field.value}>
                  <FormControl>
                    <SelectTrigger><SelectValue placeholder="Select a category" /></SelectTrigger>
                  </FormControl>
                  <SelectContent>
                    {expenseCategories.map((cat) => (
                      <SelectItem key={cat} value={cat}>{cat}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
                <FormMessage />
              </FormItem>
            )} />
            <FormField control={form.control} name="limit" render={({ field }) => (
              <FormItem>
                <FormLabel>Monthly Limit</FormLabel>
                <FormControl><Input type="number" placeholder="500.00" {...field} /></FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <Button type="submit" className="w-full" disabled={form.formState.isSubmitting}>
              {form.formState.isSubmitting ? "Creating..." : "Create Budget"}
            </Button>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}

// ============================================================================
// FILE: components/dashboard/ai-insights-card.tsx
// ============================================================================

// components/dashboard/ai-insights-card.tsx

"use client";

import { useState } from "react";
import { Sparkles, Loader2, RefreshCw } from "lucide-react";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { generateFinancialInsights } from "@/lib/actions/ai.actions";

// Define the expected type
type InsightsData = {
  score: number;
  summary: string;
  recommendations?: string[]; // Make optional
};

export function AiInsightsCard() {
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<InsightsData | null>(null);

  const handleGenerate = async () => {
    setLoading(true);
    try {
      const result = await generateFinancialInsights();
      if (result.error) {
        // Handle error gracefully (could use toast here)
        console.error(result.error);
        return;
      }
      setData(result);
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <Card className="border-indigo-500/20 bg-indigo-50/10 dark:bg-indigo-950/10">
      <CardHeader>
        <div className="flex items-center gap-2">
           <Sparkles className="h-5 w-5 text-indigo-500" />
           <CardTitle>AI Financial Analyst</CardTitle>
        </div>
        <CardDescription>Get personalized insights powered by Gemini.</CardDescription>
      </CardHeader>
      <CardContent>
        {loading ? (
          <div className="flex flex-col items-center justify-center py-6 gap-2">
            <Loader2 className="h-8 w-8 animate-spin text-indigo-500" />
            <p className="text-sm text-muted-foreground">Analyzing your transactions...</p>
          </div>
        ) : data ? (
          <div className="space-y-4">
             <div className="flex items-center justify-between p-3 bg-background/50 rounded-lg border">
                <span className="text-sm font-medium">Financial Health Score</span>
                <span className="text-2xl font-bold text-indigo-600 dark:text-indigo-400">{data.score ?? 0}/100</span>
             </div>
             <p className="text-sm">{data.summary}</p>
             <div className="space-y-2">
                <p className="text-xs font-semibold uppercase text-muted-foreground">Recommendations</p>
                <ul className="text-sm space-y-1 list-disc pl-4">
                    {/* SAFE GUARD: Check if recommendations exists before mapping */}
                    {data.recommendations && data.recommendations.length > 0 ? (
                        data.recommendations.map((rec, i) => (
                            <li key={i}>{rec}</li>
                        ))
                    ) : (
                        <li>No specific recommendations available.</li>
                    )}
                </ul>
             </div>
          </div>
        ) : (
          <div className="text-center py-6 text-sm text-muted-foreground">
            Tap the button below to generate a real-time analysis of your finances.
          </div>
        )}
      </CardContent>
      <CardFooter>
        <Button 
            className="w-full bg-indigo-600 hover:bg-indigo-700 text-white" 
            onClick={handleGenerate} 
            disabled={loading}
        >
            {data ? <><RefreshCw className="mr-2 h-4 w-4"/> Refresh Analysis</> : "Generate Insights"}
        </Button>
      </CardFooter>
    </Card>
  );
}

// ============================================================================
// FILE: components/dashboard/expense-by-category-chart.tsx
// ============================================================================

// components/dashboard/expense-by-category-chart.tsx (NEW FILE)

"use client";

import * as React from "react";
import { Pie, PieChart, ResponsiveContainer, Cell } from "recharts";
import {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  type ChartConfig,
} from "@/components/ui/chart";
import { formatCurrency } from "@/lib/utils";

interface ExpenseByCategoryChartProps {
  data: {
    category: string;
    amount: number;
    fill: string;
  }[];
}

export function ExpenseByCategoryChart({ data }: ExpenseByCategoryChartProps) {
  const chartConfig = React.useMemo(() => {
    return data.reduce((config, item) => {
      config[item.category] = { label: item.category, color: item.fill };
      return config;
    }, {} as ChartConfig);
  }, [data]);

  if (data.length === 0) {
    return (
       <div className="h-96 flex items-center justify-center">
          <p className="text-muted-foreground">No expenses recorded for this month.</p>
       </div>
    )
  }


  const totalAmount = React.useMemo(() => {
    return data.reduce((acc, curr) => acc + curr.amount, 0);
  }, [data]);

  return (
    <ChartContainer
      config={chartConfig}
      className="min-h-[300px] w-full"
    >
      <ResponsiveContainer>
        <PieChart>
          <ChartTooltip
            cursor={false}
            content={<ChartTooltipContent hideLabel formatter={(value) => formatCurrency(value as number)}/>}
          />
          <Pie
            data={data}
            dataKey="amount"
            nameKey="category"
            innerRadius={60}
            strokeWidth={5}
          >
            {data.map((entry, index) => (
              <Cell key={`cell-${index}`} fill={entry.fill} />
            ))}
          </Pie>
           <ChartLegend
            content={<ChartLegendContent nameKey="category" />}
            className="-translate-y-[2rem] flex-wrap gap-2 [&>*]:basis-1/4 [&>*]:justify-center"
          />
        </PieChart>
      </ResponsiveContainer>
    </ChartContainer>
  );
}

// ============================================================================
// FILE: components/dashboard/monthly-summary-chart.tsx
// ============================================================================

// components/dashboard/monthly-summary-chart.tsx (NEW FILE)

"use client";

import {
  Bar,
  BarChart,
  CartesianGrid,
  ResponsiveContainer,
  XAxis,
  YAxis,
} from "recharts";
import {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  type ChartConfig,
} from "@/components/ui/chart";
import { formatCurrency } from "@/lib/utils";

interface MonthlySummaryChartProps {
  data: {
    month: string;
    income: number;
    expense: number;
  }[];
}

const chartConfig = {
  income: {
    label: "Income",
    color: "hsl(var(--chart-2))",
  },
  expense: {
    label: "Expense",
    color: "hsl(var(--chart-1))",
  },
} satisfies ChartConfig;

export function MonthlySummaryChart({ data }: MonthlySummaryChartProps) {
  if (data.length === 0) {
    return (
       <div className="h-96 flex items-center justify-center">
          <p className="text-muted-foreground">No data for this period. Add transactions to see a summary.</p>
       </div>
    )
  }

  return (
    <ChartContainer config={chartConfig} className="min-h-[300px] w-full">
      <ResponsiveContainer>
        <BarChart data={data}>
          <CartesianGrid vertical={false} />
          <XAxis
            dataKey="month"
            tickLine={false}
            tickMargin={10}
            axisLine={false}
          />
          <YAxis
            tickFormatter={(value) => formatCurrency(value as number).split(".")[0]}
          />
          <ChartTooltip
            cursor={false}
            content={<ChartTooltipContent formatter={(value) => formatCurrency(value as number)}/>}
          />
          <ChartLegend content={<ChartLegendContent />} />
          <Bar
            dataKey="income"
            fill="var(--color-income)"
            radius={[4, 4, 0, 0]}
          />
          <Bar
            dataKey="expense"
            fill="var(--color-expense)"
            radius={[4, 4, 0, 0]}
          />
        </BarChart>
      </ResponsiveContainer>
    </ChartContainer>
  );
}

// ============================================================================
// FILE: components/debts/add-debt-dialog.tsx
// ============================================================================

// components/debts/add-debt-dialog.tsx (NEW FILE)
"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { PlusCircle } from "lucide-react";
import {
  Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { useToast } from "@/components/ui/use-toast";
import { createDebt } from "@/lib/actions/debt.actions";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "../ui/select";

const formSchema = z.object({
  name: z.string().min(1, "Debt name is required."),
  type: z.enum(["LOAN", "CREDIT_CARD", "OTHER"]),
  balance: z.coerce.number().positive("Balance must be a positive number."),
  apr: z.coerce.number().min(0, "APR cannot be negative.").max(100, "APR seems too high."),
  minPayment: z.coerce.number().positive("Minimum payment must be positive."),
});

export function AddDebtDialog() {
  const [open, setOpen] = useState(false);
  const { toast } = useToast();
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
  });

  const onSubmit = async (values: z.infer<typeof formSchema>) => {
    const result = await createDebt(values);
    if (result.success) {
      toast({ title: "Success", description: result.message });
      form.reset();
      setOpen(false);
    } else {
      toast({ title: "Error", description: result.message, variant: "destructive" });
    }
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button><PlusCircle className="mr-2 h-4 w-4" /> Add Debt</Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader><DialogTitle>Track a New Debt</DialogTitle></DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField control={form.control} name="name" render={({ field }) => (
              <FormItem>
                <FormLabel>Debt Name</FormLabel>
                <FormControl><Input placeholder="e.g., Chase Sapphire Card" {...field} /></FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <FormField control={form.control} name="type" render={({ field }) => (
              <FormItem>
                <FormLabel>Debt Type</FormLabel>
                 <Select onValueChange={field.onChange} defaultValue={field.value}>
                  <FormControl>
                    <SelectTrigger><SelectValue placeholder="Select a type" /></SelectTrigger>
                  </FormControl>
                  <SelectContent>
                      <SelectItem value="CREDIT_CARD">Credit Card</SelectItem>
                      <SelectItem value="LOAN">Loan</SelectItem>
                      <SelectItem value="OTHER">Other</SelectItem>
                  </SelectContent>
                </Select>
                <FormMessage />
              </FormItem>
            )} />
            <div className="grid grid-cols-2 gap-4">
              <FormField control={form.control} name="balance" render={({ field }) => (
                <FormItem>
                  <FormLabel>Current Balance</FormLabel>
                  <FormControl><Input type="number" placeholder="2500.00" {...field} /></FormControl>
                  <FormMessage />
                </FormItem>
              )} />
               <FormField control={form.control} name="apr" render={({ field }) => (
                <FormItem>
                  <FormLabel>APR (%)</FormLabel>
                  <FormControl><Input type="number" placeholder="21.99" {...field} /></FormControl>
                  <FormMessage />
                </FormItem>
              )} />
            </div>
             <FormField control={form.control} name="minPayment" render={({ field }) => (
                <FormItem>
                  <FormLabel>Minimum Monthly Payment</FormLabel>
                  <FormControl><Input type="number" placeholder="75.00" {...field} /></FormControl>
                  <FormMessage />
                </FormItem>
              )} />
            <Button type="submit" className="w-full" disabled={form.formState.isSubmitting}>
              {form.formState.isSubmitting ? "Adding..." : "Add Debt"}
            </Button>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}

// ============================================================================
// FILE: components/debts/debt-ai-analysis.tsx
// ============================================================================

// components/debts/debt-ai-analysis.tsx (NEW FILE)
"use client";

import { useState } from "react";
import { Bot, Loader2, RefreshCw } from "lucide-react";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { analyzeDebtRepayment } from "@/lib/actions/ai.actions";
import { useToast } from "../ui/use-toast";

type DebtAnalysisResult = {
  bestMethod: 'AVALANCHE' | 'SNOWBALL';
  reasoning: string;
  avalanche: { payoffMonths: number, totalInterest: number };
  snowball: { payoffMonths: number, totalInterest: number };
};

export function DebtAiAnalysis({ debts }: { debts: any[] }) {
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<DebtAnalysisResult | null>(null);
  const { toast } = useToast();

  const handleGenerate = async () => {
    setLoading(true);
    setData(null);
    try {
      const result = await analyzeDebtRepayment(debts);
       if (!result || !result.bestMethod) {
        toast({ title: "Analysis Error", description: "The AI could not determine the best repayment strategy. Please try again.", variant: "destructive" });
        return;
      }
      setData(result);
    } catch (error) {
      console.error(error);
      toast({ title: "Error", description: "An unexpected error occurred during analysis.", variant: "destructive" });
    } finally {
      setLoading(false);
    }
  };

  return (
    <Card className="border-sky-500/20 bg-sky-50/10 dark:bg-sky-950/10">
      <CardHeader>
        <div className="flex items-center gap-2">
           <Bot className="h-5 w-5 text-sky-500" />
           <CardTitle>AI Debt Repayment Coach</CardTitle>
        </div>
        <CardDescription>Analyze your debts to find the fastest way to become debt-free.</CardDescription>
      </CardHeader>
      <CardContent>
        {loading ? (
          <div className="flex flex-col items-center justify-center py-6 gap-2">
            <Loader2 className="h-8 w-8 animate-spin text-sky-500" />
            <p className="text-sm text-muted-foreground">Comparing strategies...</p>
          </div>
        ) : data ? (
          <div className="space-y-4 text-sm">
             <div className="p-3 bg-background/50 rounded-lg border">
                <p className="text-xs font-semibold uppercase text-muted-foreground">Recommendation</p>
                <p className="font-semibold text-sky-600 dark:text-sky-400">The best method for you is the <span className="capitalize">{data.bestMethod.toLowerCase()}</span> method.</p>
                <p className="text-xs mt-1">{data.reasoning}</p>
             </div>
             <div className="grid grid-cols-2 gap-4">
                 <div className="space-y-1">
                     <p className="font-semibold">Avalanche (High APR First)</p>
                     <p>Payoff: ~{data.avalanche.payoffMonths} months</p>
                     <p>Total Interest: ${data.avalanche.totalInterest.toFixed(2)}</p>
                 </div>
                  <div className="space-y-1">
                     <p className="font-semibold">Snowball (Low Balance First)</p>
                     <p>Payoff: ~{data.snowball.payoffMonths} months</p>
                     <p>Total Interest: ${data.snowball.totalInterest.toFixed(2)}</p>
                 </div>
             </div>
          </div>
        ) : (
          <div className="text-center py-6 text-sm text-muted-foreground">
            Get a personalized debt repayment plan.
          </div>
        )}
      </CardContent>
      <CardFooter>
        <Button 
            className="w-full bg-sky-600 hover:bg-sky-700 text-white" 
            onClick={handleGenerate} 
            disabled={loading}
        >
            {data ? <><RefreshCw className="mr-2 h-4 w-4"/> Re-analyze</> : "Analyze My Debts"}
        </Button>
      </CardFooter>
    </Card>
  );
}

// ============================================================================
// FILE: components/debts/debt-card.tsx
// ============================================================================

// components/debts/debt-card.tsx (NEW FILE)
import type { Debt } from "@prisma/client";
import {
  Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle
} from "@/components/ui/card";
import { formatCurrency } from "@/lib/utils";
import { Badge } from "../ui/badge";
import { Button } from "../ui/button";
import { Trash2 } from "lucide-react";

export function DebtCard({ debt }: { debt: Debt }) {
    
  const debtTypeMap = {
      "CREDIT_CARD": "Credit Card",
      "LOAN": "Loan",
      "OTHER": "Other"
  }

  return (
    <Card>
      <CardHeader>
        <div className="flex items-start justify-between">
            <div>
                <CardTitle>{debt.name}</CardTitle>
                <CardDescription>
                   <Badge variant="secondary" className="mt-1">{debtTypeMap[debt.type]}</Badge>
                </CardDescription>
            </div>
            <Button variant="ghost" size="icon" className="h-8 w-8">
                <Trash2 className="h-4 w-4 text-destructive"/>
            </Button>
        </div>
      </CardHeader>
      <CardContent className="grid grid-cols-2 gap-4 text-sm">
        <div>
            <p className="text-muted-foreground">Balance</p>
            <p className="font-semibold">{formatCurrency(debt.balance)}</p>
        </div>
        <div>
            <p className="text-muted-foreground">APR</p>
            <p className="font-semibold">{debt.apr.toFixed(2)}%</p>
        </div>
        <div className="col-span-2">
            <p className="text-muted-foreground">Minimum Payment</p>
            <p className="font-semibold">{formatCurrency(debt.minPayment)} / month</p>
        </div>
      </CardContent>
    </Card>
  );
}

// ============================================================================
// FILE: components/gamification/season-pass-card.tsx
// ============================================================================

// components/gamification/season-pass-card.tsx (NEW FILE)
"use client";

import type { GameState } from "@prisma/client";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { Trophy } from "lucide-react";
import { siteConfig } from "@/lib/config";

interface SeasonPassCardProps {
    gameState: GameState | null;
}

export function SeasonPassCard({ gameState }: SeasonPassCardProps) {
    if (!gameState) return null;

    const { level, xp } = gameState;
    const { xpToNextLevel, rewards } = siteConfig.gamification;
    const currentLevelXp = xpToNextLevel[level - 1] || Infinity;
    const progress = (xp / currentLevelXp) * 100;
    const nextReward = rewards.find(r => r.level === level + 1);

    return (
        <Card>
            <CardHeader>
                <div className="flex items-center gap-2">
                    <Trophy className="h-5 w-5 text-amber-500" />
                    <CardTitle>Season Pass</CardTitle>
                </div>
                <CardDescription>Level up by managing your finances.</CardDescription>
            </CardHeader>
            <CardContent className="space-y-3">
                <div className="flex justify-between items-baseline">
                    <span className="text-lg font-bold">Level {level}</span>
                    <span className="text-sm text-muted-foreground">{xp} / {currentLevelXp} XP</span>
                </div>
                <Progress value={progress} />
                {nextReward && (
                    <p className="text-xs text-center text-muted-foreground">
                        Next Reward: {nextReward.name} at Level {nextReward.level}
                    </p>
                )}
            </CardContent>
        </Card>
    )
}

// ============================================================================
// FILE: components/global/ThemeToggle.tsx
// ============================================================================

// components/global/ThemeToggle.tsx
"use client";

import * as React from "react";
import { Moon, Sun } from "lucide-react";
import { useTheme } from "next-themes";
import { Button } from "@/components/ui/button";

export function ThemeToggle() {
  const { setTheme, theme } = useTheme();

  return (
    <Button
      variant="ghost"
      size="icon"
      onClick={() => setTheme(theme === "light" ? "dark" : "light")}
    >
      <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
      <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
      <span className="sr-only">Toggle theme</span>
    </Button>
  );
}

// ============================================================================
// FILE: components/global/logo.tsx
// ============================================================================

// components/global/logo.tsx

import Link from "next/link";
import { Gem } from "lucide-react"; // MODIFICATION: Changed icon from Wallet to Gem
import { cn } from "@/lib/utils";

interface LogoProps {
  className?: string;
  hideText?: boolean;
}

export function Logo({ className, hideText = false }: LogoProps) {
  return (
    <Link href="/" className={cn("flex items-center space-x-2", className)}>
      <Gem className="h-6 w-6 text-primary" />
      {!hideText && (
        // MODIFICATION: Apply new logo font, increase size, and add gradient
        <span className="hidden font-[var(--font-logo)] text-xl font-semibold sm:inline-block">
          Finances Expert
          <span className="ml-1 bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent dark:from-slate-200 dark:to-slate-400">
            Pro
          </span>
        </span>
      )}
    </Link>
  );
}

// ============================================================================
// FILE: components/goals/add-goal-dialog.tsx
// ============================================================================

// components/goals/add-goal-dialog.tsx (NEW FILE)
"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { PlusCircle, CalendarIcon } from "lucide-react";
import { format } from "date-fns";
import {
  Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { Calendar } from "@/components/ui/calendar";
import { useToast } from "@/components/ui/use-toast";
import { createGoal } from "@/lib/actions/goal.actions";
import { cn } from "@/lib/utils";

const formSchema = z.object({
  name: z.string().min(1, "Goal name is required."),
  targetAmount: z.coerce.number().positive("Target amount must be positive."),
  deadline: z.date().optional(),
});

export function AddGoalDialog() {
  const [open, setOpen] = useState(false);
  const { toast } = useToast();
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
  });

  const onSubmit = async (values: z.infer<typeof formSchema>) => {
    const result = await createGoal(values);
    if (result.success) {
      toast({ title: "Success", description: result.message });
      form.reset();
      setOpen(false);
    } else {
      toast({ title: "Error", description: result.message, variant: "destructive" });
    }
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button><PlusCircle className="mr-2 h-4 w-4" /> Add Goal</Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader><DialogTitle>Set a New Goal</DialogTitle></DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField control={form.control} name="name" render={({ field }) => (
              <FormItem>
                <FormLabel>Goal Name</FormLabel>
                <FormControl><Input placeholder="e.g., Vacation Fund" {...field} /></FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <FormField control={form.control} name="targetAmount" render={({ field }) => (
              <FormItem>
                <FormLabel>Target Amount</FormLabel>
                <FormControl><Input type="number" placeholder="5000.00" {...field} /></FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <FormField control={form.control} name="deadline" render={({ field }) => (
                <FormItem className="flex flex-col">
                  <FormLabel>Deadline (Optional)</FormLabel>
                  <Popover>
                    <PopoverTrigger asChild>
                      <FormControl>
                        <Button variant="outline" className={cn("w-full pl-3 text-left font-normal", !field.value && "text-muted-foreground")}>
                          {field.value ? format(field.value, "PPP") : <span>Pick a date</span>}
                          <CalendarIcon className="ml-auto h-4 w-4 opacity-50" />
                        </Button>
                      </FormControl>
                    </PopoverTrigger>
                    <PopoverContent className="w-auto p-0" align="start">
                      <Calendar mode="single" selected={field.value} onSelect={field.onChange} initialFocus />
                    </PopoverContent>
                  </Popover>
                  <FormMessage />
                </FormItem>
            )} />
            <Button type="submit" className="w-full" disabled={form.formState.isSubmitting}>
              {form.formState.isSubmitting ? "Creating..." : "Create Goal"}
            </Button>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}

// ============================================================================
// FILE: components/goals/goal-card.tsx
// ============================================================================

// components/goals/goal-card.tsx (NEW FILE)
"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import type { Goal } from "@prisma/client";
import { format } from "date-fns";
import {
  Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle
} from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { formatCurrency } from "@/lib/utils";
import { Button } from "../ui/button";
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from "../ui/dialog";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "../ui/form";
import { Input } from "../ui/input";
import { addFundsToGoal } from "@/lib/actions/goal.actions";
import { useToast } from "../ui/use-toast";

const addFundsSchema = z.object({
  amount: z.coerce.number().positive("Amount must be a positive number."),
});

export function GoalCard({ goal }: { goal: Goal }) {
  const [open, setOpen] = useState(false);
  const { toast } = useToast();
  const progress = (goal.currentAmount / goal.targetAmount) * 100;

  const form = useForm<z.infer<typeof addFundsSchema>>({
    resolver: zodResolver(addFundsSchema),
    defaultValues: { amount: 0 },
  });

  const onSubmit = async (values: z.infer<typeof addFundsSchema>) => {
    const result = await addFundsToGoal({ goalId: goal.id, amount: values.amount });
    if (result.success) {
      toast({ title: "Success!", description: result.message });
      form.reset();
      setOpen(false);
    } else {
      toast({ title: "Error", description: result.message, variant: "destructive" });
    }
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle>{goal.name}</CardTitle>
        {goal.deadline && (
          <CardDescription>Deadline: {format(goal.deadline, "PPP")}</CardDescription>
        )}
      </CardHeader>
      <CardContent>
        <div className="space-y-2">
          <div className="flex justify-between text-sm text-muted-foreground">
            <span>{formatCurrency(goal.currentAmount)}</span>
            <span>{formatCurrency(goal.targetAmount)}</span>
          </div>
          <Progress value={progress} />
          <p className="text-sm font-medium">{progress.toFixed(0)}% Complete</p>
        </div>
      </CardContent>
      <CardFooter>
        <Dialog open={open} onOpenChange={setOpen}>
          <DialogTrigger asChild><Button variant="secondary" className="w-full">Add Funds</Button></DialogTrigger>
          <DialogContent>
            <DialogHeader><DialogTitle>Add Funds to "{goal.name}"</DialogTitle></DialogHeader>
            <Form {...form}>
              <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
                <FormField control={form.control} name="amount" render={({ field }) => (
                  <FormItem>
                    <FormLabel>Amount</FormLabel>
                    <FormControl><Input type="number" placeholder="100.00" {...field} /></FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <Button type="submit" className="w-full" disabled={form.formState.isSubmitting}>
                  {form.formState.isSubmitting ? "Adding..." : "Add Funds"}
                </Button>
              </form>
            </Form>
          </DialogContent>
        </Dialog>
      </CardFooter>
    </Card>
  );
}

// ============================================================================
// FILE: components/investments/add-investment-dialog.tsx
// ============================================================================

// ============================================================================
// FILE: components/investments/add-investment-dialog.tsx
// ============================================================================

"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { PlusCircle } from "lucide-react";

import { Button } from "@/components/ui/button";
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { useToast } from "@/components/ui/use-toast";
import { createInvestment } from "@/lib/actions/investment.actions";

const formSchema = z.object({
  name: z.string().min(1, "Name is required."),
  ticker: z.string().min(1, "Ticker is required."),
  quantity: z.coerce.number().positive("Quantity must be positive."),
  purchasePrice: z.coerce.number().positive("Price must be positive."),
});

export function AddInvestmentDialog() {
  const [open, setOpen] = useState(false);
  const { toast } = useToast();
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: { name: "", ticker: "", quantity: 0, purchasePrice: 0 },
  });

  const onSubmit = async (values: z.infer<typeof formSchema>) => {
    const result = await createInvestment(values);
    if (result.success) {
      toast({ title: "Success", description: result.message });
      form.reset();
      setOpen(false);
    } else {
      toast({ title: "Error", description: result.message, variant: "destructive" });
    }
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button><PlusCircle className="mr-2 h-4 w-4" /> Add Investment</Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader><DialogTitle>Track New Investment</DialogTitle></DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField control={form.control} name="name" render={({ field }) => (
              <FormItem>
                <FormLabel>Asset Name</FormLabel>
                <FormControl><Input placeholder="Apple Inc." {...field} /></FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <FormField control={form.control} name="ticker" render={({ field }) => (
              <FormItem>
                <FormLabel>Ticker / Symbol</FormLabel>
                <FormControl><Input placeholder="AAPL" {...field} /></FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <div className="grid grid-cols-2 gap-4">
              <FormField control={form.control} name="quantity" render={({ field }) => (
                <FormItem>
                  <FormLabel>Quantity</FormLabel>
                  <FormControl><Input type="number" step="any" {...field} /></FormControl>
                  <FormMessage />
                </FormItem>
              )} />
              <FormField control={form.control} name="purchasePrice" render={({ field }) => (
                <FormItem>
                  <FormLabel>Purchase Price ($)</FormLabel>
                  <FormControl><Input type="number" step="0.01" {...field} /></FormControl>
                  <FormMessage />
                </FormItem>
              )} />
            </div>
            <Button type="submit" className="w-full" disabled={form.formState.isSubmitting}>
              {form.formState.isSubmitting ? "Adding..." : "Add Investment"}
            </Button>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}

// ============================================================================
// FILE: components/investments/investment-table.tsx
// ============================================================================

// ============================================================================
// FILE: components/investments/investments-table.tsx
// ============================================================================

"use client";

import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";
import { Button } from "@/components/ui/button";
import { Trash2 } from "lucide-react";
import { formatCurrency } from "@/lib/utils";
import { deleteInvestment } from "@/lib/actions/investment.actions";
import { useToast } from "@/components/ui/use-toast";
import type { Investment } from "@prisma/client";

export function InvestmentsTable({ investments }: { investments: Investment[] }) {
  const { toast } = useToast();

  const handleDelete = async (id: string) => {
    if (confirm("Are you sure you want to delete this investment?")) {
      const result = await deleteInvestment(id);
      if (result.success) {
        toast({ title: "Deleted", description: "Investment removed successfully." });
      } else {
        toast({ title: "Error", description: result.message, variant: "destructive" });
      }
    }
  };

  return (
    <div className="rounded-md border">
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead>Ticker</TableHead>
            <TableHead>Name</TableHead>
            <TableHead className="text-right">Qty</TableHead>
            <TableHead className="text-right">Buy Price</TableHead>
            <TableHead className="text-right">Total Value</TableHead>
            <TableHead className="w-[50px]"></TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {investments.map((inv) => (
            <TableRow key={inv.id}>
              <TableCell className="font-medium">{inv.ticker}</TableCell>
              <TableCell>{inv.name}</TableCell>
              <TableCell className="text-right">{inv.quantity}</TableCell>
              <TableCell className="text-right">{formatCurrency(inv.purchasePrice)}</TableCell>
              <TableCell className="text-right font-bold text-green-600">
                {formatCurrency(inv.quantity * inv.purchasePrice)} {/* Mocking current value logic */}
              </TableCell>
              <TableCell>
                <Button variant="ghost" size="icon" onClick={() => handleDelete(inv.id)}>
                  <Trash2 className="h-4 w-4 text-destructive" />
                </Button>
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  );
}

// ============================================================================
// FILE: components/landing/features.tsx
// ============================================================================

// components/landing/features.tsx
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { DollarSign, BarChart, Trophy, Bot } from "lucide-react";

const featureList = [
    { icon: <DollarSign className="w-8 h-8 text-primary" />, title: "Transaction Management", description: "Log income and expenses with ease. Categorize, sort, and filter to understand your spending habits." },
    { icon: <BarChart className="w-8 h-8 text-primary" />, title: "Financial Planning", description: "Create and track financial goals. Set budgets for spending categories and monitor your progress in real-time." },
    { icon: <Trophy className="w-8 h-8 text-primary" />, title: "Gamification", description: "Earn XP and level up by managing your finances. Unlock new features and themes as you go." },
    { icon: <Bot className="w-8 h-8 text-primary" />, title: "AI-Powered Insights", description: "Get a detailed analysis of your financial health with actionable recommendations from our integrated AI." },
]

export function Features() {
  return (
    <section id="features" className="w-full py-24 sm:py-32">
        <div className="container">
            <div className="text-center mb-12">
                <h2 className="text-3xl font-bold tracking-tight sm:text-4xl">Everything You Need to Succeed</h2>
                <p className="mt-4 text-lg text-muted-foreground">
                    All the tools to take control of your financial future, in one place.
                </p>
            </div>
            <div className="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-4">
                {featureList.map(feature => (
                     <Card key={feature.title} className="text-center">
                        <CardHeader>
                            <div className="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-primary/10 mb-4">
                               {feature.icon}
                            </div>
                            <CardTitle>{feature.title}</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <p className="text-muted-foreground">{feature.description}</p>
                        </CardContent>
                     </Card>
                ))}
            </div>
        </div>
    </section>
  );
}

// ============================================================================
// FILE: components/landing/hero.tsx
// ============================================================================

// components/landing/hero.tsx
"use client"

import * as React from "react"
import Image from "next/image"
import Link from "next/link"
import { cn } from "@/lib/utils"
import { Mockup, MockupFrame } from "@/components/ui/mockup"
import { ArrowRight } from "lucide-react"

interface HeroProps extends React.HTMLAttributes<HTMLDivElement> {
  title: React.ReactNode
  subtitle?: string
  eyebrow?: string
  ctaText?: string
  ctaLink?: string
  mockupImage?: {
    src: string
    alt: string
    width: number
    height: number
  }
}

const Hero = React.forwardRef<HTMLDivElement, HeroProps>(
  ({ className, title, subtitle, eyebrow, ctaText, ctaLink, mockupImage, ...props }, ref) => {
    return (
      <section
        ref={ref}
        className={cn("flex flex-col items-center bg-secondary/30", className)}
        {...props}
      >
        <div className="container text-center pt-20 pb-16">
            {eyebrow && (
            <p 
                className="font-instrument-sans uppercase tracking-[0.51em] leading-[133%] text-center text-sm md:text-base mb-8 text-foreground animate-appear opacity-0"
            >
                {eyebrow}
            </p>
            )}

            <h1 
            className="text-4xl md:text-6xl font-semibold leading-tight text-center text-foreground animate-appear opacity-0 [animation-delay:100ms]"
            >
            {title}
            </h1>

            {subtitle && (
            <p 
                className="text-lg md:text-xl max-w-3xl mx-auto text-center font-instrument-sans font-light mt-6 mb-8 leading-relaxed text-muted-foreground animate-appear opacity-0 [animation-delay:300ms]"
            >
                {subtitle}
            </p>
            )}

            {ctaText && ctaLink && (
            <Link href={ctaLink}>
                <div 
                className="inline-flex items-center justify-center gap-2 rounded-md bg-primary px-5 h-12 text-lg font-medium text-primary-foreground transition-colors hover:bg-primary/90 animate-appear opacity-0 [animation-delay:500ms]"
                >
                <span>{ctaText}</span>
                <ArrowRight className="h-5 w-5" />
                </div>
            </Link>
            )}
        </div>

        {mockupImage && (
          <div className="mt-12 w-full relative animate-appear opacity-0 [animation-delay:700ms]">
            <MockupFrame>
              <Mockup type="responsive">
                <Image
                  src={mockupImage.src}
                  alt={mockupImage.alt}
                  width={mockupImage.width}
                  height={mockupImage.height}
                  className="w-full h-auto"
                  priority
                />
              </Mockup>
            </MockupFrame>
            <div
              className="absolute bottom-0 left-0 right-0 w-full h-[303px]"
              style={{
                background: "linear-gradient(to top, oklch(from var(--secondary) l c h / 30%) 0%, oklch(from var(--secondary) l c h / 0%) 100%)",
                zIndex: 10,
              }}
            />
          </div>
        )}
      </section>
    )
  }
)
Hero.displayName = "Hero"

export { Hero }

// ============================================================================
// FILE: components/landing/navbar.tsx
// ============================================================================

// components/landing/navbar.tsx
"use client"

import * as React from "react"
import Link from "next/link"
import { usePathname } from "next/navigation"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet"
import { Menu, Wallet } from "lucide-react"

const navLinks = [
  { name: "Features", href: "#features" },
  { name: "Pricing", href: "#pricing" },
  { name: "About", href: "#about" },
]

export function Navbar() {
  const [open, setOpen] = React.useState(false)
  const pathname = usePathname()

  React.useEffect(() => {
    setOpen(false)
  }, [pathname])

  return (
    <header className="sticky top-0 z-50 w-full border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-14 max-w-screen-2xl items-center">
        <div className="mr-4 hidden md:flex">
          <Link href="/" className="mr-6 flex items-center space-x-2">
            <Wallet className="h-6 w-6" />
            <span className="hidden font-bold sm:inline-block">
              Finances Expert Pro
            </span>
          </Link>
          <nav className="flex items-center gap-6 text-sm">
            {navLinks.map((link) => (
              <Link
                key={link.href}
                href={link.href}
                className={cn(
                  "transition-colors hover:text-foreground/80",
                  "text-foreground/60"
                )}
              >
                {link.name}
              </Link>
            ))}
          </nav>
        </div>
        
        {/* Mobile Nav */}
        <div className="flex items-center md:hidden">
            <Sheet open={open} onOpenChange={setOpen}>
            <SheetTrigger asChild>
                <Button
                variant="ghost"
                className="mr-2 px-0 text-base hover:bg-transparent focus-visible:bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0"
                >
                <Menu className="h-5 w-5" />
                <span className="sr-only">Toggle Menu</span>
                </Button>
            </SheetTrigger>
            <SheetContent side="left" className="pr-0">
                <Link
                href="/"
                className="mb-4 flex items-center"
                onClick={() => setOpen(false)}
                >
                <Wallet className="mr-2 h-4 w-4" />
                <span className="font-bold">Finances Expert Pro</span>
                </Link>
                <div className="flex flex-col gap-4">
                {navLinks.map((link) => (
                    <Link
                    key={link.href}
                    href={link.href}
                    onClick={() => setOpen(false)}
                    className="text-muted-foreground"
                    >
                    {link.name}
                    </Link>
                ))}
                </div>
            </SheetContent>
            </Sheet>
            <Link href="/" className="flex items-center space-x-2">
                <Wallet className="h-6 w-6" />
                <span className="font-bold">Finances Pro</span>
            </Link>
        </div>
        
        <div className="flex flex-1 items-center justify-end space-x-2">
            <Button asChild>
                <Link href="/login">Get Started</Link>
            </Button>
        </div>
      </div>
    </header>
  )
}

// ============================================================================
// FILE: components/landing/pricing.tsx
// ============================================================================

// components/landing/pricing.tsx
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import Link from "next/link";

export function Pricing() {
  return (
    <section id="pricing" className="w-full py-24 sm:py-32">
        <div className="container">
            <div className="bg-secondary/30 rounded-lg p-8 md:p-12">
                <div className="text-center mb-12">
                    <h2 className="text-3xl font-bold">Simple, Transparent Pricing</h2>
                    <p className="text-muted-foreground mt-4 max-w-2xl mx-auto">
                    Start for free and unlock powerful features as you grow. No hidden fees, ever.
                    </p>
                </div>
                <div className="flex justify-center">
                    <Card className="w-full max-w-sm">
                        <CardHeader className="text-center">
                            <CardTitle>Pro Plan</CardTitle>
                            <CardDescription>All features included.</CardDescription>
                        </CardHeader>
                        <CardContent className="text-center">
                            <p>
                                <span className="text-4xl font-bold">$0</span>
                                <span className="text-muted-foreground">/ month</span>
                            </p>
                            <p className="text-sm text-muted-foreground mt-2">This project is for demonstration purposes.</p>
                        </CardContent>
                        <CardFooter>
                            <Button asChild className="w-full">
                                <Link href="/register">Get Started Now</Link>
                            </Button>
                        </CardFooter>
                    </Card>
                </div>
            </div>
        </div>
    </section>
  );
}

// ============================================================================
// FILE: components/layout/HeaderClient.tsx
// ============================================================================

// components/layout/HeaderClient.tsx
"use client";

import React, { useState, useEffect } from "react";
import Link from "next/link";
import {
  Menu,
  X,
  LogOut,
  Settings,
  LayoutDashboard,
} from "lucide-react";
import { motion, AnimatePresence } from "framer-motion";
import { cn } from "@/lib/utils";
import { Logo } from "../global/logo";
import { siteConfig } from "@/lib/config";
import { Button } from "../ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { signOut } from "next-auth/react";
import { Skeleton } from "../ui/skeleton";
import { ThemeToggle } from "@/components/global/ThemeToggle";

// Dummy user type since next-auth types aren't fully available
interface DummyUser {
  name?: string | null;
  email?: string | null;
  image?: string | null;
}

interface HeaderClientProps {
  user: DummyUser | null;
}

export function HeaderClient({ user }: HeaderClientProps) {
  const [menuState, setMenuState] = useState(false);
  const [isScrolled, setIsScrolled] = useState(false);
  const [activeSection, setActiveSection] = useState(
    siteConfig.menuItems[0]?.id || ""
  );

  useEffect(() => {
    const handleScroll = () => setIsScrolled(window.scrollY > 20);
    window.addEventListener("scroll", handleScroll, { passive: true });
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setActiveSection(entry.target.id);
          }
        });
      },
      { rootMargin: `-50% 0px -50% 0px` }
    );

    const sections = siteConfig.menuItems
      .map((item) => document.getElementById(item.id))
      .filter((el): el is HTMLElement => el !== null);
      
    sections.forEach((section) => observer.observe(section));

    return () => sections.forEach((section) => observer.unobserve(section));
  }, []);

  const getInitials = (name?: string | null) =>
    name
      ? name
          .split(" ")
          .map((n) => n[0])
          .join("")
          .toUpperCase()
      : "U";

  return (
    <header className="fixed top-0 left-0 right-0 z-50">
      <nav
        data-state={menuState ? "active" : "inactive"}
        className="w-full px-2 group"
      >
        <div
          className={cn(
            "mx-auto mt-2 flex items-center justify-between transition-all duration-300",
            isScrolled
              ? "max-w-4xl rounded-full border border-border/40 bg-background/60 p-2 pl-4 backdrop-blur-lg shadow-sm"
              : "max-w-6xl p-2.5"
          )}
        >
          <div className="flex items-center">
            <Logo hideText={false} className="text-foreground" />
          </div>

          <div className="hidden lg:flex">
            <ul
              className={cn(
                "relative flex items-center gap-4 text-sm transition-all duration-300",
                isScrolled && "ml-4"
              )}
            >
              {siteConfig.menuItems.map((item) => (
                <li key={item.id} className="relative">
                  <Link
                    href={item.href}
                    onClick={() => setActiveSection(item.id)}
                    className={cn(
                      "block px-3 py-1.5 transition-colors",
                      activeSection === item.id
                        ? "text-foreground font-medium"
                        : "text-muted-foreground hover:text-foreground"
                    )}
                  >
                    <span>{item.name}</span>
                  </Link>
                  {activeSection === item.id && (
                    <motion.div
                      layoutId="active-pill"
                      className="absolute inset-0 z-[-1] rounded-full bg-secondary/50"
                      transition={{
                        type: "spring",
                        stiffness: 350,
                        damping: 30,
                      }}
                    />
                  )}
                </li>
              ))}
            </ul>
          </div>

          <div className="flex items-center gap-2">
            <div className="hidden lg:flex items-center gap-2">
              <ThemeToggle />
              {user ? (
                <DropdownMenu>
                  <DropdownMenuTrigger asChild>
                    <Button
                      variant="ghost"
                      size="icon"
                      className="overflow-hidden rounded-full h-8 w-8"
                    >
                      <Avatar className="h-8 w-8">
                        <AvatarImage
                          src={user?.image || undefined}
                          alt={user?.name || "User"}
                        />
                        <AvatarFallback>
                          {getInitials(user?.name)}
                        </AvatarFallback>
                      </Avatar>
                    </Button>
                  </DropdownMenuTrigger>
                  <DropdownMenuContent align="end" className="w-56">
                    <DropdownMenuLabel>
                      <div className="flex flex-col space-y-1">
                        <p className="text-sm font-medium leading-none">
                          {user?.name || <Skeleton className="h-4 w-20" />}
                        </p>
                        <p className="text-xs leading-none text-muted-foreground">
                          {user?.email || (
                            <Skeleton className="h-3 w-32 mt-1" />
                          )}
                        </p>
                      </div>
                    </DropdownMenuLabel>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem asChild>
                      <Link
                        href="/dashboard"
                        className="flex items-center w-full"
                      >
                        <LayoutDashboard className="mr-2 h-4 w-4" />
                        Dashboard
                      </Link>
                    </DropdownMenuItem>
                    <DropdownMenuItem asChild>
                      <Link
                        href="/settings"
                        className="flex items-center w-full"
                      >
                        <Settings className="mr-2 h-4 w-4" />
                        <span>Settings</span>
                      </Link>
                    </DropdownMenuItem>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem
                      onClick={() => signOut({ callbackUrl: "/login" })}
                    >
                      <LogOut className="mr-2 h-4 w-4" />
                      <span>Logout</span>
                    </DropdownMenuItem>
                  </DropdownMenuContent>
                </DropdownMenu>
              ) : (
                <>
                  <Button
                    asChild
                    variant="ghost"
                    size="sm"
                    className="text-muted-foreground hover:text-foreground"
                  >
                    <Link href="/login">Sign In</Link>
                  </Button>
                  <Button asChild size="sm">
                    <Link href="/register">Get Started</Link>
                  </Button>
                </>
              )}
            </div>

            <button
              onClick={() => setMenuState(!menuState)}
              aria-label={menuState ? "Close Menu" : "Open Menu"}
              className="relative z-20 -m-2.5 block cursor-pointer p-2.5 lg:hidden text-foreground"
            >
              <Menu className="group-data-[state=inactive]:scale-100 group-data-[state=inactive]:opacity-100 group-data-[state=active]:scale-0 group-data-[state=active]:opacity-0 m-auto size-6 transition-all duration-200" />
              <X className="group-data-[state=inactive]:scale-0 group-data-[state=inactive]:opacity-0 group-data-[state=active]:scale-100 group-data-[state=active]:opacity-100 absolute inset-0 m-auto size-6 transition-all duration-200" />
            </button>
          </div>
        </div>

        <AnimatePresence>
          {menuState && (
            <motion.div
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -20 }}
              className="lg:hidden absolute left-0 w-full mt-2 px-2"
            >
              <div className="rounded-2xl border border-border/40 bg-background/95 p-6 backdrop-blur-lg shadow-xl">
                <ul className="space-y-6 text-base">
                  {siteConfig.menuItems.map((item) => (
                    <li key={item.id}>
                      <Link
                        href={item.href}
                        onClick={() => setMenuState(false)}
                        className="text-muted-foreground hover:text-foreground block duration-150"
                      >
                        <span>{item.name}</span>
                      </Link>
                    </li>
                  ))}
                </ul>
                <div className="w-full border-t border-border/10 pt-4 mt-6 flex flex-col gap-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Theme</span>
                    <ThemeToggle />
                  </div>
                  <div className="flex flex-col gap-3 w-full">
                    {user ? (
                      <Button asChild className="w-full">
                        <Link href="/dashboard">Dashboard</Link>
                      </Button>
                    ) : (
                      <>
                        <Button asChild variant="outline" className="w-full">
                          <Link href="/login">Sign In</Link>
                        </Button>
                        <Button asChild className="w-full">
                          <Link href="/register">Get Started</Link>
                        </Button>
                      </>
                    )}
                  </div>
                </div>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </nav>
    </header>
  );
}

// ============================================================================
// FILE: components/layout/footer.tsx
// ============================================================================

// components/layout/footer.tsx
import { siteConfig } from "@/lib/config";
import { Logo } from "../global/logo";

export function Footer() {
    return (
        <footer className="border-t">
            <div className="container py-12">
                <div className="flex flex-col items-center justify-center gap-4">
                    <Logo />
                    <p className="text-center text-sm leading-loose text-muted-foreground">
                        Built with Next.js and Shadcn/UI.
                    </p>
                     <p className="text-center text-sm text-muted-foreground">
                        © {new Date().getFullYear()} {siteConfig.name}. All Rights Reserved.
                    </p>
                </div>
            </div>
        </footer>
    )
}

// ============================================================================
// FILE: components/layout/header-main.tsx
// ============================================================================

// components/layout/

"use client";

import Link from "next/link";
import { User } from "next-auth";
import { signOut } from "next-auth/react";
import { Search, LogOut, Settings } from "lucide-react";
import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { Input } from "@/components/ui/input";
import { SidebarTrigger } from "@/components/ui/sidebar";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { getInitials } from "@/lib/utils";

interface HeaderMainProps {
  user: User;
}

export function HeaderMain({ user }: HeaderMainProps) {
  return (
    <header className="sticky top-0 z-30 flex h-14 items-center gap-4 border-b bg-background px-4 sm:px-6">
      <div className="flex items-center gap-2">
        <SidebarTrigger className="sm:hidden" /> {/* For mobile */}
        <SidebarTrigger className="hidden sm:flex" /> {/* For desktop */}
      </div>

      <div className="relative ml-auto flex-1 md:grow-0">
        <Search className="absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground" />
        <Input
          type="search"
          placeholder="Search..."
          className="w-full rounded-lg bg-background pl-8 md:w-[200px] lg:w-[320px]"
        />
      </div>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button
            variant="outline"
            size="icon"
            className="overflow-hidden rounded-full"
          >
            <Avatar className="h-8 w-8">
              <AvatarImage src={user.image ?? undefined} alt={user.name ?? ""} />
              <AvatarFallback>{getInitials(user.name)}</AvatarFallback>
            </Avatar>
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end">
          <DropdownMenuLabel>{user.name ?? "My Account"}</DropdownMenuLabel>
          <DropdownMenuSeparator />
          <DropdownMenuItem asChild>
            <Link href="/settings">
              <Settings className="mr-2 h-4 w-4" />
              Settings
            </Link>
          </DropdownMenuItem>
          <DropdownMenuSeparator />
          <DropdownMenuItem onClick={() => signOut({ callbackUrl: "/" })}>
            <LogOut className="mr-2 h-4 w-4" />
            Logout
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    </header>
  );
}

// ============================================================================
// FILE: components/layout/header.tsx
// ============================================================================

// components/layout/header.tsx
import { HeaderClient } from "./HeaderClient";

export async function Header() {
  // In a real app, you would fetch the server session here:
  // const session = await getServerSession(authOptions);
  // For this landing page, we'll assume the user is not logged in.
  const user = null;
  return <HeaderClient user={user} />;
}

// ============================================================================
// FILE: components/layout/sidebar.tsx
// ============================================================================

// components/layout/sidebar.tsx

"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { User } from "next-auth";
import {
  Sidebar as ShadcnSidebar,
  SidebarHeader,
  SidebarContent,
  SidebarMenu,
  SidebarMenuItem,
  SidebarMenuButton,
  SidebarFooter,
} from "@/components/ui/sidebar";
import { Logo } from "@/components/global/logo";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  LayoutDashboard,
  Wallet,
  Landmark,
  Target,
  BarChart,
  Settings,
  Home,
  CreditCard,
} from "lucide-react";
import { getInitials } from "@/lib/utils"; 

const navItems = [
  { href: "/dashboard", label: "Dashboard", icon: LayoutDashboard },
  { href: "/transactions", label: "Transactions", icon: Wallet },
  { href: "/budgets", label: "Budgets", icon: Landmark },
  { href: "/goals", label: "Goals", icon: Target },
  { href: "/investments", label: "Investments", icon: BarChart },
  { href: "/patrimoine", label: "Patrimoine", icon: Home },
  { href: "/debts", label: "Debts", icon: CreditCard },
  { href: "/settings", label: "Settings", icon: Settings },
];

interface SidebarProps {
  user: User;
}

export function Sidebar({ user }: SidebarProps) {
  const pathname = usePathname();

  return (
    <ShadcnSidebar>
      <SidebarHeader>
        <Logo />
      </SidebarHeader>
      
      <SidebarContent className="mt-8">
        <SidebarMenu className="gap-y-2">
          {navItems.map((item) => (
            <SidebarMenuItem key={item.href}>
              <SidebarMenuButton
                asChild
                isActive={pathname === item.href}
                tooltip={item.label}
              >
                <Link href={item.href}>
                  <item.icon />
                  <span>{item.label}</span>
                </Link>
              </SidebarMenuButton>
            </SidebarMenuItem>
          ))}
        </SidebarMenu>
      </SidebarContent>

      <SidebarFooter>
        <div className="flex items-center gap-3 p-2">
          <Avatar className="h-9 w-9">
            <AvatarImage src={user.image ?? undefined} />
            <AvatarFallback>{getInitials(user.name)}</AvatarFallback>
          </Avatar>
          <div className="overflow-hidden whitespace-nowrap">
            <p className="font-medium truncate">{user.name}</p>
            <p className="text-xs text-muted-foreground truncate">
              {user.email}
            </p>
          </div>
        </div>
      </SidebarFooter>
    </ShadcnSidebar>
  );
}

// ============================================================================
// FILE: components/patrimoine/add-asset-dialog.tsx
// ============================================================================

// components/patrimoine/add-asset-dialog.tsx (NEW FILE)
"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { PlusCircle } from "lucide-react";
import {
  Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { useToast } from "@/components/ui/use-toast";
import { createAsset } from "@/lib/actions/patrimoine.actions";

const formSchema = z.object({
  name: z.string().min(1, "Asset name is required."),
  value: z.coerce.number().positive("Value must be a positive number."),
  type: z.enum(["SAVINGS", "REAL_ESTATE", "OTHER"]),
});

export function AddAssetDialog() {
  const [open, setOpen] = useState(false);
  const { toast } = useToast();

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
  });

  const onSubmit = async (values: z.infer<typeof formSchema>) => {
    const result = await createAsset(values);
    if (result.success) {
      toast({ title: "Success", description: result.message });
      form.reset();
      setOpen(false);
    } else {
      toast({ title: "Error", description: result.message, variant: "destructive" });
    }
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button><PlusCircle className="mr-2 h-4 w-4" /> Add Asset</Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader><DialogTitle>Track a New Asset</DialogTitle></DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField control={form.control} name="name" render={({ field }) => (
              <FormItem>
                <FormLabel>Asset Name</FormLabel>
                <FormControl><Input placeholder="e.g., Main Savings Account" {...field} /></FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <FormField control={form.control} name="value" render={({ field }) => (
              <FormItem>
                <FormLabel>Current Value</FormLabel>
                <FormControl><Input type="number" placeholder="10000.00" {...field} /></FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <FormField control={form.control} name="type" render={({ field }) => (
              <FormItem>
                <FormLabel>Asset Type</FormLabel>
                <Select onValueChange={field.onChange} defaultValue={field.value}>
                  <FormControl>
                    <SelectTrigger><SelectValue placeholder="Select a type" /></SelectTrigger>
                  </FormControl>
                  <SelectContent>
                    <SelectItem value="SAVINGS">Savings</SelectItem>
                    <SelectItem value="REAL_ESTATE">Real Estate</SelectItem>
                    <SelectItem value="OTHER">Other</SelectItem>
                  </SelectContent>
                </Select>
                <FormMessage />
              </FormItem>
            )} />
            <Button type="submit" className="w-full" disabled={form.formState.isSubmitting}>
              {form.formState.isSubmitting ? "Adding..." : "Add Asset"}
            </Button>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}

// ============================================================================
// FILE: components/patrimoine/asset-card.tsx
// ============================================================================

// components/patrimoine/asset-card.tsx (NEW FILE)
import type { Asset } from "@prisma/client";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { formatCurrency } from "@/lib/utils";
import { Home, PiggyBank, Package } from "lucide-react";
import { Badge } from "../ui/badge";

const assetIcons: { [key: string]: React.ReactNode } = {
  SAVINGS: <PiggyBank className="h-6 w-6 text-primary" />,
  REAL_ESTATE: <Home className="h-6 w-6 text-primary" />,
  OTHER: <Package className="h-6 w-6 text-primary" />,
};

const assetTypeMap: { [key: string]: string } = {
    SAVINGS: "Savings",
    REAL_ESTATE: "Real Estate",
    OTHER: "Other"
}

export function AssetCard({ asset }: { asset: Asset }) {
  return (
    <Card>
      <CardHeader>
        <div className="flex items-center gap-4">
          <div className="bg-primary/10 p-2 rounded-lg">
            {assetIcons[asset.type] || assetIcons.OTHER}
          </div>
          <div>
            <CardTitle>{asset.name}</CardTitle>
            <CardDescription>
                <Badge variant="outline" className="mt-1">{assetTypeMap[asset.type]}</Badge>
            </CardDescription>
          </div>
        </div>
      </CardHeader>
      <CardContent>
        <p className="text-2xl font-bold">{formatCurrency(asset.value)}</p>
        <p className="text-xs text-muted-foreground">Current Value</p>
      </CardContent>
    </Card>
  );
}

// ============================================================================
// FILE: components/providers.tsx
// ============================================================================

// components/providers.tsx
"use client";

import * as React from "react";
import { ThemeProvider as NextThemesProvider } from "next-themes";
import { type ThemeProviderProps } from "next-themes";
import { SessionProvider } from "next-auth/react";
import { ThemeProvider } from "@/context/useTheme";

export function Providers({ children, ...props }: ThemeProviderProps) {
  return (
    <SessionProvider>
      <ThemeProvider {...props}>{children}</ThemeProvider>
    </SessionProvider>
  );
}

// ============================================================================
// FILE: components/settings/preferences-form.tsx
// ============================================================================

// components/settings/preferences-form.tsx (NEW FILE)
"use client";

import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Switch } from "@/components/ui/switch";

export function PreferencesForm() {
    // This would be backed by state and server actions in a real app
  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between rounded-lg border p-4">
        <div className="space-y-0.5">
          <Label className="text-base">Marketing Emails</Label>
          <p className="text-sm text-muted-foreground">
            Receive emails about new features and tips.
          </p>
        </div>
        <Switch defaultChecked />
      </div>
      <div className="flex items-center justify-between rounded-lg border p-4">
        <div className="space-y-0.5">
          <Label className="text-base">Currency</Label>
          <p className="text-sm text-muted-foreground">
            Select your preferred currency for display.
          </p>
        </div>
        <Button variant="outline" size="sm">
          USD ($)
        </Button>
      </div>
      <div className="flex justify-end">
          <Button>Save Preferences</Button>
      </div>
    </div>
  );
}

// ============================================================================
// FILE: components/settings/profile-form.tsx
// ============================================================================

// components/settings/profile-form.tsx (NEW FILE)
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { updateUserProfile } from "@/lib/actions/user.actions";
import { useToast } from "../ui/use-toast";
import { useState } from "react";
import { Loader2 } from "lucide-react";

const formSchema = z.object({
  name: z.string().min(2, "Name must be at least 2 characters."),
});

interface ProfileFormProps {
    user: {
        id: string;
        name?: string | null;
        email?: string | null;
        image?: string | null;
        initials: string;
    }
}

export function ProfileForm({ user }: ProfileFormProps) {
    const { toast } = useToast();
    const [isLoading, setIsLoading] = useState(false);

    const form = useForm<z.infer<typeof formSchema>>({
        resolver: zodResolver(formSchema),
        defaultValues: {
            name: user.name || "",
        },
    });

    const onSubmit = async (values: z.infer<typeof formSchema>) => {
        setIsLoading(true);
        const result = await updateUserProfile(values);
        if (result.success) {
            toast({ title: "Success", description: "Profile updated successfully." });
        } else {
            toast({ title: "Error", description: result.message, variant: "destructive" });
        }
        setIsLoading(false);
    }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
        <div className="flex items-center gap-4">
          <Avatar className="h-20 w-20">
            <AvatarImage src={user?.image || undefined} />
            <AvatarFallback className="text-lg">{user.initials}</AvatarFallback>
          </Avatar>
          <Button variant="outline" type="button">Change Avatar</Button>
        </div>

        <div className="grid gap-4 md:grid-cols-2">
            <FormField
                control={form.control}
                name="name"
                render={({ field }) => (
                    <FormItem>
                        <FormLabel>Full Name</FormLabel>
                        <FormControl>
                            <Input id="name" {...field} />
                        </FormControl>
                        <FormMessage />
                    </FormItem>
                )}
            />
          <div className="space-y-2">
            <FormLabel htmlFor="email">Email</FormLabel>
            <Input id="email" defaultValue={user?.email || ""} disabled className="bg-muted" />
          </div>
        </div>

        <div className="flex justify-end">
          <Button type="submit" disabled={isLoading}>
            {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin"/>}
            Save Changes
          </Button>
        </div>
      </form>
    </Form>
  );
}

// ============================================================================
// FILE: components/transactions/add-transaction-dialog.tsx
// ============================================================================

// components/transactions/add-transaction-dialog.tsx
"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { CalendarIcon, PlusCircle } from "lucide-react";
import { format } from "date-fns";

import { Button } from "@/components/ui/button";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { Calendar } from "@/components/ui/calendar";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { cn } from "@/lib/utils";
import { createTransaction } from "@/lib/actions/transaction.actions";
import { useToast } from "@/components/ui/use-toast"; // We need to create this hook

const formSchema = z.object({
  name: z.string().min(1, "Name is required."),
  amount: z.coerce.number().positive("Amount must be a positive number."),
  type: z.enum(["INCOME", "EXPENSE"]),
  category: z.string().min(1, "Category is required."),
  date: z.date(),
});

const categories = {
  INCOME: ["Salary", "Freelance", "Investment", "Other"],
  EXPENSE: ["Food", "Transport", "Housing", "Entertainment", "Utilities", "Other"],
};

export function AddTransactionDialog() {
  const [open, setOpen] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const { toast } = useToast();

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      name: "",
      amount: 0,
      type: "EXPENSE",
      date: new Date(),
    },
  });

  const transactionType = form.watch("type");

  const onSubmit = async (values: z.infer<typeof formSchema>) => {
    setIsLoading(true);
    const result = await createTransaction(values);
    setIsLoading(false);

    if (result.success) {
      toast({ title: "Success", description: result.message });
      form.reset();
      setOpen(false);
    } else {
      toast({
        title: "Error",
        description: result.message,
        variant: "destructive",
      });
    }
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button>
          <PlusCircle className="mr-2 h-4 w-4" /> Add Transaction
        </Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Add a New Transaction</DialogTitle>
        </DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Name</FormLabel>
                  <FormControl>
                    <Input placeholder="e.g., Coffee" {...field} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="amount"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Amount</FormLabel>
                  <FormControl>
                    <Input type="number" placeholder="0.00" {...field} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <div className="grid grid-cols-2 gap-4">
              <FormField
                control={form.control}
                name="type"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Type</FormLabel>
                    <Select onValueChange={field.onChange} defaultValue={field.value}>
                      <FormControl>
                        <SelectTrigger>
                          <SelectValue placeholder="Select type" />
                        </SelectTrigger>
                      </FormControl>
                      <SelectContent>
                        <SelectItem value="INCOME">Income</SelectItem>
                        <SelectItem value="EXPENSE">Expense</SelectItem>
                      </SelectContent>
                    </Select>
                  </FormItem>
                )}
              />
              <FormField
                control={form.control}
                name="category"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Category</FormLabel>
                    <Select onValueChange={field.onChange} defaultValue={field.value}>
                      <FormControl>
                        <SelectTrigger>
                          <SelectValue placeholder="Select category" />
                        </SelectTrigger>
                      </FormControl>
                      <SelectContent>
                        {categories[transactionType].map((cat) => (
                          <SelectItem key={cat} value={cat}>{cat}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </FormItem>
                )}
              />
            </div>
            <FormField
              control={form.control}
              name="date"
              render={({ field }) => (
                <FormItem className="flex flex-col">
                  <FormLabel>Date</FormLabel>
                  <Popover>
                    <PopoverTrigger asChild>
                      <FormControl>
                        <Button
                          variant="outline"
                          className={cn(
                            "w-full pl-3 text-left font-normal",
                            !field.value && "text-muted-foreground"
                          )}
                        >
                          {field.value ? (
                            format(field.value, "PPP")
                          ) : (
                            <span>Pick a date</span>
                          )}
                          <CalendarIcon className="ml-auto h-4 w-4 opacity-50" />
                        </Button>
                      </FormControl>
                    </PopoverTrigger>
                    <PopoverContent className="w-auto p-0" align="start">
                      <Calendar
                        mode="single"
                        selected={field.value}
                        onSelect={field.onChange}
                        initialFocus
                      />
                    </PopoverContent>
                  </Popover>
                  <FormMessage />
                </FormItem>
              )}
            />
            <Button type="submit" className="w-full" disabled={isLoading}>
              {isLoading ? "Adding..." : "Add Transaction"}
            </Button>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}

// ============================================================================
// FILE: components/transactions/transactions-table.tsx
// ============================================================================

// components/transactions/transactions-table.tsx
"use client";

import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Badge } from "@/components/ui/badge";
import { format } from "date-fns";
import type { Transaction } from "@prisma/client";
import { formatCurrency } from "@/lib/utils";

interface TransactionsTableProps {
  transactions: Transaction[];
}

export function TransactionsTable({ transactions }: TransactionsTableProps) {
  return (
    <div className="rounded-lg border">
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead>Name</TableHead>
            <TableHead>Category</TableHead>
            <TableHead>Date</TableHead>
            <TableHead className="text-right">Amount</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {transactions.map((transaction) => (
            <TableRow key={transaction.id}>
              <TableCell className="font-medium">{transaction.name}</TableCell>
              <TableCell>
                 <Badge variant="outline">{transaction.category}</Badge>
              </TableCell>
              <TableCell>{format(transaction.date, "PPP")}</TableCell>
              <TableCell
                className={`text-right font-medium ${
                  transaction.type === "INCOME"
                    ? "text-green-600"
                    : "text-red-600"
                }`}
              >
                {transaction.type === "INCOME" ? "+" : "-"}
                {formatCurrency(transaction.amount)}
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  );
}

// ============================================================================
// FILE: components/ui/accordion.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDownIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Accordion({
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />
}

function AccordionItem({
  className,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn("border-b last:border-b-0", className)}
      {...props}
    />
  )
}

function AccordionTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          "focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",
          className
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  )
}

function AccordionContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn("pt-0 pb-4", className)}>{children}</div>
    </AccordionPrimitive.Content>
  )
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }


// ============================================================================
// FILE: components/ui/alert-dialog.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

function AlertDialog({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />
}

function AlertDialogTrigger({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return (
    <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
  )
}

function AlertDialogPortal({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return (
    <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
  )
}

function AlertDialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogContent({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      />
    </AlertDialogPortal>
  )
}

function AlertDialogHeader({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function AlertDialogFooter({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn("text-lg font-semibold", className)}
      {...props}
    />
  )
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function AlertDialogAction({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {
  return (
    <AlertDialogPrimitive.Action
      className={cn(buttonVariants(), className)}
      {...props}
    />
  )
}

function AlertDialogCancel({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {
  return (
    <AlertDialogPrimitive.Cancel
      className={cn(buttonVariants({ variant: "outline" }), className)}
      {...props}
    />
  )
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}


// ============================================================================
// FILE: components/ui/alert.tsx
// ============================================================================

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  )
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",
        className
      )}
      {...props}
    />
  )
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className
      )}
      {...props}
    />
  )
}

export { Alert, AlertTitle, AlertDescription }


// ============================================================================
// FILE: components/ui/aspect-ratio.tsx
// ============================================================================

"use client"

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

function AspectRatio({
  ...props
}: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />
}

export { AspectRatio }


// ============================================================================
// FILE: components/ui/avatar.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        "relative flex size-8 shrink-0 overflow-hidden rounded-full",
        className
      )}
      {...props}
    />
  )
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props}
    />
  )
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted flex size-full items-center justify-center rounded-full",
        className
      )}
      {...props}
    />
  )
}

export { Avatar, AvatarImage, AvatarFallback }


// ============================================================================
// FILE: components/ui/badge.tsx
// ============================================================================

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span"

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }


// ============================================================================
// FILE: components/ui/breadcrumb.tsx
// ============================================================================

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

function Breadcrumb({ ...props }: React.ComponentProps<"nav">) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<"ol">) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        "text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5",
        className
      )}
      {...props}
    />
  )
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-item"
      className={cn("inline-flex items-center gap-1.5", className)}
      {...props}
    />
  )
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean
}) {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      data-slot="breadcrumb-link"
      className={cn("hover:text-foreground transition-colors", className)}
      {...props}
    />
  )
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn("text-foreground font-normal", className)}
      {...props}
    />
  )
}

function BreadcrumbSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn("[&>svg]:size-3.5", className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  )
}

function BreadcrumbEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  )
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}


// ============================================================================
// FILE: components/ui/button-group.tsx
// ============================================================================

import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { Separator } from "@/components/ui/separator"

const buttonGroupVariants = cva(
  "flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md has-[>[data-slot=button-group]]:gap-2",
  {
    variants: {
      orientation: {
        horizontal:
          "[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none",
        vertical:
          "flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none",
      },
    },
    defaultVariants: {
      orientation: "horizontal",
    },
  }
)

function ButtonGroup({
  className,
  orientation,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof buttonGroupVariants>) {
  return (
    <div
      role="group"
      data-slot="button-group"
      data-orientation={orientation}
      className={cn(buttonGroupVariants({ orientation }), className)}
      {...props}
    />
  )
}

function ButtonGroupText({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & {
  asChild?: boolean
}) {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      className={cn(
        "bg-muted flex items-center gap-2 rounded-md border px-4 text-sm font-medium shadow-xs [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function ButtonGroupSeparator({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="button-group-separator"
      orientation={orientation}
      className={cn(
        "bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto",
        className
      )}
      {...props}
    />
  )
}

export {
  ButtonGroup,
  ButtonGroupSeparator,
  ButtonGroupText,
  buttonGroupVariants,
}


// ============================================================================
// FILE: components/ui/button.tsx
// ============================================================================

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
        "icon-sm": "size-8",
        "icon-lg": "size-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }


// ============================================================================
// FILE: components/ui/calendar.tsx
// ============================================================================

"use client"

import * as React from "react"
import {
  ChevronDownIcon,
  ChevronLeftIcon,
  ChevronRightIcon,
} from "lucide-react"
import { DayButton, DayPicker, getDefaultClassNames } from "react-day-picker"

import { cn } from "@/lib/utils"
import { Button, buttonVariants } from "@/components/ui/button"

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = "label",
  buttonVariant = "ghost",
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>["variant"]
}) {
  const defaultClassNames = getDefaultClassNames()

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        "bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) =>
          date.toLocaleString("default", { month: "short" }),
        ...formatters,
      }}
      classNames={{
        root: cn("w-fit", defaultClassNames.root),
        months: cn(
          "flex gap-4 flex-col md:flex-row relative",
          defaultClassNames.months
        ),
        month: cn("flex flex-col w-full gap-4", defaultClassNames.month),
        nav: cn(
          "flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",
          defaultClassNames.nav
        ),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_previous
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_next
        ),
        month_caption: cn(
          "flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",
          defaultClassNames.month_caption
        ),
        dropdowns: cn(
          "w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",
          defaultClassNames.dropdowns
        ),
        dropdown_root: cn(
          "relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",
          defaultClassNames.dropdown_root
        ),
        dropdown: cn(
          "absolute bg-popover inset-0 opacity-0",
          defaultClassNames.dropdown
        ),
        caption_label: cn(
          "select-none font-medium",
          captionLayout === "label"
            ? "text-sm"
            : "rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",
          defaultClassNames.caption_label
        ),
        table: "w-full border-collapse",
        weekdays: cn("flex", defaultClassNames.weekdays),
        weekday: cn(
          "text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",
          defaultClassNames.weekday
        ),
        week: cn("flex w-full mt-2", defaultClassNames.week),
        week_number_header: cn(
          "select-none w-(--cell-size)",
          defaultClassNames.week_number_header
        ),
        week_number: cn(
          "text-[0.8rem] select-none text-muted-foreground",
          defaultClassNames.week_number
        ),
        day: cn(
          "relative w-full h-full p-0 text-center [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",
          props.showWeekNumber
            ? "[&:nth-child(2)[data-selected=true]_button]:rounded-l-md"
            : "[&:first-child[data-selected=true]_button]:rounded-l-md",
          defaultClassNames.day
        ),
        range_start: cn(
          "rounded-l-md bg-accent",
          defaultClassNames.range_start
        ),
        range_middle: cn("rounded-none", defaultClassNames.range_middle),
        range_end: cn("rounded-r-md bg-accent", defaultClassNames.range_end),
        today: cn(
          "bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",
          defaultClassNames.today
        ),
        outside: cn(
          "text-muted-foreground aria-selected:text-muted-foreground",
          defaultClassNames.outside
        ),
        disabled: cn(
          "text-muted-foreground opacity-50",
          defaultClassNames.disabled
        ),
        hidden: cn("invisible", defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return (
            <div
              data-slot="calendar"
              ref={rootRef}
              className={cn(className)}
              {...props}
            />
          )
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === "left") {
            return (
              <ChevronLeftIcon className={cn("size-4", className)} {...props} />
            )
          }

          if (orientation === "right") {
            return (
              <ChevronRightIcon
                className={cn("size-4", className)}
                {...props}
              />
            )
          }

          return (
            <ChevronDownIcon className={cn("size-4", className)} {...props} />
          )
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="flex size-(--cell-size) items-center justify-center text-center">
                {children}
              </div>
            </td>
          )
        },
        ...components,
      }}
      {...props}
    />
  )
}

function CalendarDayButton({
  className,
  day,
  modifiers,
  ...props
}: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames()

  const ref = React.useRef<HTMLButtonElement>(null)
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus()
  }, [modifiers.focused])

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected &&
        !modifiers.range_start &&
        !modifiers.range_end &&
        !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        "data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",
        defaultClassNames.day,
        className
      )}
      {...props}
    />
  )
}

export { Calendar, CalendarDayButton }


// ============================================================================
// FILE: components/ui/card.tsx
// ============================================================================

import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}


// ============================================================================
// FILE: components/ui/carousel.tsx
// ============================================================================

"use client"

import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

function Carousel({
  orientation = "horizontal",
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === "horizontal" ? "x" : "y",
    },
    plugins
  )
  const [canScrollPrev, setCanScrollPrev] = React.useState(false)
  const [canScrollNext, setCanScrollNext] = React.useState(false)

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return
    setCanScrollPrev(api.canScrollPrev())
    setCanScrollNext(api.canScrollNext())
  }, [])

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev()
  }, [api])

  const scrollNext = React.useCallback(() => {
    api?.scrollNext()
  }, [api])

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === "ArrowLeft") {
        event.preventDefault()
        scrollPrev()
      } else if (event.key === "ArrowRight") {
        event.preventDefault()
        scrollNext()
      }
    },
    [scrollPrev, scrollNext]
  )

  React.useEffect(() => {
    if (!api || !setApi) return
    setApi(api)
  }, [api, setApi])

  React.useEffect(() => {
    if (!api) return
    onSelect(api)
    api.on("reInit", onSelect)
    api.on("select", onSelect)

    return () => {
      api?.off("select", onSelect)
    }
  }, [api, onSelect])

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation:
          orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn("relative", className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  )
}

function CarouselContent({ className, ...props }: React.ComponentProps<"div">) {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div
      ref={carouselRef}
      className="overflow-hidden"
      data-slot="carousel-content"
    >
      <div
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
}

function CarouselItem({ className, ...props }: React.ComponentProps<"div">) {
  const { orientation } = useCarousel()

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
}

function CarouselPrevious({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -left-12 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
}

function CarouselNext({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -right-12 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  )
}

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}


// ============================================================================
// FILE: components/ui/chart.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<"div"> & {
  config: ChartConfig
  children: React.ComponentProps<
    typeof RechartsPrimitive.ResponsiveContainer
  >["children"]
}) {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = "dot",
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
  React.ComponentProps<"div"> & {
    hideLabel?: boolean
    hideIndicator?: boolean
    indicator?: "line" | "dot" | "dashed"
    nameKey?: string
    labelKey?: string
  }) {
  const { config } = useChart()

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null
    }

    const [item] = payload
    const key = `${labelKey || item?.dataKey || item?.name || "value"}`
    const itemConfig = getPayloadConfigFromPayload(config, item, key)
    const value =
      !labelKey && typeof label === "string"
        ? config[label as keyof typeof config]?.label || label
        : itemConfig?.label

    if (labelFormatter) {
      return (
        <div className={cn("font-medium", labelClassName)}>
          {labelFormatter(value, payload)}
        </div>
      )
    }

    if (!value) {
      return null
    }

    return <div className={cn("font-medium", labelClassName)}>{value}</div>
  }, [
    label,
    labelFormatter,
    payload,
    hideLabel,
    labelClassName,
    config,
    labelKey,
  ])

  if (!active || !payload?.length) {
    return null
  }

  const nestLabel = payload.length === 1 && indicator !== "dot"

  return (
    <div
      className={cn(
        "border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",
        className
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload
          .filter((item) => item.type !== "none")
          .map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="text-foreground font-mono font-medium tabular-nums">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
      </div>
    </div>
  )
}

const ChartLegend = RechartsPrimitive.Legend

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = "bottom",
  nameKey,
}: React.ComponentProps<"div"> &
  Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
    hideIcon?: boolean
    nameKey?: string
  }) {
  const { config } = useChart()

  if (!payload?.length) {
    return null
  }

  return (
    <div
      className={cn(
        "flex items-center justify-center gap-4",
        verticalAlign === "top" ? "pb-3" : "pt-3",
        className
      )}
    >
      {payload
        .filter((item) => item.type !== "none")
        .map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
    </div>
  )
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}


// ============================================================================
// FILE: components/ui/checkbox.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { CheckIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="grid place-content-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  )
}

export { Checkbox }


// ============================================================================
// FILE: components/ui/collapsible.tsx
// ============================================================================

"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

function Collapsible({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />
}

function CollapsibleTrigger({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return (
    <CollapsiblePrimitive.CollapsibleTrigger
      data-slot="collapsible-trigger"
      {...props}
    />
  )
}

function CollapsibleContent({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return (
    <CollapsiblePrimitive.CollapsibleContent
      data-slot="collapsible-content"
      {...props}
    />
  )
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent }


// ============================================================================
// FILE: components/ui/command.tsx
// ============================================================================

"use client"

import * as React from "react"
import { Command as CommandPrimitive } from "cmdk"
import { SearchIcon } from "lucide-react"

import { cn } from "@/lib/utils"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className
      )}
      {...props}
    />
  )
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  className,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string
  description?: string
  className?: string
  showCloseButton?: boolean
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent
        className={cn("overflow-hidden p-0", className)}
        showCloseButton={showCloseButton}
      >
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        {...props}
      />
    </div>
  )
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        "max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",
        className
      )}
      {...props}
    />
  )
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  )
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className
      )}
      {...props}
    />
  )
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  )
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}


// ============================================================================
// FILE: components/ui/context-menu.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function ContextMenu({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />
}

function ContextMenuTrigger({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return (
    <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />
  )
}

function ContextMenuGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return (
    <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />
  )
}

function ContextMenuPortal({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return (
    <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />
  )
}

function ContextMenuSub({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />
}

function ContextMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return (
    <ContextMenuPrimitive.RadioGroup
      data-slot="context-menu-radio-group"
      {...props}
    />
  )
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  )
}

function ContextMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

function ContextMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  )
}

function ContextMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  )
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  )
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn(
        "text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function ContextMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function ContextMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}


// ============================================================================
// FILE: components/ui/dialog.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  )
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  )
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}


// ============================================================================
// FILE: components/ui/drawer.tsx
// ============================================================================

"use client"

import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

function Drawer({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />
}

function DrawerTrigger({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />
}

function DrawerPortal({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />
}

function DrawerClose({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />
}

function DrawerOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DrawerContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          "group/drawer-content bg-background fixed z-50 flex h-auto flex-col",
          "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b",
          "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t",
          "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm",
          "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",
          className
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  )
}

function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-header"
      className={cn(
        "flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",
        className
      )}
      {...props}
    />
  )
}

function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  )
}

function DrawerTitle({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  )
}

function DrawerDescription({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}


// ============================================================================
// FILE: components/ui/dropdown-menu.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  )
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  )
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  )
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  )
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  )
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  )
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  )
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  )
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
}


// ============================================================================
// FILE: components/ui/empty.tsx
// ============================================================================

import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

function Empty({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty"
      className={cn(
        "flex min-w-0 flex-1 flex-col items-center justify-center gap-6 rounded-lg border-dashed p-6 text-center text-balance md:p-12",
        className
      )}
      {...props}
    />
  )
}

function EmptyHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty-header"
      className={cn(
        "flex max-w-sm flex-col items-center gap-2 text-center",
        className
      )}
      {...props}
    />
  )
}

const emptyMediaVariants = cva(
  "flex shrink-0 items-center justify-center mb-2 [&_svg]:pointer-events-none [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        icon: "bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function EmptyMedia({
  className,
  variant = "default",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof emptyMediaVariants>) {
  return (
    <div
      data-slot="empty-icon"
      data-variant={variant}
      className={cn(emptyMediaVariants({ variant, className }))}
      {...props}
    />
  )
}

function EmptyTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty-title"
      className={cn("text-lg font-medium tracking-tight", className)}
      {...props}
    />
  )
}

function EmptyDescription({ className, ...props }: React.ComponentProps<"p">) {
  return (
    <div
      data-slot="empty-description"
      className={cn(
        "text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4",
        className
      )}
      {...props}
    />
  )
}

function EmptyContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty-content"
      className={cn(
        "flex w-full max-w-sm min-w-0 flex-col items-center gap-4 text-sm text-balance",
        className
      )}
      {...props}
    />
  )
}

export {
  Empty,
  EmptyHeader,
  EmptyTitle,
  EmptyDescription,
  EmptyContent,
  EmptyMedia,
}


// ============================================================================
// FILE: components/ui/field.tsx
// ============================================================================

"use client"

import { useMemo } from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"
import { Separator } from "@/components/ui/separator"

function FieldSet({ className, ...props }: React.ComponentProps<"fieldset">) {
  return (
    <fieldset
      data-slot="field-set"
      className={cn(
        "flex flex-col gap-6",
        "has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3",
        className
      )}
      {...props}
    />
  )
}

function FieldLegend({
  className,
  variant = "legend",
  ...props
}: React.ComponentProps<"legend"> & { variant?: "legend" | "label" }) {
  return (
    <legend
      data-slot="field-legend"
      data-variant={variant}
      className={cn(
        "mb-3 font-medium",
        "data-[variant=legend]:text-base",
        "data-[variant=label]:text-sm",
        className
      )}
      {...props}
    />
  )
}

function FieldGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="field-group"
      className={cn(
        "group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4",
        className
      )}
      {...props}
    />
  )
}

const fieldVariants = cva(
  "group/field flex w-full gap-3 data-[invalid=true]:text-destructive",
  {
    variants: {
      orientation: {
        vertical: ["flex-col [&>*]:w-full [&>.sr-only]:w-auto"],
        horizontal: [
          "flex-row items-center",
          "[&>[data-slot=field-label]]:flex-auto",
          "has-[>[data-slot=field-content]]:items-start has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px",
        ],
        responsive: [
          "flex-col [&>*]:w-full [&>.sr-only]:w-auto @md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto",
          "@md/field-group:[&>[data-slot=field-label]]:flex-auto",
          "@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px",
        ],
      },
    },
    defaultVariants: {
      orientation: "vertical",
    },
  }
)

function Field({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof fieldVariants>) {
  return (
    <div
      role="group"
      data-slot="field"
      data-orientation={orientation}
      className={cn(fieldVariants({ orientation }), className)}
      {...props}
    />
  )
}

function FieldContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="field-content"
      className={cn(
        "group/field-content flex flex-1 flex-col gap-1.5 leading-snug",
        className
      )}
      {...props}
    />
  )
}

function FieldLabel({
  className,
  ...props
}: React.ComponentProps<typeof Label>) {
  return (
    <Label
      data-slot="field-label"
      className={cn(
        "group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50",
        "has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>*]:data-[slot=field]:p-4",
        "has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10",
        className
      )}
      {...props}
    />
  )
}

function FieldTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="field-label"
      className={cn(
        "flex w-fit items-center gap-2 text-sm leading-snug font-medium group-data-[disabled=true]/field:opacity-50",
        className
      )}
      {...props}
    />
  )
}

function FieldDescription({ className, ...props }: React.ComponentProps<"p">) {
  return (
    <p
      data-slot="field-description"
      className={cn(
        "text-muted-foreground text-sm leading-normal font-normal group-has-[[data-orientation=horizontal]]/field:text-balance",
        "last:mt-0 nth-last-2:-mt-1 [[data-variant=legend]+&]:-mt-1.5",
        "[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",
        className
      )}
      {...props}
    />
  )
}

function FieldSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  children?: React.ReactNode
}) {
  return (
    <div
      data-slot="field-separator"
      data-content={!!children}
      className={cn(
        "relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2",
        className
      )}
      {...props}
    >
      <Separator className="absolute inset-0 top-1/2" />
      {children && (
        <span
          className="bg-background text-muted-foreground relative mx-auto block w-fit px-2"
          data-slot="field-separator-content"
        >
          {children}
        </span>
      )}
    </div>
  )
}

function FieldError({
  className,
  children,
  errors,
  ...props
}: React.ComponentProps<"div"> & {
  errors?: Array<{ message?: string } | undefined>
}) {
  const content = useMemo(() => {
    if (children) {
      return children
    }

    if (!errors?.length) {
      return null
    }

    const uniqueErrors = [
      ...new Map(errors.map((error) => [error?.message, error])).values(),
    ]

    if (uniqueErrors?.length == 1) {
      return uniqueErrors[0]?.message
    }

    return (
      <ul className="ml-4 flex list-disc flex-col gap-1">
        {uniqueErrors.map(
          (error, index) =>
            error?.message && <li key={index}>{error.message}</li>
        )}
      </ul>
    )
  }, [children, errors])

  if (!content) {
    return null
  }

  return (
    <div
      role="alert"
      data-slot="field-error"
      className={cn("text-destructive text-sm font-normal", className)}
      {...props}
    >
      {content}
    </div>
  )
}

export {
  Field,
  FieldLabel,
  FieldDescription,
  FieldError,
  FieldGroup,
  FieldLegend,
  FieldSeparator,
  FieldSet,
  FieldContent,
  FieldTitle,
}


// ============================================================================
// FILE: components/ui/form.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState } = useFormContext()
  const formState = useFormState({ name: fieldContext.name })
  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn("grid gap-2", className)}
        {...props}
      />
    </FormItemContext.Provider>
  )
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField()

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField()

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? "") : props.children

  if (!body) {
    return null
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn("text-destructive text-sm", className)}
      {...props}
    >
      {body}
    </p>
  )
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}


// ============================================================================
// FILE: components/ui/hover-card.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

function HoverCard({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />
}

function HoverCardTrigger({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return (
    <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />
  )
}

function HoverCardContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  )
}

export { HoverCard, HoverCardTrigger, HoverCardContent }


// ============================================================================
// FILE: components/ui/input-group.tsx
// ============================================================================

"use client"

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"

function InputGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="input-group"
      role="group"
      className={cn(
        "group/input-group border-input dark:bg-input/30 relative flex w-full items-center rounded-md border shadow-xs transition-[color,box-shadow] outline-none",
        "h-9 min-w-0 has-[>textarea]:h-auto",

        // Variants based on alignment.
        "has-[>[data-align=inline-start]]:[&>input]:pl-2",
        "has-[>[data-align=inline-end]]:[&>input]:pr-2",
        "has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3",
        "has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3",

        // Focus state.
        "has-[[data-slot=input-group-control]:focus-visible]:border-ring has-[[data-slot=input-group-control]:focus-visible]:ring-ring/50 has-[[data-slot=input-group-control]:focus-visible]:ring-[3px]",

        // Error state.
        "has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40",

        className
      )}
      {...props}
    />
  )
}

const inputGroupAddonVariants = cva(
  "text-muted-foreground flex h-auto cursor-text items-center justify-center gap-2 py-1.5 text-sm font-medium select-none [&>svg:not([class*='size-'])]:size-4 [&>kbd]:rounded-[calc(var(--radius)-5px)] group-data-[disabled=true]/input-group:opacity-50",
  {
    variants: {
      align: {
        "inline-start":
          "order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]",
        "inline-end":
          "order-last pr-3 has-[>button]:mr-[-0.45rem] has-[>kbd]:mr-[-0.35rem]",
        "block-start":
          "order-first w-full justify-start px-3 pt-3 [.border-b]:pb-3 group-has-[>input]/input-group:pt-2.5",
        "block-end":
          "order-last w-full justify-start px-3 pb-3 [.border-t]:pt-3 group-has-[>input]/input-group:pb-2.5",
      },
    },
    defaultVariants: {
      align: "inline-start",
    },
  }
)

function InputGroupAddon({
  className,
  align = "inline-start",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof inputGroupAddonVariants>) {
  return (
    <div
      role="group"
      data-slot="input-group-addon"
      data-align={align}
      className={cn(inputGroupAddonVariants({ align }), className)}
      onClick={(e) => {
        if ((e.target as HTMLElement).closest("button")) {
          return
        }
        e.currentTarget.parentElement?.querySelector("input")?.focus()
      }}
      {...props}
    />
  )
}

const inputGroupButtonVariants = cva(
  "text-sm shadow-none flex gap-2 items-center",
  {
    variants: {
      size: {
        xs: "h-6 gap-1 px-2 rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-3.5 has-[>svg]:px-2",
        sm: "h-8 px-2.5 gap-1.5 rounded-md has-[>svg]:px-2.5",
        "icon-xs":
          "size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0",
        "icon-sm": "size-8 p-0 has-[>svg]:p-0",
      },
    },
    defaultVariants: {
      size: "xs",
    },
  }
)

function InputGroupButton({
  className,
  type = "button",
  variant = "ghost",
  size = "xs",
  ...props
}: Omit<React.ComponentProps<typeof Button>, "size"> &
  VariantProps<typeof inputGroupButtonVariants>) {
  return (
    <Button
      type={type}
      data-size={size}
      variant={variant}
      className={cn(inputGroupButtonVariants({ size }), className)}
      {...props}
    />
  )
}

function InputGroupText({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      className={cn(
        "text-muted-foreground flex items-center gap-2 text-sm [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function InputGroupInput({
  className,
  ...props
}: React.ComponentProps<"input">) {
  return (
    <Input
      data-slot="input-group-control"
      className={cn(
        "flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent",
        className
      )}
      {...props}
    />
  )
}

function InputGroupTextarea({
  className,
  ...props
}: React.ComponentProps<"textarea">) {
  return (
    <Textarea
      data-slot="input-group-control"
      className={cn(
        "flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent",
        className
      )}
      {...props}
    />
  )
}

export {
  InputGroup,
  InputGroupAddon,
  InputGroupButton,
  InputGroupText,
  InputGroupInput,
  InputGroupTextarea,
}


// ============================================================================
// FILE: components/ui/input-otp.tsx
// ============================================================================

"use client"

import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { MinusIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn(
        "flex items-center gap-2 has-disabled:opacity-50",
        containerClassName
      )}
      className={cn("disabled:cursor-not-allowed", className)}
      {...props}
    />
  )
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="input-otp-group"
      className={cn("flex items-center", className)}
      {...props}
    />
  )
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  index: number
}) {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {}

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        "data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm shadow-xs transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  )
}

function InputOTPSeparator({ ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  )
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }


// ============================================================================
// FILE: components/ui/input.tsx
// ============================================================================

import * as React from "react"

import { cn } from "@/lib/utils"

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className
      )}
      {...props}
    />
  )
}

export { Input }


// ============================================================================
// FILE: components/ui/item.tsx
// ============================================================================

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { Separator } from "@/components/ui/separator"

function ItemGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      role="list"
      data-slot="item-group"
      className={cn("group/item-group flex flex-col", className)}
      {...props}
    />
  )
}

function ItemSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="item-separator"
      orientation="horizontal"
      className={cn("my-0", className)}
      {...props}
    />
  )
}

const itemVariants = cva(
  "group/item flex items-center border border-transparent text-sm rounded-md transition-colors [a]:hover:bg-accent/50 [a]:transition-colors duration-100 flex-wrap outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline: "border-border",
        muted: "bg-muted/50",
      },
      size: {
        default: "p-4 gap-4 ",
        sm: "py-3 px-4 gap-2.5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Item({
  className,
  variant = "default",
  size = "default",
  asChild = false,
  ...props
}: React.ComponentProps<"div"> &
  VariantProps<typeof itemVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "div"
  return (
    <Comp
      data-slot="item"
      data-variant={variant}
      data-size={size}
      className={cn(itemVariants({ variant, size, className }))}
      {...props}
    />
  )
}

const itemMediaVariants = cva(
  "flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none group-has-[[data-slot=item-description]]/item:translate-y-0.5",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        icon: "size-8 border rounded-sm bg-muted [&_svg:not([class*='size-'])]:size-4",
        image:
          "size-10 rounded-sm overflow-hidden [&_img]:size-full [&_img]:object-cover",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function ItemMedia({
  className,
  variant = "default",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof itemMediaVariants>) {
  return (
    <div
      data-slot="item-media"
      data-variant={variant}
      className={cn(itemMediaVariants({ variant, className }))}
      {...props}
    />
  )
}

function ItemContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-content"
      className={cn(
        "flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none",
        className
      )}
      {...props}
    />
  )
}

function ItemTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-title"
      className={cn(
        "flex w-fit items-center gap-2 text-sm leading-snug font-medium",
        className
      )}
      {...props}
    />
  )
}

function ItemDescription({ className, ...props }: React.ComponentProps<"p">) {
  return (
    <p
      data-slot="item-description"
      className={cn(
        "text-muted-foreground line-clamp-2 text-sm leading-normal font-normal text-balance",
        "[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",
        className
      )}
      {...props}
    />
  )
}

function ItemActions({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-actions"
      className={cn("flex items-center gap-2", className)}
      {...props}
    />
  )
}

function ItemHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-header"
      className={cn(
        "flex basis-full items-center justify-between gap-2",
        className
      )}
      {...props}
    />
  )
}

function ItemFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-footer"
      className={cn(
        "flex basis-full items-center justify-between gap-2",
        className
      )}
      {...props}
    />
  )
}

export {
  Item,
  ItemMedia,
  ItemContent,
  ItemActions,
  ItemGroup,
  ItemSeparator,
  ItemTitle,
  ItemDescription,
  ItemHeader,
  ItemFooter,
}


// ============================================================================
// FILE: components/ui/kbd.tsx
// ============================================================================

import { cn } from "@/lib/utils"

function Kbd({ className, ...props }: React.ComponentProps<"kbd">) {
  return (
    <kbd
      data-slot="kbd"
      className={cn(
        "bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium select-none",
        "[&_svg:not([class*='size-'])]:size-3",
        "[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10",
        className
      )}
      {...props}
    />
  )
}

function KbdGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <kbd
      data-slot="kbd-group"
      className={cn("inline-flex items-center gap-1", className)}
      {...props}
    />
  )
}

export { Kbd, KbdGroup }


// ============================================================================
// FILE: components/ui/label.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"

import { cn } from "@/lib/utils"

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className
      )}
      {...props}
    />
  )
}

export { Label }


// ============================================================================
// FILE: components/ui/menubar.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Menubar({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn(
        "bg-background flex h-9 items-center gap-1 rounded-md border p-1 shadow-xs",
        className
      )}
      {...props}
    />
  )
}

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return (
    <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />
  )
}

function MenubarTrigger({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex items-center rounded-sm px-2 py-1 text-sm font-medium outline-hidden select-none",
        className
      )}
      {...props}
    />
  )
}

function MenubarContent({
  className,
  align = "start",
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[12rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </MenubarPortal>
  )
}

function MenubarItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  )
}

function MenubarRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  )
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function MenubarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function MenubarShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-none select-none data-[inset]:pl-8",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  )
}

function MenubarSubContent({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
}


// ============================================================================
// FILE: components/ui/mockup.tsx
// ============================================================================

// components/ui/mockup.tsx
import * as React from "react"
import { cn } from "@/lib/utils"

const MockupFrame = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "relative mx-auto border-gray-800 dark:border-gray-800 bg-gray-800 border-[14px] rounded-t-3xl h-[600px] w-full max-w-4xl",
      className
    )}
    {...props}
  />
))
MockupFrame.displayName = "MockupFrame"

interface MockupProps extends React.HTMLAttributes<HTMLDivElement> {
  type?: "responsive" | "mobile"
}

const Mockup = React.forwardRef<HTMLDivElement, MockupProps>(
  ({ className, type = "responsive", children, ...props }, ref) => {
    if (type === "responsive") {
      return (
        <div
          ref={ref}
          className={cn(
            "rounded-t-xl overflow-hidden w-full h-full bg-white dark:bg-black",
            className
          )}
          {...props}
        >
          {children}
        </div>
      )
    }
    // Add other mockup types here if needed
    return null
  }
)
Mockup.displayName = "Mockup"

export { Mockup, MockupFrame }

// ============================================================================
// FILE: components/ui/navigation-menu.tsx
// ============================================================================

import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDownIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn(
        "group/navigation-menu relative flex max-w-max flex-1 items-center justify-center",
        className
      )}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  )
}

function NavigationMenuList({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn(
        "group flex flex-1 list-none items-center justify-center gap-1",
        className
      )}
      {...props}
    />
  )
}

function NavigationMenuItem({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item
      data-slot="navigation-menu-item"
      className={cn("relative", className)}
      {...props}
    />
  )
}

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1"
)

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), "group", className)}
      {...props}
    >
      {children}{" "}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  )
}

function NavigationMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        "data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 top-0 left-0 w-full p-2 pr-2.5 md:absolute md:w-auto",
        "group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none",
        className
      )}
      {...props}
    />
  )
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div
      className={cn(
        "absolute top-full left-0 isolate z-50 flex justify-center"
      )}
    >
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          "origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]",
          className
        )}
        {...props}
      />
    </div>
  )
}

function NavigationMenuLink({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm transition-all outline-none focus-visible:ring-[3px] focus-visible:outline-1 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        "data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden",
        className
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  )
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
}


// ============================================================================
// FILE: components/ui/pagination.tsx
// ============================================================================

import * as React from "react"
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from "lucide-react"

import { cn } from "@/lib/utils"
import { Button, buttonVariants } from "@/components/ui/button"

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  )
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn("flex flex-row items-center gap-1", className)}
      {...props}
    />
  )
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />
}

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">

function PaginationLink({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className
      )}
      {...props}
    />
  )
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  )
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  )
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  )
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
}


// ============================================================================
// FILE: components/ui/popover.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  )
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }


// ============================================================================
// FILE: components/ui/progress.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

function Progress({
  className,
  value,
  ...props
}: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn(
        "bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",
        className
      )}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  )
}

export { Progress }


// ============================================================================
// FILE: components/ui/radio-group.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function RadioGroup({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return (
    <RadioGroupPrimitive.Root
      data-slot="radio-group"
      className={cn("grid gap-3", className)}
      {...props}
    />
  )
}

function RadioGroupItem({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
}

export { RadioGroup, RadioGroupItem }


// ============================================================================
// FILE: components/ui/resizable.tsx
// ============================================================================

"use client"

import * as React from "react"
import { GripVerticalIcon } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

function ResizablePanelGroup({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn(
        "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
        className
      )}
      {...props}
    />
  )
}

function ResizablePanel({
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        "bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90",
        className
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  )
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }


// ============================================================================
// FILE: components/ui/scroll-area.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn("relative", className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  )
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none p-px transition-colors select-none",
        orientation === "vertical" &&
          "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" &&
          "h-2.5 flex-col border-t border-t-transparent",
        className
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  )
}

export { ScrollArea, ScrollBar }


// ============================================================================
// FILE: components/ui/select.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default"
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = "popper",
  align = "center",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className
        )}
        position={position}
        align={align}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}


// ============================================================================
// FILE: components/ui/separator.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",
        className
      )}
      {...props}
    />
  )
}

export { Separator }


// ============================================================================
// FILE: components/ui/sheet.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />
}

function SheetOverlay({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left"
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  )
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  )
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  )
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  )
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}


// ============================================================================
// FILE: components/ui/sidebar.tsx
// ============================================================================

"use client"

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { PanelLeftIcon } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar_state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContextProps = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContextProps | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  defaultOpen?: boolean
  open?: boolean
  onOpenChange?: (open: boolean) => void
}) {
  const isMobile = useIsMobile()
  const [openMobile, setOpenMobile] = React.useState(false)

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen)
  const open = openProp ?? _open
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value
      if (setOpenProp) {
        setOpenProp(openState)
      } else {
        _setOpen(openState)
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
    },
    [setOpenProp, open]
  )

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)
  }, [isMobile, setOpen, setOpenMobile])

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (
        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
        (event.metaKey || event.ctrlKey)
      ) {
        event.preventDefault()
        toggleSidebar()
      }
    }

    window.addEventListener("keydown", handleKeyDown)
    return () => window.removeEventListener("keydown", handleKeyDown)
  }, [toggleSidebar])

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed"

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
  )

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH,
              "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn(
            "group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",
            className
          )}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  )
}

function Sidebar({
  side = "left",
  variant = "sidebar",
  collapsible = "offcanvas",
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  side?: "left" | "right"
  variant?: "sidebar" | "floating" | "inset"
  collapsible?: "offcanvas" | "icon" | "none"
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

  if (collapsible === "none") {
    return (
      <div
        data-slot="sidebar"
        className={cn(
          "bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col",
          className
        )}
        {...props}
      >
        {children}
      </div>
    )
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    )
  }

  return (
    <div
      className="group peer text-sidebar-foreground hidden md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          "relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)"
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          "fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  )
}

function SidebarTrigger({
  className,
  onClick,
  ...props
}: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn("size-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
}

function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex",
        "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
}

function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        "bg-background relative flex w-full flex-1 flex-col",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2",
        className
      )}
      {...props}
    />
  )
}

function SidebarInput({
  className,
  ...props
}: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn("bg-background h-8 w-full shadow-none", className)}
      {...props}
    />
  )
}

function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
}

function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
}

function SidebarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn("bg-sidebar-border mx-2 w-auto", className)}
      {...props}
    />
  )
}

function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
}

function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        "text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
}

function SidebarGroupContent({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn("w-full text-sm", className)}
      {...props}
    />
  )
}

function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn("flex w-full min-w-0 flex-col gap-1", className)}
      {...props}
    />
  )
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn("group/menu-item relative", className)}
      {...props}
    />
  )
}

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = "default",
  size = "default",
  tooltip,
  className,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean
  isActive?: boolean
  tooltip?: string | React.ComponentProps<typeof TooltipContent>
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? Slot : "button"
  const { isMobile, state } = useSidebar()

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  )

  if (!tooltip) {
    return button
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    }
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent
        side="right"
        align="center"
        hidden={state !== "collapsed" || isMobile}
        {...tooltip}
      />
    </Tooltip>
  )
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean
  showOnHover?: boolean
}) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",
        className
      )}
      {...props}
    />
  )
}

function SidebarMenuBadge({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<"div"> & {
  showIcon?: boolean
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-(--skeleton-width) flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
}

function SidebarMenuSubItem({
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn("group/menu-sub-item relative", className)}
      {...props}
    />
  )
}

function SidebarMenuSubButton({
  asChild = false,
  size = "md",
  isActive = false,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean
  size?: "sm" | "md"
  isActive?: boolean
}) {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}


// ============================================================================
// FILE: components/ui/skeleton.tsx
// ============================================================================

import { cn } from "@/lib/utils"

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="skeleton"
      className={cn("bg-accent animate-pulse rounded-md", className)}
      {...props}
    />
  )
}

export { Skeleton }


// ============================================================================
// FILE: components/ui/slider.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () =>
      Array.isArray(value)
        ? value
        : Array.isArray(defaultValue)
          ? defaultValue
          : [min, max],
    [value, defaultValue, min, max]
  )

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        "relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",
        className
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={cn(
          "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"
        )}
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={cn(
            "bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full"
          )}
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary ring-ring/50 block size-4 shrink-0 rounded-full border bg-white shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  )
}

export { Slider }


// ============================================================================
// FILE: components/ui/sonner.tsx
// ============================================================================

"use client"

import {
  CircleCheckIcon,
  InfoIcon,
  Loader2Icon,
  OctagonXIcon,
  TriangleAlertIcon,
} from "lucide-react"
import { useTheme } from "next-themes"
import { Toaster as Sonner, type ToasterProps } from "sonner"

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      icons={{
        success: <CircleCheckIcon className="size-4" />,
        info: <InfoIcon className="size-4" />,
        warning: <TriangleAlertIcon className="size-4" />,
        error: <OctagonXIcon className="size-4" />,
        loading: <Loader2Icon className="size-4 animate-spin" />,
      }}
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
          "--border-radius": "var(--radius)",
        } as React.CSSProperties
      }
      {...props}
    />
  )
}

export { Toaster }


// ============================================================================
// FILE: components/ui/spinner.tsx
// ============================================================================

import { Loader2Icon } from "lucide-react"

import { cn } from "@/lib/utils"

function Spinner({ className, ...props }: React.ComponentProps<"svg">) {
  return (
    <Loader2Icon
      role="status"
      aria-label="Loading"
      className={cn("size-4 animate-spin", className)}
      {...props}
    />
  )
}

export { Spinner }


// ============================================================================
// FILE: components/ui/switch.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as SwitchPrimitive from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0"
        )}
      />
    </SwitchPrimitive.Root>
  )
}

export { Switch }


// ============================================================================
// FILE: components/ui/table.tsx
// ============================================================================

"use client"

import * as React from "react"

import { cn } from "@/lib/utils"

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}


// ============================================================================
// FILE: components/ui/tabs.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn("flex flex-col gap-2", className)}
      {...props}
    />
  )
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",
        className
      )}
      {...props}
    />
  )
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  )
}

export { Tabs, TabsList, TabsTrigger, TabsContent }


// ============================================================================
// FILE: components/ui/textarea.tsx
// ============================================================================

import * as React from "react"

import { cn } from "@/lib/utils"

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      {...props}
    />
  )
}

export { Textarea }


// ============================================================================
// FILE: components/ui/toast.tsx
// ============================================================================

// components/ui/toast.tsx
"use client"

import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}

// ============================================================================
// FILE: components/ui/toaster.tsx
// ============================================================================

// components/ui/toaster.tsx
"use client"

import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"
import { useToast } from "@/components/ui/use-toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}

// ============================================================================
// FILE: components/ui/toggle-group.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants> & {
    spacing?: number
  }
>({
  size: "default",
  variant: "default",
  spacing: 0,
})

function ToggleGroup({
  className,
  variant,
  size,
  spacing = 0,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants> & {
    spacing?: number
  }) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      data-spacing={spacing}
      style={{ "--gap": spacing } as React.CSSProperties}
      className={cn(
        "group/toggle-group flex w-fit items-center gap-[--spacing(var(--gap))] rounded-md data-[spacing=default]:data-[variant=outline]:shadow-xs",
        className
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size, spacing }}>
        {children}
      </ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  )
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> &
  VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      data-spacing={context.spacing}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        "w-auto min-w-0 shrink-0 px-3 focus:z-10 focus-visible:z-10",
        "data-[spacing=0]:rounded-none data-[spacing=0]:shadow-none data-[spacing=0]:first:rounded-l-md data-[spacing=0]:last:rounded-r-md data-[spacing=0]:data-[variant=outline]:border-l-0 data-[spacing=0]:data-[variant=outline]:first:border-l",
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
}

export { ToggleGroup, ToggleGroupItem }


// ============================================================================
// FILE: components/ui/toggle.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-9 px-2 min-w-9",
        sm: "h-8 px-1.5 min-w-8",
        lg: "h-10 px-2.5 min-w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root
      data-slot="toggle"
      className={cn(toggleVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Toggle, toggleVariants }


// ============================================================================
// FILE: components/ui/tooltip.tsx
// ============================================================================

"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

function TooltipProvider({
  delayDuration = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delayDuration={delayDuration}
      {...props}
    />
  )
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  )
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",
          className
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  )
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }


// ============================================================================
// FILE: components/ui/use-toast.ts
// ============================================================================

// components/ui/use-toast.ts

import * as React from "react"
import type { ToastActionElement, ToastProps } from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side-effect in a reducer...
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast(props: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

// ============================================================================
// FILE: constants.ts
// ============================================================================


import React from 'react';
import { 
  CreditCard, Home, Zap, Shield, ShoppingCart, TrendingDown, Wallet, 
  Sparkles, TrendingUp, DollarSign, Target, Trophy, Star, Award, Crown, Coins, Gift, Palette,
  FileDown, PieChart, Zap as ZapIcon
} from 'lucide-react';
import type { Category, Trophee, SeasonPassLevel, Quest } from './types';

export const CATEGORIES: Record<string, Category> = {
  abonnement: { label: 'Abonnement', icon: CreditCard, color: '#6366f1', gradient: 'from-indigo-500 to-blue-500' },
  loyer: { label: 'Loyer', icon: Home, color: '#ef4444', gradient: 'from-red-500 to-pink-500' },
  credit: { label: 'Crédit', icon: TrendingDown, color: '#f59e0b', gradient: 'from-amber-500 to-orange-500' },
  energie: { label: 'Énergie', icon: Zap, color: '#10b981', gradient: 'from-emerald-500 to-green-500' },
  assurance: { label: 'Assurance', icon: Shield, color: '#8b5cf6', gradient: 'from-purple-500 to-violet-500' },
  paiementFractionne: { label: 'Paiement fractionné', icon: ShoppingCart, color: '#ec4444', gradient: 'from-pink-500 to-rose-500' },
};

export const REVENUS_CATEGORIES: Record<string, Category> = {
  salaire: { label: 'Salaire', icon: Wallet, color: '#10b981', gradient: 'from-emerald-500 to-teal-500' },
  freelance: { label: 'Freelance', icon: Sparkles, color: '#6366f1', gradient: 'from-indigo-500 to-purple-500' },
  allocations: { label: 'Allocations', icon: Shield, color: '#8b5cf6', gradient: 'from-violet-500 to-purple-500' },
  dividendes: { label: 'Dividendes', icon: TrendingUp, color: '#f59e0b', gradient: 'from-amber-500 to-yellow-500' },
  autres: { label: 'Autres', icon: DollarSign, color: '#6b7280', gradient: 'from-gray-500 to-slate-500' },
};

export const TYPES_ASSURANCE: Record<string, string> = {
  auto: 'Automobile', habitation: 'Habitation', sante: 'Santé/Mutuelle',
  vie: 'Vie', prevoyance: 'Prévoyance', responsabilite: 'Responsabilité civile', autres: 'Autres'
};

export const TROPHEES: Trophee[] = [
  { id: 'economie', nom: '🎯 Économe', description: 'Première dépense ajoutée', condition: (data) => data.depenses.length > 0 },
  { id: 'visionnaire', nom: '🔮 Visionnaire', description: 'Premier objectif créé', condition: (data) => data.objectifs.length > 0 },
  { id: 'cashflow', nom: '💰 Cash Flow Positif', description: 'Revenus > Dépenses', condition: (data) => data.cashFlow > 0 },
  { id: 'maitre', nom: '🏆 Maître du Budget', description: 'Score de santé > 80', condition: (data) => data.score >= 80 },
  { id: 'investisseur', nom: '📈 Investisseur', description: '3 actifs dans le patrimoine', condition: (data) => data.actifs.length >= 3 },
  { id: 'stratege', nom: '🎲 Stratège des Dettes', description: 'Optimisation activée', condition: (data) => data.optimisationDettes },
  { id: 'planificateurExpert', nom: '📈 Planificateur Expert', description: 'Créer au moins 3 objectifs', condition: (data) => data.objectifs.length >= 3 },
  { id: 'budgetPro', nom: '📊 Pro du Budget', description: 'Définir son premier budget', condition: (data) => data.budgets.length > 0 },
  { id: 'iaCurieux', nom: '🤖 Curieux de l\'IA', description: 'Lancer sa première analyse IA', condition: (data) => data.analyseIAEffectuee },
];

export const CADEAUX_OBJECTIFS = [
  {
    pourcentage: 50,
    nom: 'Mi-Parcours',
    description: 'La moitié du chemin est faite !',
    icon: Star,
    gradient: 'from-yellow-400 to-amber-500',
  },
  {
    pourcentage: 100,
    nom: 'Mission Accomplie !',
    description: 'Félicitations ! Objectif atteint.',
    icon: Award,
    gradient: 'from-emerald-400 to-green-500',
  }
];

// --- GAME PASS DATA ---

export const SEASON_LEVELS: SeasonPassLevel[] = [
  {
    level: 1,
    xpRequired: 100,
    freeReward: { id: 'free_1', type: 'coin', name: '50 Pièces', value: 50, icon: Coins },
    premiumReward: { id: 'prem_1', type: 'coin', name: '200 Pièces', value: 200, icon: Coins }
  },
  {
    level: 2,
    xpRequired: 250,
    freeReward: { id: 'free_2', type: 'feature', name: 'Export CSV', value: 'export_csv', icon: FileDown, description: "Débloque l'export de données" },
    premiumReward: { id: 'prem_2', type: 'coin', name: '300 Pièces', value: 300, icon: Coins }
  },
  {
    level: 3,
    xpRequired: 450,
    freeReward: { id: 'free_3', type: 'coin', name: '100 Pièces', value: 100, icon: Coins },
    premiumReward: { id: 'prem_3', type: 'badge', name: 'Badge Analyste', value: 'badge_analyst', icon: Award }
  },
  {
    level: 4,
    xpRequired: 700,
    freeReward: null,
    premiumReward: { id: 'prem_4', type: 'coin', name: '500 Pièces', value: 500, icon: Coins }
  },
  {
    level: 5,
    xpRequired: 1000,
    freeReward: { id: 'free_5', type: 'coin', name: '150 Pièces', value: 150, icon: Coins },
    premiumReward: { id: 'prem_5', type: 'feature', name: 'Graphiques Avancés', value: 'radar_chart', icon: PieChart, description: "Analyse visuelle Radar" }
  },
  {
    level: 6,
    xpRequired: 1350,
    freeReward: null,
    premiumReward: { id: 'prem_6', type: 'coin', name: '750 Pièces', value: 750, icon: Coins }
  },
  {
    level: 7,
    xpRequired: 1750,
    freeReward: { id: 'free_7', type: 'coin', name: '200 Pièces', value: 200, icon: Coins },
    premiumReward: { id: 'prem_7', type: 'feature', name: 'Thème Cyberpunk', value: 'cyberpunk', icon: ZapIcon, description: "Design Néon Exclusif" }
  },
  {
    level: 8,
    xpRequired: 2200,
    freeReward: null,
    premiumReward: { id: 'prem_8', type: 'coin', name: '1000 Pièces', value: 1000, icon: Coins }
  },
  {
    level: 9,
    xpRequired: 2700,
    freeReward: { id: 'free_9', type: 'coin', name: '250 Pièces', value: 250, icon: Coins },
    premiumReward: { id: 'prem_9', type: 'badge', name: 'Badge Magnat', value: 'badge_tycoon', icon: Crown }
  },
  {
    level: 10,
    xpRequired: 3500,
    freeReward: { id: 'free_10', type: 'coin', name: '500 Pièces', value: 500, icon: Coins },
    premiumReward: { id: 'prem_10', type: 'feature', name: 'Thème Royal', value: 'royal', icon: Palette, description: "L'ultime prestige" }
  }
];

export const DAILY_QUESTS: Quest[] = [
  { id: 'q1', title: 'Gestionnaire Actif', description: 'Ajouter une dépense aujourd\'hui', xpReward: 50, coinReward: 10, progress: 0, target: 1, completed: false, type: 'add_expense' },
  { id: 'q2', title: 'Épargnant', description: 'Consulter ses objectifs', xpReward: 30, coinReward: 5, progress: 0, target: 1, completed: false, type: 'check_app' },
  { id: 'q3', title: 'Analyste', description: 'Vérifier son patrimoine', xpReward: 40, coinReward: 10, progress: 0, target: 1, completed: false, type: 'check_app' },
];


// ============================================================================
// FILE: constants/index.ts
// ============================================================================

import { 
  Briefcase, Gift, TrendingUp, PiggyBank, Home, Coins, Star, Flame, Trophy,
  FileDown, BarChart3, Palette, Crown, Sparkles, Shield, Zap, Award
} from 'lucide-react';
import type { Quest } from '@/types';

export type SeasonLevel = {
  level: number;
  xpRequired: number;
  freeReward: { id: string; type: string; value: number | string; icon: React.ElementType; description: string };
  premiumReward: { id: string; type: string; value: number | string; icon: React.ElementType; description: string };
};

export const CATEGORIES: Record<string, { label: string; color: string }> = {
  logement: { label: 'Logement', color: '#6366f1' },
  alimentation: { label: 'Alimentation', color: '#10b981' },
  transport: { label: 'Transport', color: '#f59e0b' },
  loisirs: { label: 'Loisirs', color: '#ec4899' },
  sante: { label: 'Santé', color: '#ef4444' },
  shopping: { label: 'Shopping', color: '#8b5cf6' },
  abonnements: { label: 'Abonnements', color: '#06b6d4' },
  credit: { label: 'Crédit', color: '#f97316' },
  autres: { label: 'Autres', color: '#64748b' },
};

export const REVENUS_CATEGORIES: Record<string, { label: string; icon: React.ElementType; gradient: string }> = {
  salaire: { label: 'Salaire', icon: Briefcase, gradient: 'from-emerald-500 to-teal-500' },
  freelance: { label: 'Freelance', icon: TrendingUp, gradient: 'from-blue-500 to-cyan-500' },
  investissement: { label: 'Investissement', icon: Coins, gradient: 'from-amber-500 to-orange-500' },
  immobilier: { label: 'Immobilier', icon: Home, gradient: 'from-purple-500 to-pink-500' },
  epargne: { label: 'Épargne', icon: PiggyBank, gradient: 'from-indigo-500 to-violet-500' },
  cadeau: { label: 'Cadeau', icon: Gift, gradient: 'from-rose-500 to-red-500' },
  autre: { label: 'Autre', icon: Coins, gradient: 'from-slate-500 to-gray-500' },
};

export const CADEAUX_OBJECTIFS = [
  { 
    nom: 'Débutant', 
    description: 'Premier pas vers votre objectif !', 
    pourcentage: 25,
    gradient: 'from-blue-400 to-blue-600',
    icon: Star
  },
  { 
    nom: 'Progression', 
    description: 'Vous êtes à mi-chemin !', 
    pourcentage: 50,
    gradient: 'from-purple-400 to-purple-600',
    icon: TrendingUp
  },
  { 
    nom: 'Presque !', 
    description: 'Plus que quelques efforts !', 
    pourcentage: 75,
    gradient: 'from-orange-400 to-orange-600',
    icon: Flame
  },
  { 
    nom: 'Champion', 
    description: 'Objectif atteint ! 🎉', 
    pourcentage: 100,
    gradient: 'from-emerald-400 to-emerald-600',
    icon: Trophy
  },
];

export const SEASON_LEVELS: SeasonLevel[] = [
  { 
    level: 1, 
    xpRequired: 100,
    freeReward: { id: 'free-1', type: 'coin', value: 50, icon: Coins, description: '50 pièces' },
    premiumReward: { id: 'prem-1', type: 'coin', value: 150, icon: Coins, description: '150 pièces' }
  },
  { 
    level: 2, 
    xpRequired: 250,
    freeReward: { id: 'free-2', type: 'feature', value: 'export_csv', icon: FileDown, description: 'Export CSV débloqué' },
    premiumReward: { id: 'prem-2', type: 'coin', value: 200, icon: Coins, description: '200 pièces' }
  },
  { 
    level: 3, 
    xpRequired: 500,
    freeReward: { id: 'free-3', type: 'coin', value: 100, icon: Coins, description: '100 pièces' },
    premiumReward: { id: 'prem-3', type: 'badge', value: 'early_supporter', icon: Award, description: 'Badge Supporter' }
  },
  { 
    level: 4, 
    xpRequired: 800,
    freeReward: { id: 'free-4', type: 'coin', value: 150, icon: Coins, description: '150 pièces' },
    premiumReward: { id: 'prem-4', type: 'theme', value: 'cyberpunk', icon: Palette, description: 'Thème Cyberpunk' }
  },
  { 
    level: 5, 
    xpRequired: 1200,
    freeReward: { id: 'free-5', type: 'feature', value: 'radar_chart', icon: BarChart3, description: 'Graphique Radar' },
    premiumReward: { id: 'prem-5', type: 'coin', value: 300, icon: Coins, description: '300 pièces' }
  },
  { 
    level: 6, 
    xpRequired: 1700,
    freeReward: { id: 'free-6', type: 'coin', value: 200, icon: Coins, description: '200 pièces' },
    premiumReward: { id: 'prem-6', type: 'feature', value: 'ai_analysis', icon: Sparkles, description: 'Analyse IA avancée' }
  },
  { 
    level: 7, 
    xpRequired: 2300,
    freeReward: { id: 'free-7', type: 'badge', value: 'veteran', icon: Shield, description: 'Badge Vétéran' },
    premiumReward: { id: 'prem-7', type: 'theme', value: 'royal', icon: Crown, description: 'Thème Royal' }
  },
  { 
    level: 8, 
    xpRequired: 3000,
    freeReward: { id: 'free-8', type: 'coin', value: 250, icon: Coins, description: '250 pièces' },
    premiumReward: { id: 'prem-8', type: 'coin', value: 500, icon: Coins, description: '500 pièces' }
  },
  { 
    level: 9, 
    xpRequired: 4000,
    freeReward: { id: 'free-9', type: 'feature', value: 'custom_categories', icon: Zap, description: 'Catégories personnalisées' },
    premiumReward: { id: 'prem-9', type: 'badge', value: 'legend', icon: Trophy, description: 'Badge Légende' }
  },
  { 
    level: 10, 
    xpRequired: 5000,
    freeReward: { id: 'free-10', type: 'badge', value: 'master', icon: Crown, description: 'Badge Maître' },
    premiumReward: { id: 'prem-10', type: 'feature', value: 'all_themes', icon: Palette, description: 'Tous les thèmes' }
  },
];

export const DEFAULT_QUESTS: Quest[] = [
  {
      id: 'quest-1',
      title: 'Premier pas',
      description: 'Ajoutez votre premier revenu',
      xpReward: 50,
      coinReward: 25,
      progress: 0,
      target: 1,
      completed: false,
      type: 'add_expense'
  },
  {
      id: 'quest-2',
      title: 'Gestionnaire',
      description: 'Ajoutez 3 dépenses',
      xpReward: 75,
      coinReward: 35,
      progress: 0,
      target: 3,
      completed: false,
      type: 'add_expense'
  },
  {
      id: 'quest-3',
      title: 'Objectif clair',
      description: 'Créez votre premier objectif d\'épargne',
      xpReward: 100,
      coinReward: 50,
      progress: 0,
      target: 1,
      completed: false,
      type: 'add_expense'
  },
  {
      id: 'quest-4',
      title: 'Investisseur',
      description: 'Ajoutez un investissement',
      xpReward: 100,
      coinReward: 50,
      progress: 0,
      target: 1,
      completed: false,
      type: 'add_expense'
  },
];

// ============================================================================
// FILE: context/DataContext.tsx
// ============================================================================

'use client';

import React, { createContext, useContext, useState, ReactNode } from 'react';

interface Lead {
  id: string;
  name: string;
  company: string;
  score: number;
}

interface Card {
  id: string;
  status: 'ACTIVE' | 'INACTIVE';
}

interface Analytics {
  daily: { date: string; views: number }[];
}

interface DataContextType {
  analytics: Analytics;
  leads: Lead[];
  cards: Card[];
}

const DataContext = createContext<DataContextType | undefined>(undefined);

export function DataProvider({ children }: { children: ReactNode }) {
  const [analytics] = useState<Analytics>({
    daily: [
      { date: 'Lun', views: 45 },
      { date: 'Mar', views: 52 },
      { date: 'Mer', views: 38 },
      { date: 'Jeu', views: 65 },
      { date: 'Ven', views: 48 },
      { date: 'Sam', views: 72 },
      { date: 'Dim', views: 55 },
    ]
  });
  
  const [leads] = useState<Lead[]>([]);
  const [cards] = useState<Card[]>([]);

  return (
    <DataContext.Provider value={{ analytics, leads, cards }}>
      {children}
    </DataContext.Provider>
  );
}

export function useData() {
  const context = useContext(DataContext);
  if (!context) {
    throw new Error('useData must be used within a DataProvider');
  }
  return context;
}

// ============================================================================
// FILE: context/FinanceDataContext.tsx
// ============================================================================

'use client';

import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import type { Depense, Revenu, Objectif, Actif, Trophee, Budget, GameState, Investment } from '@/types';
import { calculerMontantMensuel } from '@/utils/financeCalculations';
import { DEFAULT_QUESTS } from '@/constants/index';

type StrategieDette = 'avalanche' | 'boule de neige';

interface FinanceDataContextType {
  cashFlow: number;
  scoreSante: number;
  totalRevenusMensuel: number;
  totalDepensesMensuel: number;
  patrimoineNet: number;
  revenus: Revenu[];
  setRevenus: React.Dispatch<React.SetStateAction<Revenu[]>>;
  depenses: Depense[];
  setDepenses: React.Dispatch<React.SetStateAction<Depense[]>>;
  objectifs: Objectif[];
  setObjectifs: React.Dispatch<React.SetStateAction<Objectif[]>>;
  actifs: Actif[];
  setActifs: React.Dispatch<React.SetStateAction<Actif[]>>;
  tropheesDeverrouilles: Trophee[];
  analyserAvecIA: () => void;
  chargementIA: boolean;
  budgets: Budget[];
  setBudgets: React.Dispatch<React.SetStateAction<Budget[]>>;
  gameState: GameState;
  setGameState: React.Dispatch<React.SetStateAction<GameState>>;
  investissements: Investment[];
  setInvestissements: React.Dispatch<React.SetStateAction<Investment[]>>;
  strategieDette: StrategieDette;
  setStrategieDette: React.Dispatch<React.SetStateAction<StrategieDette>>;
}

const FinanceDataContext = createContext<FinanceDataContextType | undefined>(undefined);

const initialGameState: GameState = {
    level: 1,
    xp: 0,
    coins: 100,
    isPremium: false,
    unlockedFeatures: [],
    claimedRewards: [],
    quests: DEFAULT_QUESTS,
    lastLoginDate: '',
    streak: 0
};

export function FinanceDataProvider({ children }: { children: ReactNode }) {
  const [budgets, setBudgets] = useState<Budget[]>([]);
  const [revenus, setRevenus] = useState<Revenu[]>([]);
  const [depenses, setDepenses] = useState<Depense[]>([]);
  const [objectifs, setObjectifs] = useState<Objectif[]>([]);
  const [actifs, setActifs] = useState<Actif[]>([]);
  const [investissements, setInvestissements] = useState<Investment[]>([]);
  const [chargementIA, setChargementIA] = useState(false);
  const [strategieDette, setStrategieDette] = useState<StrategieDette>('avalanche');
  const [gameState, setGameState] = useState<GameState>(initialGameState);

  // Mise à jour des quêtes en fonction des données
  useEffect(() => {
    setGameState(prev => {
      const updatedQuests = prev.quests.map(quest => {
        let progress = 0;
        let completed = quest.completed;

        switch (quest.id) {
          case 'quest-1':
            progress = revenus.length;
            completed = revenus.length >= quest.target;
            break;
          case 'quest-2':
            progress = depenses.length;
            completed = depenses.length >= quest.target;
            break;
          case 'quest-3':
            progress = objectifs.length;
            completed = objectifs.length >= quest.target;
            break;
          case 'quest-4':
            progress = investissements.length;
            completed = investissements.length >= quest.target;
            break;
        }

        return { ...quest, progress, completed };
      });

      // Calculer XP gagné des quêtes complétées
      const newlyCompletedQuests = updatedQuests.filter(
        (q, i) => q.completed && !prev.quests[i].completed
      );
      
      let newXP = prev.xp;
      let newCoins = prev.coins;
      
      newlyCompletedQuests.forEach(quest => {
        newXP += quest.xpReward;
        newCoins += quest.coinReward;
      });

      return {
        ...prev,
        quests: updatedQuests,
        xp: newXP,
        coins: newCoins,
      };
    });
  }, [revenus.length, depenses.length, objectifs.length, investissements.length]);

  // Calculs dynamiques
  const totalRevenusMensuel = revenus.reduce((acc: number, rev) => {
    return acc + calculerMontantMensuel(rev);
  }, 0);

  const totalDepensesMensuel = depenses.reduce((acc: number, dep) => {
    return acc + calculerMontantMensuel(dep);
  }, 0);

  const totalActifs = actifs.reduce((acc, actif) => {
    return acc + (parseFloat(actif.valeur) || 0);
  }, 0);

  const totalInvestissements = investissements.reduce((acc, inv) => {
    return acc + (inv.quantity * inv.currentPrice);
  }, 0);

  const totalDettes = depenses
    .filter(d => d.categorie === 'credit' && d.montantTotal)
    .reduce((acc, d) => acc + (parseFloat(d.montantTotal || '0')), 0);

  const cashFlow = totalRevenusMensuel - totalDepensesMensuel;
  const scoreSante = Math.min(100, Math.max(0, Math.round((cashFlow / (totalRevenusMensuel || 1)) * 100 + 50)));
  const patrimoineNet = totalActifs + totalInvestissements - totalDettes;

  const value: FinanceDataContextType = {
    cashFlow,
    scoreSante,
    totalRevenusMensuel,
    totalDepensesMensuel,
    patrimoineNet,
    revenus,
    setRevenus,
    depenses,
    setDepenses,
    objectifs,
    setObjectifs,
    actifs,
    setActifs,
    tropheesDeverrouilles: [],
    analyserAvecIA: () => {
      setChargementIA(true);
      setTimeout(() => setChargementIA(false), 2000);
    },
    chargementIA,
    budgets,
    setBudgets,
    gameState,
    setGameState,
    investissements,
    setInvestissements,
    strategieDette,
    setStrategieDette,
  };

  return (
    <FinanceDataContext.Provider value={value}>
      {children}
    </FinanceDataContext.Provider>
  );
}

export function useFinanceData() {
  const context = useContext(FinanceDataContext);
  if (!context) {
    throw new Error('useFinanceData must be used within a FinanceDataProvider');
  }
  return context;
}

// ============================================================================
// FILE: context/ThemeContext.tsx
// ============================================================================

'use client';

import React, { createContext, useContext, useState, ReactNode } from 'react';

interface Theme {
  isDark: boolean;
  colors: {
    primary: string;
    secondary: string;
    accent: string;
    text: string;
    subtext: string;
    card: string;
    border: string;
    input: string;
    chartText: string;
  };
  gradients: {
    primaryButton: string;
  };
}

const lightTheme: Theme = {
  isDark: false,
  colors: {
    primary: 'indigo-600',
    secondary: 'purple-600',
    accent: 'pink-600',
    text: 'text-slate-900',
    subtext: 'text-slate-500',
    card: 'bg-white',
    border: 'border-slate-200',
    input: 'bg-white',
    chartText: '#64748b',
  },
  gradients: {
    primaryButton: 'bg-gradient-to-r from-indigo-600 to-purple-600',
  },
};

const darkTheme: Theme = {
  isDark: true,
  colors: {
    primary: 'indigo-400',
    secondary: 'purple-400',
    accent: 'pink-400',
    text: 'text-slate-100',
    subtext: 'text-slate-400',
    card: 'bg-slate-800',
    border: 'border-slate-700',
    input: 'bg-slate-700',
    chartText: '#94a3b8',
  },
  gradients: {
    primaryButton: 'bg-gradient-to-r from-indigo-500 to-purple-500',
  },
};

interface ThemeContextType {
  currentTheme: Theme;
  toggleTheme: () => void;
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export function ThemeProvider({ children }: { children: ReactNode }) {
  const [isDark, setIsDark] = useState(false);

  const toggleTheme = () => setIsDark(!isDark);

  return (
    <ThemeContext.Provider value={{ currentTheme: isDark ? darkTheme : lightTheme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
}

// ============================================================================
// FILE: context/useTheme.tsx
// ============================================================================


import React, { createContext, useContext, useState, useEffect } from 'react';
import type { Theme, ThemeId } from '../types';

// Helper pour les propriétés communes des thèmes clairs
const lightThemeProps = {
  isDark: false,
  colors: {
    text: 'text-slate-900',
    subtext: 'text-slate-500',
    card: 'bg-white/70',
    border: 'border-white/50',
    input: 'bg-white',
    chartText: '#64748b'
  }
};

const THEMES: Record<ThemeId, Theme> = {
  default: {
    id: 'default',
    name: 'Futuriste',
    ...lightThemeProps,
    colors: { ...lightThemeProps.colors, primary: 'indigo-600', secondary: 'purple-600', accent: 'pink-500' },
    gradients: {
      header: 'bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500',
      appBackground: 'bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50',
      primaryButton: 'bg-gradient-to-r from-indigo-600 to-purple-600',
      activeTab: 'bg-gradient-to-r from-indigo-600 to-purple-600',
      loginSidebar: 'bg-slate-900',
    },
    isPremium: false
  },
  dark: {
    id: 'dark',
    name: 'Sombre',
    isDark: true,
    colors: {
      primary: 'slate-200',
      secondary: 'slate-400',
      accent: 'indigo-400',
      text: 'text-slate-100',
      subtext: 'text-slate-400',
      card: 'bg-slate-900/80',
      border: 'border-slate-700',
      input: 'bg-slate-950',
      chartText: '#94a3b8'
    },
    gradients: {
      header: 'bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border-b border-slate-700',
      appBackground: 'bg-slate-950',
      primaryButton: 'bg-gradient-to-r from-slate-700 to-slate-600 hover:from-slate-600 hover:to-slate-500',
      activeTab: 'bg-gradient-to-r from-slate-700 to-slate-600',
      loginSidebar: 'bg-black',
    },
    isPremium: false
  },
  ocean: {
    id: 'ocean',
    name: 'Océan',
    ...lightThemeProps,
    colors: { ...lightThemeProps.colors, primary: 'blue-600', secondary: 'cyan-600', accent: 'teal-400' },
    gradients: {
      header: 'bg-gradient-to-br from-blue-600 via-cyan-600 to-teal-500',
      appBackground: 'bg-gradient-to-br from-slate-50 via-cyan-50 to-blue-50',
      primaryButton: 'bg-gradient-to-r from-blue-600 to-cyan-600',
      activeTab: 'bg-gradient-to-r from-blue-600 to-cyan-600',
      loginSidebar: 'bg-slate-900',
    },
    isPremium: false
  },
  nature: {
    id: 'nature',
    name: 'Nature',
    ...lightThemeProps,
    colors: { ...lightThemeProps.colors, primary: 'emerald-600', secondary: 'green-600', accent: 'lime-500' },
    gradients: {
      header: 'bg-gradient-to-br from-emerald-600 via-green-600 to-lime-500',
      appBackground: 'bg-gradient-to-br from-slate-50 via-emerald-50 to-green-50',
      primaryButton: 'bg-gradient-to-r from-emerald-600 to-green-600',
      activeTab: 'bg-gradient-to-r from-emerald-600 to-green-600',
      loginSidebar: 'bg-slate-900',
    },
    isPremium: false
  },
  sunset: {
    id: 'sunset',
    name: 'Sunset',
    ...lightThemeProps,
    colors: { ...lightThemeProps.colors, primary: 'orange-600', secondary: 'red-600', accent: 'amber-500' },
    gradients: {
      header: 'bg-gradient-to-br from-orange-600 via-red-600 to-amber-500',
      appBackground: 'bg-gradient-to-br from-slate-50 via-orange-50 to-amber-50',
      primaryButton: 'bg-gradient-to-r from-orange-600 to-red-600',
      activeTab: 'bg-gradient-to-r from-orange-600 to-red-600',
      loginSidebar: 'bg-slate-900',
    },
    isPremium: false
  },
  cyberpunk: {
    id: 'cyberpunk',
    name: 'Cyberpunk',
    isDark: true,
    colors: { 
      primary: 'fuchsia-600', secondary: 'violet-600', accent: 'cyan-400',
      text: 'text-fuchsia-50', subtext: 'text-fuchsia-200',
      card: 'bg-slate-900/80', border: 'border-fuchsia-500/30',
      input: 'bg-black', chartText: '#e879f9'
    },
    gradients: {
      header: 'bg-gradient-to-br from-fuchsia-700 via-purple-800 to-indigo-900 border-b-4 border-cyan-400',
      appBackground: 'bg-slate-900',
      primaryButton: 'bg-gradient-to-r from-fuchsia-600 to-cyan-600 shadow-[0_0_15px_rgba(217,70,239,0.5)]',
      activeTab: 'bg-gradient-to-r from-fuchsia-600 to-cyan-600',
      loginSidebar: 'bg-black',
    },
    isPremium: true
  },
  royal: {
    id: 'royal',
    name: 'Luxe',
    isDark: true,
    colors: { 
      primary: 'yellow-600', secondary: 'slate-600', accent: 'yellow-500',
      text: 'text-yellow-50', subtext: 'text-yellow-200/70',
      card: 'bg-slate-900/90', border: 'border-yellow-500/30',
      input: 'bg-slate-950', chartText: '#eab308'
    },
    gradients: {
      header: 'bg-gradient-to-br from-slate-900 via-slate-800 to-yellow-700 border-b border-yellow-500/50',
      appBackground: 'bg-gradient-to-br from-gray-900 via-slate-900 to-black',
      primaryButton: 'bg-gradient-to-r from-yellow-600 to-yellow-700 border border-yellow-400/30 text-white',
      activeTab: 'bg-gradient-to-r from-slate-800 to-black text-yellow-500 border border-yellow-500/30',
      loginSidebar: 'bg-black',
    },
    isPremium: true
  }
};

interface ThemeContextType {
  currentTheme: Theme;
  setTheme: (id: ThemeId) => void;
  availableThemes: Theme[];
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [currentThemeId, setCurrentThemeId] = useState<ThemeId>('default');

  useEffect(() => {
    const savedTheme = localStorage.getItem('finance_theme') as ThemeId;
    if (savedTheme && THEMES[savedTheme]) {
      setCurrentThemeId(savedTheme);
    }
  }, []);

  const setTheme = (id: ThemeId) => {
    setCurrentThemeId(id);
    localStorage.setItem('finance_theme', id);
  };

  return (
    <ThemeContext.Provider value={{ 
      currentTheme: THEMES[currentThemeId], 
      setTheme, 
      availableThemes: Object.values(THEMES) 
    }}>
      {children}
    </ThemeContext.Provider>
  );
};

export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (context === undefined) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
};


// ============================================================================
// FILE: eslint.config.mjs
// ============================================================================

import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;


// ============================================================================
// FILE: hooks/use-mobile.ts
// ============================================================================

import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}


// ============================================================================
// FILE: lib/actions/ai.actions.ts
// ============================================================================

// lib/actions/ai.actions.ts

"use server";

import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "../prisma";
import { runFinancialAnalysis, runDebtAnalysis } from "../google-gemini-ai";
import { format } from "date-fns";

// This is the main AI analysis for the dashboard
export async function generateFinancialInsights() {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) throw new Error("Unauthorized");
  const userId = session.user.id;

  try {
    const [transactions, goals, budgets, assets, debts] = await Promise.all([
      prisma.transaction.findMany({ where: { userId }, orderBy: { date: 'desc' }, take: 100 }),
      prisma.goal.findMany({ where: { userId } }),
      prisma.budget.findMany({ where: { userId } }),
      prisma.asset.findMany({ where: { userId } }),
      prisma.debt.findMany({ where: { userId } })
    ]);

    const financialData = {
      transactions: transactions.map(t => ({...t, date: format(t.date, 'yyyy-MM-dd')})),
      goals,
      budgets,
      assets,
      debts
    };

    const analysisResult = await runFinancialAnalysis(financialData);
    
    // The Gemini function returns a JSON string, so we parse it.
    const parsedResult = JSON.parse(analysisResult);
    
    return parsedResult;

  } catch (error) {
    console.error("GEMINI_FINANCIAL_ANALYSIS_ERROR", error);
    // Return a structured error so the frontend can handle it
    return { error: "Failed to generate AI insights. Please try again later." };
  }
}

// This is the AI analysis for the debts page
export async function analyzeDebtRepayment(debts: any[]) {
    const session = await getServerSession(authOptions);
    if (!session?.user?.id) throw new Error("Unauthorized");

    try {
        const analysisResult = await runDebtAnalysis(debts);
        const parsedResult = JSON.parse(analysisResult);
        return parsedResult;
    } catch (error) {
        console.error("GEMINI_DEBT_ANALYSIS_ERROR", error);
        return { error: "Failed to generate debt analysis." };
    }
}

// ============================================================================
// FILE: lib/actions/budget.actions.ts
// ============================================================================

// lib/actions/budget.actions.ts (NEW FILE)

"use server";

import { z } from "zod";
import { revalidatePath } from "next/cache";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "@/lib/prisma";
import { startOfMonth, endOfMonth } from "date-fns";

// Zod schema for validation
const budgetSchema = z.object({
  category: z.string().min(1, "Category is required."),
  limit: z.coerce.number().positive("Limit must be a positive number."),
});

// Create a new budget
export async function createBudget(formData: unknown) {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) {
    return { success: false, message: "Authentication required." };
  }
  const userId = session.user.id;

  const result = budgetSchema.safeParse(formData);
  if (!result.success) {
    return { success: false, message: "Invalid form data." };
  }

  // Check for existing budget in the same category
  const existingBudget = await prisma.budget.findFirst({
    where: { userId, category: result.data.category },
  });

  if (existingBudget) {
    return { success: false, message: "A budget for this category already exists." };
  }

  try {
    await prisma.budget.create({
      data: { ...result.data, userId },
    });
    revalidatePath("/budgets");
    return { success: true, message: "Budget created successfully." };
  } catch (error) {
    console.error("CREATE_BUDGET_ERROR", error);
    return { success: false, message: "Failed to create budget." };
  }
}

// Get all budgets and calculate current spending for each
export async function getBudgetsWithSpending() {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) throw new Error("Authentication required.");
  const userId = session.user.id;

  const budgets = await prisma.budget.findMany({ where: { userId } });
  
  const now = new Date();
  const monthStart = startOfMonth(now);
  const monthEnd = endOfMonth(now);

  const monthlyExpenses = await prisma.transaction.groupBy({
    by: ['category'],
    where: {
      userId,
      type: 'EXPENSE',
      date: { gte: monthStart, lte: monthEnd },
    },
    _sum: { amount: true },
  });
  
  const spendingMap = new Map(
    monthlyExpenses.map(item => [item.category, item._sum.amount ?? 0])
  );

  return budgets.map(budget => {
    const spent = spendingMap.get(budget.category) ?? 0;
    const remaining = budget.limit - spent;
    const progress = (spent / budget.limit) * 100;
    return { ...budget, spent, remaining, progress };
  });
}

// ============================================================================
// FILE: lib/actions/dashboard.actions.ts
// ============================================================================

// lib/actions/dashboard.actions.ts (NEW FILE)
"use server";

import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "@/lib/prisma";
import { startOfMonth, endOfMonth } from "date-fns";
import { getBudgetsWithSpending } from "./budget.actions";

export async function getDashboardStats() {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) {
    throw new Error("Authentication required.");
  }
  const userId = session.user.id;

  // --- Net Worth Calculation ---
  const { _sum: { value: totalAssets } } = await prisma.asset.aggregate({
    _sum: { value: true },
    where: { userId },
  });
  const { _sum: { balance: totalDebts } } = await prisma.debt.aggregate({
    _sum: { balance: true },
    where: { userId },
  });
  const netWorth = (totalAssets ?? 0) - (totalDebts ?? 0);

  // --- Monthly Cash Flow ---
  const now = new Date();
  const monthStart = startOfMonth(now);
  const monthEnd = endOfMonth(now);
  
  const { _sum: { amount: monthlyIncome } } = await prisma.transaction.aggregate({
      _sum: { amount: true },
      where: { userId, type: 'INCOME', date: { gte: monthStart, lte: monthEnd } },
  });
   const { _sum: { amount: monthlyExpense } } = await prisma.transaction.aggregate({
      _sum: { amount: true },
      where: { userId, type: 'EXPENSE', date: { gte: monthStart, lte: monthEnd } },
  });
  const cashFlow = (monthlyIncome ?? 0) - (monthlyExpense ?? 0);

  // --- Total Savings ---
  const { _sum: { currentAmount: totalSavings } } = await prisma.goal.aggregate({
      _sum: { currentAmount: true },
      where: { userId }
  });

  // --- Budgets Status ---
  const budgets = await getBudgetsWithSpending();
  const budgetsOnTrack = budgets.filter(b => b.progress <= 100).length;
  const budgetsOverspent = budgets.length - budgetsOnTrack;
  
  return {
    netWorth,
    cashFlow,
    totalSavings: totalSavings ?? 0,
    budgets: {
        count: budgets.length,
        onTrack: budgetsOnTrack,
        overspent: budgetsOverspent,
    }
  };
}

// ============================================================================
// FILE: lib/actions/debt.actions.ts
// ============================================================================

// lib/actions/debt.actions.ts (NEW FILE)
"use server";

import { z } from "zod";
import { revalidatePath } from "next/cache";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "@/lib/prisma";
import { addXp } from "./gamification.actions";

const debtSchema = z.object({
  name: z.string().min(1, "Debt name is required."),
  type: z.enum(["LOAN", "CREDIT_CARD", "OTHER"]),
  balance: z.coerce.number().positive("Balance must be a positive number."),
  apr: z.coerce.number().min(0, "APR cannot be negative."),
  minPayment: z.coerce.number().positive("Minimum payment must be positive."),
});

export async function createDebt(formData: unknown) {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) {
    return { success: false, message: "Authentication required." };
  }
  const userId = session.user.id;

  const result = debtSchema.safeParse(formData);
  if (!result.success) {
    return { success: false, message: "Invalid form data." };
  }

  try {
    await prisma.debt.create({
      data: { ...result.data, userId },
    });
    
    await addXp("ADD_DEBT");

    revalidatePath("/debts");
    revalidatePath("/dashboard");
    return { success: true, message: "Debt added successfully." };
  } catch (error) {
    console.error("CREATE_DEBT_ERROR", error);
    return { success: false, message: "Failed to add debt." };
  }
}

export async function getDebts() {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) throw new Error("Authentication required.");

  return await prisma.debt.findMany({
    where: { userId: session.user.id },
    orderBy: { balance: "desc" },
  });
}

// ============================================================================
// FILE: lib/actions/gamification.actions.ts
// ============================================================================

// lib/actions/gamification.actions.ts (NEW FILE)
"use server";

import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "@/lib/prisma";
import { siteConfig } from "../config";

export async function getGameState() {
    const session = await getServerSession(authOptions);
    if (!session?.user?.id) return null;
    const userId = session.user.id;

    let gameState = await prisma.gameState.findUnique({
        where: { userId },
    });

    if (!gameState) {
        gameState = await prisma.gameState.create({
            data: { userId }
        });
    }

    return gameState;
}

type XpEvent = "ADD_TRANSACTION" | "ADD_GOAL" | "FUND_GOAL" | "ADD_BUDGET" | "ADD_INVESTMENT" | "ADD_ASSET" | "ADD_DEBT";

export async function addXp(event: XpEvent) {
    const session = await getServerSession(authOptions);
    if (!session?.user?.id) return;
    const userId = session.user.id;
    
    const xpAmount = siteConfig.gamification.xpEvents[event] || 0;
    if (xpAmount === 0) return;

    const gameState = await getGameState();
    if (!gameState) return;

    let { xp, level } = gameState;
    xp += xpAmount;

    // Check for level up
    let xpToNextLevel = siteConfig.gamification.xpToNextLevel[level - 1];
    while (xpToNextLevel && xp >= xpToNextLevel) {
        level++;
        xp -= xpToNextLevel;
        xpToNextLevel = siteConfig.gamification.xpToNextLevel[level - 1];
    }

    await prisma.gameState.update({
        where: { userId },
        data: { xp, level },
    });
}

// ============================================================================
// FILE: lib/actions/goal.actions.ts
// ============================================================================

// lib/actions/goal.actions.ts

"use server";

import { z } from "zod";
import { revalidatePath } from "next/cache";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "@/lib/prisma";
import { addXp } from "./gamification.actions";

// Zod schema for creating a goal
const goalSchema = z.object({
  name: z.string().min(1, "Goal name is required."),
  targetAmount: z.coerce.number().positive("Target amount must be positive."),
  deadline: z.date().optional(),
});

// Zod schema for adding funds
const addFundsSchema = z.object({
  goalId: z.string(),
  amount: z.coerce.number().positive("Amount must be a positive number."),
});


export async function createGoal(formData: unknown) {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) {
    return { success: false, message: "Authentication required." };
  }
  const userId = session.user.id;

  const result = goalSchema.safeParse(formData);
  if (!result.success) {
    return { success: false, message: "Invalid form data." };
  }

  try {
    await prisma.goal.create({
      data: { ...result.data, userId },
    });

    await addXp("ADD_GOAL");

    revalidatePath("/goals");
    return { success: true, message: "Goal created successfully." };
  } catch (error) {
    console.error("CREATE_GOAL_ERROR", error);
    return { success: false, message: "Failed to create goal." };
  }
}

export async function getGoals() {
    const session = await getServerSession(authOptions);
    if (!session?.user?.id) throw new Error("Authentication required.");
    const userId = session.user.id;

    return await prisma.goal.findMany({ where: { userId } });
}

export async function addFundsToGoal(formData: unknown) {
    const session = await getServerSession(authOptions);
    if (!session?.user?.id) {
        return { success: false, message: "Authentication required." };
    }
    const userId = session.user.id;

    const result = addFundsSchema.safeParse(formData);
    if (!result.success) {
        return { success: false, message: "Invalid data provided." };
    }

    const { goalId, amount } = result.data;

    try {
        const goal = await prisma.goal.findUnique({ where: {id: goalId}});
        if(!goal) return { success: false, message: "Goal not found." };

        // Use a transaction to ensure both operations succeed or fail together
        await prisma.$transaction([
            prisma.goal.update({
                where: { id: goalId, userId }, // Ensure user owns the goal
                data: { currentAmount: { increment: amount } },
            }),
            prisma.transaction.create({
                data: {
                    name: `Contribution to "${goal.name}"`,
                    amount: amount,
                    type: "EXPENSE",
                    category: "Savings", // A dedicated category for goal contributions
                    frequency: "ONCE",
                    date: new Date(),
                    userId: userId,
                },
            }),
        ]);

        await addXp("FUND_GOAL");

        revalidatePath("/goals");
        revalidatePath("/dashboard");
        revalidatePath("/transactions");

        return { success: true, message: "Funds added successfully!" };
    } catch (error) {
        console.error("ADD_FUNDS_ERROR", error);
        return { success: false, message: "Failed to add funds." };
    }
}

// ============================================================================
// FILE: lib/actions/investment.actions.ts
// ============================================================================

// ============================================================================
// FILE: lib/actions/investment.actions.ts
// ============================================================================

"use server";

import { z } from "zod";
import { revalidatePath } from "next/cache";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "@/lib/prisma";

const investmentSchema = z.object({
  name: z.string().min(1, "Name is required."),
  ticker: z.string().min(1, "Ticker is required.").toUpperCase(),
  quantity: z.coerce.number().positive("Quantity must be positive."),
  purchasePrice: z.coerce.number().positive("Price must be positive."),
});

export async function createInvestment(formData: unknown) {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) {
    return { success: false, message: "Authentication required." };
  }
  const userId = session.user.id;

  const result = investmentSchema.safeParse(formData);
  if (!result.success) {
    return { success: false, message: "Invalid form data." };
  }

  try {
    const { quantity, purchasePrice } = result.data;
    // We assume current value starts same as purchase price for manual entry
    const currentValue = quantity * purchasePrice; 

    await prisma.investment.create({
      data: {
        ...result.data,
        currentValue, 
        userId,
      },
    });
    
    revalidatePath("/investments");
    return { success: true, message: "Investment added successfully." };
  } catch (error) {
    console.error("CREATE_INVESTMENT_ERROR", error);
    return { success: false, message: "Failed to create investment." };
  }
}

export async function getInvestments() {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) throw new Error("Authentication required.");
  
  return await prisma.investment.findMany({
    where: { userId: session.user.id },
    orderBy: { createdAt: "desc" },
  });
}

export async function deleteInvestment(id: string) {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) return { success: false, message: "Unauthorized" };

  try {
    await prisma.investment.delete({
      where: { id, userId: session.user.id },
    });
    revalidatePath("/investments");
    return { success: true, message: "Investment deleted." };
  } catch (error) {
    return { success: false, message: "Failed to delete investment." };
  }
}

// ============================================================================
// FILE: lib/actions/patrimoine.actions.ts
// ============================================================================

// lib/actions/patrimoine.actions.ts (NEW FILE)
"use server";

import { z } from "zod";
import { revalidatePath } from "next/cache";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "@/lib/prisma";
import { addXp } from "./gamification.actions";

const assetSchema = z.object({
  name: z.string().min(1, "Asset name is required."),
  value: z.coerce.number().positive("Value must be a positive number."),
  type: z.enum(["SAVINGS", "REAL_ESTATE", "OTHER"]),
});

export async function createAsset(formData: unknown) {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) {
    return { success: false, message: "Authentication required." };
  }
  const userId = session.user.id;

  const result = assetSchema.safeParse(formData);
  if (!result.success) {
    return { success: false, message: "Invalid form data." };
  }

  try {
    await prisma.asset.create({
      data: { ...result.data, userId },
    });

    await addXp("ADD_ASSET");

    revalidatePath("/patrimoine");
    revalidatePath("/dashboard");
    return { success: true, message: "Asset added successfully." };
  } catch (error) {
    console.error("CREATE_ASSET_ERROR", error);
    return { success: false, message: "Failed to add asset." };
  }
}

export async function getAssets() {
    const session = await getServerSession(authOptions);
    if (!session?.user?.id) throw new Error("Authentication required.");

    return await prisma.asset.findMany({ where: { userId: session.user.id } });
}

// ============================================================================
// FILE: lib/actions/transaction.actions.ts
// ============================================================================

// lib/actions/transaction.actions.ts

"use server";

import { z } from "zod";
import { revalidatePath } from "next/cache";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "@/lib/prisma";
import { addXp } from "./gamification.actions";

// Zod schema for validation
const transactionSchema = z.object({
  name: z.string().min(1, "Name is required."),
  amount: z.coerce.number().positive("Amount must be a positive number."),
  type: z.enum(["INCOME", "EXPENSE"]),
  category: z.string().min(1, "Category is required."),
  date: z.date(),
});

// Server Action to create a transaction
export async function createTransaction(formData: unknown) {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) {
    return { success: false, message: "Authentication required." };
  }
  const userId = session.user.id;

  const result = transactionSchema.safeParse(formData);
  if (!result.success) {
    return { success: false, message: "Invalid form data." };
  }

  try {
    await prisma.transaction.create({
      data: {
        ...result.data,
        userId,
        frequency: "ONCE", 
      },
    });

    await addXp("ADD_TRANSACTION");
    
    revalidatePath("/dashboard");
    revalidatePath("/transactions");

    return { success: true, message: "Transaction added successfully." };
  } catch (error) {
    console.error("CREATE_TRANSACTION_ERROR", error);
    return { success: false, message: "Failed to create transaction." };
  }
}

// Server Action to get all transactions for the current user
export async function getTransactions() {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) {
    throw new Error("Authentication required.");
  }
  const userId = session.user.id;
  
  const transactions = await prisma.transaction.findMany({
    where: { userId },
    orderBy: { date: "desc" },
  });

  return transactions;
}

// ============================================================================
// FILE: lib/actions/user.actions.ts
// ============================================================================

// lib/actions/user.actions.ts (NEW FILE)
"use server";

import { z } from "zod";
import { revalidatePath } from "next/cache";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import prisma from "@/lib/prisma";

const profileSchema = z.object({
  name: z.string().min(2, "Name must be at least 2 characters."),
});

export async function updateUserProfile(formData: unknown) {
  const session = await getServerSession(authOptions);
  if (!session?.user?.id) {
    return { success: false, message: "Authentication required." };
  }
  const userId = session.user.id;

  const result = profileSchema.safeParse(formData);
  if (!result.success) {
    return { success: false, message: "Invalid data provided." };
  }

  try {
    await prisma.user.update({
      where: { id: userId },
      data: { name: result.data.name },
    });

    revalidatePath("/settings");
    return { success: true };
  } catch (error) {
    console.error("UPDATE_PROFILE_ERROR", error);
    return { success: false, message: "Failed to update profile." };
  }
}

// ============================================================================
// FILE: lib/config.ts
// ============================================================================

// lib/config.ts
export const siteConfig = {
  name: "Finances Expert Pro",
  description: "The Smart Way to Manage Your Personal Finances.",
  menuItems: [
    { id: "features", name: "Features", href: "#features" },
    { id: "pricing", name: "Pricing", href: "#pricing" },
    { id: "about", name: "About", href: "#about" },
  ],
  gamification: {
    xpEvents: {
        "ADD_TRANSACTION": 10,
        "ADD_GOAL": 25,
        "FUND_GOAL": 15,
        "ADD_BUDGET": 20,
        "ADD_INVESTMENT": 20,
        "ADD_ASSET": 15,
        "ADD_DEBT": 15,
    },
    // Cumulative XP to reach the next level (index 0 is for level 2)
    xpToNextLevel: [100, 150, 200, 250, 300, 400, 500],
    rewards: [
        { level: 2, name: "Advanced Charts"},
        { level: 3, name: "New Theme"},
        { level: 5, name: "CSV Export"},
    ]
  }
};

// ============================================================================
// FILE: lib/google-gemini-ai.ts
// ============================================================================

// lib/google-gemini-ai.ts
import { GoogleGenerativeAI } from "@google/generative-ai";

if (!process.env.GEMINI_API_KEY) {
  throw new Error("GEMINI_API_KEY environment variable is not set.");
}

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

// Use a cheaper/faster model for basic JSON tasks
const model = genAI.getGenerativeModel({ 
    model: "gemini-2.5-flash-lite",
    // Force JSON mode where supported, but we still clean the output manually below to be safe
    generationConfig: { responseMimeType: "application/json" }
});

// Helper to strip Markdown code blocks
function cleanJsonOutput(text: string) {
  // Remove ```json and ``` wrapping
  const cleaned = text.replace(/```json/g, "").replace(/```/g, "").trim();
  return cleaned;
}

export async function runFinancialAnalysis(financialData: any) {
  const prompt = `
    You are an expert financial analyst. Analyze the following financial data for a user and provide a concise, insightful report.

    Financial Data:
    ${JSON.stringify(financialData, null, 2)}

    Your task is to return a JSON object with the exact following structure:
    {
      "score": <number 0-100>,
      "summary": "<string>",
      "strengths": ["<string>", "<string>"],
      "weaknesses": ["<string>", "<string>"],
      "recommendations": ["<string>", "<string>", "<string>"]
    }

    Do not include any introductory text. Just return the JSON string.
  `;

  const result = await model.generateContent(prompt);
  const response = result.response;
  const text = response.text();
  
  return cleanJsonOutput(text);
}

export async function runDebtAnalysis(debts: any[]) {
    const prompt = `
    You are a debt repayment specialist. Analyze the user's debts and recommend the best repayment strategy.
    Assume the user can pay an extra $200 per month towards their debts.

    Debts Data:
    ${JSON.stringify(debts, null, 2)}

    Return a JSON object with the following structure:
    {
        "bestMethod": "AVALANCHE" | "SNOWBALL",
        "reasoning": "<string>",
        "avalanche": {
            "payoffMonths": <number>,
            "totalInterest": <number>
        },
        "snowball": {
            "payoffMonths": <number>,
            "totalInterest": <number>
        }
    }
    
    Do not include any introductory text. Just return the JSON string.
    `;

    const result = await model.generateContent(prompt);
    const response = result.response;
    const text = response.text();
    
    return cleanJsonOutput(text);
}

// ============================================================================
// FILE: lib/prisma.ts
// ============================================================================

// lib/prisma.ts
import { PrismaClient } from "@prisma/client";

declare global {
  var prisma: PrismaClient | undefined;
}

const prisma = global.prisma || new PrismaClient();

if (process.env.NODE_ENV !== "production") {
  global.prisma = prisma;
}

export default prisma;

// ============================================================================
// FILE: lib/utils.ts
// ============================================================================

// lib/utils.ts
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

export function getInitials(name?: string | null) {
  if (!name) return "U";
  return name
    .split(" ")
    .map((n) => n[0])
    .slice(0, 2)
    .join("")
    .toUpperCase();
}

export function formatCurrency(amount: number) {
  return new Intl.NumberFormat("en-US", {
    style: "currency",
    currency: "USD",
  }).format(amount);
}

// ============================================================================
// FILE: next-env.d.ts
// ============================================================================

/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.


// ============================================================================
// FILE: next.config.ts
// ============================================================================

import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;


// ============================================================================
// FILE: package.json
// ============================================================================

{
  "name": "finances_app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@google/generative-ai": "^0.24.1",
    "@hookform/resolvers": "^5.2.2",
    "@next-auth/prisma-adapter": "^1.0.7",
    "@prisma/client": "^6.19.0",
    "@radix-ui/react-accordion": "^1.2.12",
    "@radix-ui/react-alert-dialog": "^1.1.15",
    "@radix-ui/react-aspect-ratio": "^1.1.8",
    "@radix-ui/react-avatar": "^1.1.11",
    "@radix-ui/react-checkbox": "^1.3.3",
    "@radix-ui/react-collapsible": "^1.1.12",
    "@radix-ui/react-context-menu": "^2.2.16",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-dropdown-menu": "^2.1.16",
    "@radix-ui/react-hover-card": "^1.1.15",
    "@radix-ui/react-label": "^2.1.8",
    "@radix-ui/react-menubar": "^1.1.16",
    "@radix-ui/react-navigation-menu": "^1.2.14",
    "@radix-ui/react-popover": "^1.1.15",
    "@radix-ui/react-progress": "^1.1.8",
    "@radix-ui/react-radio-group": "^1.3.8",
    "@radix-ui/react-scroll-area": "^1.2.10",
    "@radix-ui/react-select": "^2.2.6",
    "@radix-ui/react-separator": "^1.1.8",
    "@radix-ui/react-slider": "^1.3.6",
    "@radix-ui/react-slot": "^1.2.4",
    "@radix-ui/react-switch": "^1.2.6",
    "@radix-ui/react-tabs": "^1.1.13",
    "@radix-ui/react-toast": "^1.2.15",
    "@radix-ui/react-toggle": "^1.1.10",
    "@radix-ui/react-toggle-group": "^1.1.11",
    "@radix-ui/react-tooltip": "^1.2.8",
    "axios": "^1.13.2",
    "bcryptjs": "^3.0.3",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "date-fns": "^4.1.0",
    "embla-carousel-react": "^8.6.0",
    "framer-motion": "^12.23.24",
    "input-otp": "^1.4.2",
    "lucide-react": "^0.555.0",
    "next": "16.0.5",
    "next-auth": "^4.24.13",
    "next-themes": "^0.4.6",
    "prisma": "^6.19.0",
    "react": "19.2.0",
    "react-day-picker": "^9.11.2",
    "react-dom": "19.2.0",
    "react-hook-form": "^7.66.1",
    "react-icons": "^5.5.0",
    "react-resizable-panels": "^3.0.6",
    "recharts": "^2.15.4",
    "sonner": "^2.0.7",
    "tailwind-merge": "^3.4.0",
    "vaul": "^1.1.2",
    "zod": "^4.1.13"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.0.5",
    "tailwindcss": "^4",
    "tw-animate-css": "^1.4.0",
    "typescript": "^5"
  }
}


// ============================================================================
// FILE: postcss.config.mjs
// ============================================================================

const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;


// ============================================================================
// FILE: prisma.config.ts
// ============================================================================

// prisma.config.ts

import { defineConfig, env } from "prisma/config";

export default defineConfig({
  schema: "prisma/schema.prisma",
  migrations: {
    path: "prisma/migrations",
  },
  engine: "classic",
  datasource: {
    url: env("DATABASE_URL"), // This tells Prisma how to get the URL
  },
});

// ============================================================================
// FILE: prisma/schema.prisma
// ============================================================================

// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url = env("DATABASE_URL") 
}

// NextAuth Models
model Account {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  userId            String  @db.ObjectId
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.String
  access_token      String? @db.String
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.String
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionToken String   @unique
  userId       String   @db.ObjectId
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// Application Models
model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  password      String?
  accounts      Account[]
  sessions      Session[]

  // App-specific relations
  transactions Transaction[]
  goals        Goal[]
  assets       Asset[]
  investments  Investment[]
  budgets      Budget[]
  debts        Debt[]
  gameState    GameState?
}

model Transaction {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  name      String
  amount    Float
  type      String // INCOME or EXPENSE
  category  String
  frequency String // ONCE, MONTHLY, YEARLY
  date      DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Goal {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  name          String
  targetAmount  Float
  currentAmount Float    @default(0)
  deadline      DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Asset {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  name      String
  value     Float
  type      String // SAVINGS, REAL_ESTATE, OTHER
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Investment {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  name          String
  ticker        String
  quantity      Float
  purchasePrice Float
  currentValue  Float
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Budget {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  category  String
  limit     Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Debt {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  name        String
  balance     Float
  apr         Float
  minPayment  Float
  type        String // LOAN, CREDIT_CARD, OTHER
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model GameState {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  userId  String @unique @db.ObjectId
  level   Int    @default(1)
  xp      Int    @default(0)
  rewards Json? // JSON is supported in MongoDB
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ============================================================================
// FILE: prroxy.ts
// ============================================================================

// proxy.ts (This is the corrected file)

export { default } from "next-auth/middleware";

export const config = {
  matcher: [
    /*
     * Match all request paths except for the ones starting with:
     * - api (API routes)
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     * - login (login page)
     * - register (register page)
     * - / (the root landing page)
     * - any files with an extension (e.g. .png)
     */
    "/((?!api|_next/static|_next/image|favicon.ico|login|register|$|.*\\.).*)",
  ],
};

// ============================================================================
// FILE: tsconfig.json
// ============================================================================

{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}


// ============================================================================
// FILE: types.ts
// ============================================================================


import type { LucideIcon } from 'lucide-react';

export interface Category {
  label: string;
  icon: LucideIcon;
  color: string;
  gradient: string;
}

export type DepenseFrequence = 'quotidien' | 'hebdomadaire' | 'mensuel' | 'trimestriel' | 'semestriel' | 'annuel';
export type RevenuFrequence = 'mensuel' | 'ponctuel' | 'annuel';

export type TypeAssurance = 'auto' | 'habitation' | 'sante' | 'vie' | 'prevoyance' | 'responsabilite' | 'autres';

export interface Depense {
  id: number;
  nom: string;
  montant: string;
  frequence: DepenseFrequence;
  categorie: keyof typeof import('./constants').CATEGORIES;
  dateDebut?: string;
  montantTotal?: string;
  mensualitesRestantes?: string;
  tauxInteret?: string;
  nombrePaiements?: string;
  paiementsRestants?: string;
  typeAssurance?: TypeAssurance | string;
}

export interface Revenu {
  id: number;
  nom: string;
  montant: string;
  frequence: RevenuFrequence;
  categorie: keyof typeof import('./constants').REVENUS_CATEGORIES;
  dateDebut?: string;
}

export interface Objectif {
  id: number;
  nom: string;
  montantCible: string;
  montantActuel: string;
}

export interface Actif {
  type: string;
  id: number;
  nom: string;
  valeur: string;
}

// --- INVESTISSEMENT TYPES ---
export type InvestmentType = 'stock' | 'crypto' | 'etf' | 'bond' | 'other';

export interface Investment {
  id: string;
  symbol: string; // e.g., AAPL, BTC
  name: string;
  type: InvestmentType;
  quantity: number;
  averageBuyPrice: number; // PRU
  currentPrice: number; // Prix actuel (simulé ou entré manuellement)
}

export interface InfosFiscales {
  rfr: string;
  tmi: string;
  impotsPayes: string;
}

export interface Trophee {
  id: string;
  nom: string;
  description: string;
  condition: (data: FinancialData) => boolean;
}

export interface Budget {
  categorie: keyof typeof import('./constants').CATEGORIES;
  limite: number;
}

export interface Notification {
  id: string;
  type: 'info' | 'warning' | 'success' | 'error';
  message: string;
  date: string;
  read: boolean;
}

// --- GAMIFICATION TYPES ---

export type RewardType = 'coin' | 'badge' | 'theme' | 'feature';

export interface Reward {
  id: string;
  type: RewardType;
  name: string;
  value: number | string; // Amount of coins, theme ID, or feature key
  icon?: LucideIcon;
  description?: string;
}

export interface Quest {
  id: string;
  title: string;
  description: string;
  xpReward: number;
  coinReward: number;
  progress: number;
  target: number;
  completed: boolean;
  type: 'add_expense' | 'add_income' | 'save_money' | 'check_app';
}

export interface SeasonPassLevel {
  level: number;
  xpRequired: number;
  freeReward: Reward | null;
  premiumReward: Reward | null;
}

export interface GameState {
  level: number;
  xp: number; // cumulative XP for current level
  coins: number;
  isPremium: boolean; // Elite Pass purchased
  claimedRewards: string[]; // IDs of claimed rewards
  unlockedFeatures: string[]; // List of unlocked feature keys (e.g., 'csv_export', 'radar_chart', 'theme_cyberpunk')
  quests: Quest[];
  lastLoginDate: string;
  streak: number;
}

export interface FinancialData {
  depenses: Depense[];
  revenus: Revenu[];
  objectifs: Objectif[];
  actifs: Actif[];
  investissements: Investment[]; // Nouveau champ
  cashFlow: number;
  score: number;
  optimisationDettes: boolean;
  patrimoineNet: number;
  infosFiscales: InfosFiscales;
  budgets: Budget[];
  analyseIAEffectuee: boolean;
  notifications: Notification[];
  gameState: GameState;
}

export interface Recommandation {
  priorite: number;
  titre: string;
  description: string;
  economie: string;
  delai: string;
}

export interface AnalyseIA {
  score: number;
  resume: string;
  pointsForts: string[];
  pointsFaibles: string[];
  recommandationsPrioritaires: Recommandation[];
  conseilsExpert: string[];
  optimisationFiscale: string;
}

export type Onglet = 'dashboard' | 'revenus' | 'depenses' | 'ajouter' | 'fiscalite' | 'objectifs' | 'patrimoine' | 'dettes' | 'analyse' | 'seasonpass' | 'investissement' | 'simulateurs';

export interface User {
  username: string;
  password: string; // Hashed
  salt?: string;
}

// THEME TYPES
export type ThemeId = 'default' | 'ocean' | 'nature' | 'sunset' | 'royal' | 'cyberpunk' | 'dark';

export interface Theme {
  id: ThemeId;
  name: string;
  isDark: boolean; // Nouveau flag pour le mode sombre
  colors: {
    primary: string;
    secondary: string;
    accent: string;
    // Dynamic UI colors
    text: string;       // Texte principal
    subtext: string;    // Texte secondaire
    card: string;       // Fond des cartes
    border: string;     // Bordures
    input: string;      // Fond des inputs
    chartText: string;  // Couleur texte graphiques (hex)
  };
  gradients: {
    header: string;
    appBackground: string;
    primaryButton: string;
    activeTab: string;
    loginSidebar: string;
  };
  isPremium?: boolean; // Requires unlock
}


// ============================================================================
// FILE: types/index.ts
// ============================================================================

import { LucideIcon } from 'lucide-react';

export type RevenuFrequence = 'mensuel' | 'ponctuel' | 'annuel';
export type DepenseFrequence = 'hebdomadaire' | 'mensuel' | 'trimestriel' | 'semestriel' | 'annuel';
export type InvestmentType = 'stock' | 'etf' | 'crypto';

export interface Depense {
  id: number;
  nom: string;
  montant: string;
  frequence: DepenseFrequence;
  categorie: string;
  dateDebut: string;
  montantTotal?: string;
  mensualitesRestantes?: string;
  tauxInteret?: string;
  nombrePaiements?: string;
  paiementsRestants?: string;
  typeAssurance?: string;
}

export interface Revenu {
  id: number;
  nom: string;
  montant: string;
  frequence: RevenuFrequence;
  categorie: string;
  dateDebut: string;
}

export interface Objectif {
  id: number;
  nom: string;
  montantCible: string;
  montantActuel: string;
}

export interface Actif {
  id: number;
  nom: string;
  valeur: string;
  type?: string;
}

export interface Budget {
  categorie: string;
  limite: number;
}

export interface Trophee {
  id: string;
  nom: string;
  description: string;
}

export interface Reward {
  id: string;
  type: 'coin' | 'feature' | 'theme' | 'badge';
  value: string | number;
  icon: LucideIcon;
  description?: string;
}

export interface Quest {
  id: string;
  title: string;
  description: string;
  xpReward: number;
  coinReward: number;
  progress: number;
  target: number;
  completed: boolean;
}

export interface SeasonLevel {
  level: number;
  xpRequired: number;
  freeReward?: Reward;
  premiumReward?: Reward;
}

export interface GameState {
  level: number;
  xp: number;
  coins: number;
  isPremium: boolean;
  unlockedFeatures: string[];
  claimedRewards: string[];
  quests: Quest[];
}

export interface Investment {
  id: string;
  symbol: string;
  name: string;
  type: InvestmentType;
  quantity: number;
  averageBuyPrice: number;
  currentPrice: number;
}

// ============================================================================
// FILE: types/next-auth.d.ts
// ============================================================================

// types/next-auth.d.ts

import NextAuth, { DefaultSession } from "next-auth";

declare module "next-auth" {
  /**
   * Returned by `useSession`, `getSession` and received as a prop on the `SessionProvider` React Context
   */
  interface Session {
    user: {
      /** The user's id. */
      id: string;
    } & DefaultSession["user"];
  }
}

// ============================================================================
// FILE: utils/financeCalculations.ts
// ============================================================================

import type { Depense, Revenu } from '@/types';

export function formaterMontant(montant: number): string {
  return new Intl.NumberFormat('fr-FR', {
    style: 'currency',
    currency: 'EUR',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(montant);
}

export function calculerMontantMensuel(item: Depense | Revenu): number {
  const montant = typeof item.montant === 'string' ? parseFloat(item.montant) : item.montant;
  if (isNaN(montant)) return 0;
  
  switch (item.frequence) {
    case 'quotidien':
      return montant * 30;
    case 'hebdomadaire':
      return montant * 4.33;
    case 'mensuel':
      return montant;
    case 'trimestriel':
      return montant / 3;
    case 'semestriel':
      return montant / 6;
    case 'annuel':
      return montant / 12;
    default:
      return montant;
  }
}

// ============================================================================
// END OF CONTEXT
// ============================================================================
// Total files included: 140
// Generated: Mon Jan  5 23:21:08 CET 2026
// ============================================================================
